/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["versa.widget.share.Show"]){dojo._hasResource["versa.widget.share.Show"]=true;dojo.provide("versa.widget.share.Show");dojo.require("bfree.api.XhrHelper");dojo.require("bfree.widget.Button");dojo.require("bfree.widget.Bfree");dojo.require("bfree.widget.ValidationTextBox");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.form.Form");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.require("versa.widget.share.Grid");dojo.declare("versa.widget.share.Show",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("versa/widget/share","template/Show.html","<div style=\"height:100%;width:100%\">\n\n<div    dojoType=\"dijit.layout.BorderContainer\"\n        dojoAttachPoint=\"mainNode\"\n        design=\"headline\"\n        gutters=\"false\"\n        style=\"height:100%;width:100%;\">\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            dojoAttachPoint=\"logonNode\"\n            region=\"center\"\n            splitter=\"false\"\n            style=\"text-align:center;padding:0\">\n\n\n        <div dojoAttachPoint=\"logonFormNode\">\n\n            <div style=\"margin-top:32px;margin-left:auto;margin-right:auto\">\n                <span style=\"position:relative;top:2px;left:-2px\" class=\"logonLabel\">Enter Password</span>\n                <input dojoAttachPoint=\"passwordNode\"/>\n                <input dojoAttachPoint=\"tokenNode\"/>\n                <button dojoAttachPoint=\"logonButtonNode\" type=\"submit\"></button>\n            </div>\n\n            <div dojoAttachPoint=\"statusNode\" style=\"margin-left:auto;margin-right:auto;opacity:0\">\n                <img dojoAttachPoint=\"imgNode\" src=\"/images/icons/16/blank.png\" align=\"middle\" width=\"16\" height=\"16\" style=\"margin-right:4px\"/>\n                <span dojoAttachPoint=\"msgNode\" style=\"position:relative;top:2px;left:-2px\" class=\"logonLabel\"></span>\n            </div>\n\n\n        </div>\n\n\n    </div>\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            dojoAttachPoint=\"itemsNode\"\n            region=\"center\"\n            splitter=\"false\"\n            style=\"padding:8px 8px 14px 8px;display:none;opacity:0;overflow:hidden\">\n\n        <div dojoAttachPoint=\"gridNode\"></div>\n\n    </div>\n\n</div>\n\n</div>\n"),widgetsInTemplate:true,share:null,zone:null,_frmSubmit:null,_frmLogon:null,_grdItems:null,_txtPassword:null,_txtToken:null,__onCopy:function(_1){var _2=bfree.api.Utilities.getBox({scale:0.75});dojo.forEach(_1,function(_3,_4){_3.copyLocal({form:this._frmSubmit,zone:this.zone,share:this.share,windowBox:_2});},this);},__onView:function(_5){var _6=bfree.api.Utilities.getBox({scale:0.75});dojo.forEach(_5,function(_7,_8){_7.view({form:this._frmSubmit,zone:this.zone,share:this.share,windowBox:_6});},this);},_loadItems:function(){this._txtToken.set("value",bfree.api.XhrHelper.authenticity_token);this._frmSubmit.onSubmit=function(){return true;};this._grdItems=new versa.widget.share.Grid({"class":"versaGridOutline versaNoHeader",zone:this.zone,onCommand:dojo.hitch(this,this._onCommand)},this.gridNode);this._grdItems.startup();this._grdItems.set("activeShare",this.share);this._grdItems.resize();},_onCommand:function(_9,_a,_b){switch(_9){case bfree.widget.Bfree.Commands.VIEW:this.__onView(_b.items);break;case bfree.widget.Bfree.Commands.COPY:this.__onCopy(_b.items);break;}},_onSubmit:function(e){try{this.share.password=this._txtPassword.get("value");this.share.authorize(this.zone);this.onLogon();}catch(e){this.onError(e);this._txtPassword.reset();this._txtPassword.setFocus(true);}finally{e.preventDefault();}},_setZoneAttr:function(_c){this.zone=_c;},_showGrid:function(){dojo.fadeOut({node:this.logonNode.domNode,onEnd:dojo.hitch(this,function(){dojo.style(this.itemsNode.domNode,{display:"block"});dojo.fadeIn({node:this.itemsNode.domNode,onEnd:dojo.hitch(this,this._loadItems)}).play();})}).play();},constructor:function(_d){},destroy:function(){this.inherited("destroy",arguments);},onError:function(e){var _e=dojo.replace("ERROR: <b>{message}</b>",e);dojo.removeClass(this.imgNode,"statusIcon bfreeIconOk");dojo.addClass(this.imgNode,"statusIcon bfreeIconError");dojo.removeClass(this.msgNode,"dijitOkLabel");dojo.addClass(this.msgNode,"dijitErrorLabel");dojo.attr(this.msgNode,{innerHTML:_e});dojo.fadeIn({node:this.statusNode,duration:1000}).play();},onLogon:function(){var _f=dojo.replace("Successfully logged in...");dojo.addClass(this.imgNode,"statusIcon bfreeIconOk");dojo.removeClass(this.imgNode,"statusIcon bfreeIconError");dojo.removeClass(this.msgNode,"dijitErrorLabel");dojo.addClass(this.msgNode,"dijitOkLabel");dojo.attr(this.msgNode,{innerHTML:_f});dojo.fadeIn({node:this.statusNode,duration:1000,onEnd:dojo.hitch(this,this._showGrid)}).play();},postCreate:function(){this.inherited("postCreate",arguments);this._frmSubmit=new dijit.form.Form({onSubmit:dojo.hitch(this,this._onSubmit)},this.logonFormNode);this._txtPassword=new bfree.widget.ValidationTextBox({name:"txtPassword",required:false,type:"password",style:"width:160px"},this.passwordNode);this._txtToken=new dijit.form.TextBox({name:"authenticity_token",type:"hidden"},this.tokenNode);this._btnSubmit=new bfree.widget.Button({iconClass:"buttonIcon bfreeIconLock",label:"Log in",type:"submit"},this.logonButtonNode);},resize:function(){this.mainNode.resize();},startup:function(){this.inherited("startup",arguments);this._txtPassword.setFocus(true);}});}