/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["versa.widget.zone.metrics.DiskQuota"]){dojo._hasResource["versa.widget.zone.metrics.DiskQuota"]=true;dojo.provide("versa.widget.zone.metrics.DiskQuota");dojo.require("bfree.api.Utilities");dojo.require("bfree.widget.Label");dojo.require("bfree.widget.PropertyTable");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.require("dojox.charting.Chart");dojo.require("dojox.charting.axis2d.Default");dojo.require("dojox.charting.plot2d.Pie");dojo.require("dojox.charting.action2d.MoveSlice");dojo.require("dojox.charting.action2d.Tooltip");dojo.require("versa.widget.zone.metrics.themes.VersaGaugeOK");dojo.require("versa.widget.zone.metrics.themes.VersaGaugeWarning");dojo.require("versa.widget.zone.metrics.themes.VersaGaugeDanger");dojo.declare("versa.widget.zone.metrics.DiskQuota",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("versa/widget/zone/metrics","template/DiskQuota.html","<div style=\"height:128px;width:100%;position:relative;\">\n\n    <div dojoAttachPoint=\"chartNode\" style=\"height:128px;width:128px;\"></div>\n    <div style=\"position:absolute;left:128px;top:0;width:144px;height:100%;margin-bottom:24px\">\n        <div dojoAttachPoint=\"tableNode\"></div>\n    </div>\n    <div class=\"dijitMediumLabel dijitDarkLabel\" style=\"position:absolute;bottom:0;left:0;width:128px;text-align:center;margin-right:24px\">Disk Quota</div>\n\n</div>\n"),widgetsInTemplate:true,_lblDiskFree:null,_lblDiskUsed:null,_lblDiskQuota:null,_tblProperties:null,_wdgChart:null,_wdgLegend:null,diskQuota:0,diskUsed:0,zone:null,constructor:function(_1){},destroy:function(){this.inherited("destroy",arguments);},postCreate:function(){this.inherited("postCreate",arguments);var _2=(this.diskUsed>=this.diskQuota)?this.diskQuota:this.diskQuota-this.diskUsed;var _3=[];var _4=dojo.replace("Used Space: {0}",[bfree.api.Utilities.readablizeBytes({bytes:this.diskUsed})]);var _5=dojo.replace("Free Space: {0}",[bfree.api.Utilities.readablizeBytes({bytes:_2})]);_3.push({y:this.diskUsed,text:_4,"legend":"Used"});_3.push({y:_2,text:_5,"legend":"Free"});this._wdgChart=new dojox.charting.Chart(this.chartNode);this._wdgChart.addPlot("default",{type:"Pie",radius:48,startAngle:-90,ticks:true,labelStyle:"default",labels:false,labelOffset:-16});this._wdgChart.addSeries("Series1",_3);var _6=this.userCount/this.userQuota;if(_6>0.85){this._wdgChart.setTheme(dojox.charting.themes.VersaGaugeDanger);}else{if((_6<=0.85)&&(_6>0.66)){this._wdgChart.setTheme(dojox.charting.themes.VersaGaugeWarning);}else{this._wdgChart.setTheme(dojox.charting.themes.VersaGaugeOK);}}new dojox.charting.action2d.Tooltip(this._wdgChart,"default");new dojox.charting.action2d.MoveSlice(this._wdgChart,"default",{series:"Series1",scale:1.25,shift:0});this._wdgChart.render();this._tblProperties=new bfree.widget.PropertyTable({customClass:"versathin",showLabels:true,cols:1,labelWidth:64,style:"position:relative;top: 50%;margin-top:-29px"},this.tableNode);this._lblDiskUsed=new bfree.widget.Label({label:"Used Space:",value:bfree.api.Utilities.readablizeBytes({bytes:this.diskUsed})});this._tblProperties.addChild(this._lblDiskUsed);this._lblDiskFree=new bfree.widget.Label({label:"Free Space:",value:bfree.api.Utilities.readablizeBytes({bytes:_2})});this._tblProperties.addChild(this._lblDiskFree);this._lblDiskQuota=new bfree.widget.Label({label:"Capacity",value:bfree.api.Utilities.readablizeBytes({bytes:this.diskQuota})});this._tblProperties.addChild(this._lblDiskQuota);},startup:function(){this.inherited("startup",arguments);this._tblProperties.startup();}});}