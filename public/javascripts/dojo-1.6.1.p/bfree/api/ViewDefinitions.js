/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.api.ViewDefinitions"]){dojo._hasResource["bfree.api.ViewDefinitions"]=true;dojo.provide("bfree.api.ViewDefinitions");dojo.require("bfree.api.ViewDefinition");dojo.require("bfree.api._Collection");dojo.require("bfree.api.CellDefinitions");dojo.require("bfree.api.Error");dojo.require("bfree.IconManager");dojo.declare("bfree.api.ViewDefinitions",[bfree.api._Collection],{_system:null,documentTypes:null,_matchesQuery:function(_1,_2){if(dojo.isArray(_1)||(_1.hasOwnProperty("column_order"))){return false;}var _3=_2.query;var _4=_2.queryOptions&&_2.queryOptions.ignoreCase;for(var i in _3){var _5=_3[i];var _6=this.getValue(_1,i);if((typeof _5=="string"&&(_5.match(/[\*\.]/)||_4))?!dojo.data.util.filter.patternToRegExp(_5,_4).test(_6):_6!=_5){return false;}}return true;},copyFromTemplate:function(_7,_8){var _9=_7.cell_definitions;var _a=this.create({cell_definitions:[],created_by:_8.name,is_system:false,is_template:false,library_id:_7.library_id,name:_7.name,scope:_7.scope,sort_by:_7.sort_by,updated_by:_8.name});dojo.forEach(_9,function(_b){_a.cell_definitions.push({column_name:_b.column_name,column_order:_b.column_order,date_format:_b.date_format,formatter:_b.formatter,label:_b.label,name:_b.name,noresize:_b.noresize,style:_b.style,table_name:_b.table_name,width:_b.width});},this);return _a;},_getDocumentAttr:function(_c,_d){var _e="";var _f=this[0];var _10=this[1];if(!_d){return _e;}var _11=_10.column_name;switch(_11){case "created_at":case "updated_at":_e=_f._formatDateTime(_10,_d[_11]);break;default:if(/prp_dtt/.test(_11)&&_d[_11]){_e=dojo.date.stamp.fromISOString(_d[_11]);if(_e){_e=_f._formatDateTime(_10,_e);}}else{_e=_d[_11];}break;}return _e;},_getDocumentTypeAttr:function(_12,_13){var _14="";var _15=this[0];var _16=this[1];if(!_13){return _14;}if(!_13.document_type_id){return "";}var _17=_15.documentTypes.fetchById({id:_13.document_type_id});switch(_16.column_name){case "name":_14=_17.name;break;}return _14;},_getVersionAttr:function(_18,_19){var _1a="";var _1b=this[0];var _1c=this[1];if(!_19){return _1a;}switch(_1c.column_name){case "content_type":_1a=(_19.current_version)?_19.current_version.content_type:"";break;case "version_number":_1a=(_19.current_version)?_19.current_version.version_number:0;break;case "size":_1a=(_19.current_version)?_19.current_version.size:0;break;}return _1a;},constructor:function(_1d){this.zone=_1d.zone;this.library=_1d.library;this.target=dojo.replace(bfree.api.ViewDefinitions.TRGT,[this.zone.subdomain,this.library.id]);this.schema=bfree.api.ViewDefinition.schema;this.cache=true;this.cellDefinitions=_1d.cellDefinitions;this._initialize();},cloneItem:function(_1e){var _1f=this.create({name:_1e.name,is_system:false,description:_1e.description,is_template:false,scope:_1e.scope,sort_by:_1e.sort_by});dojo.forEach(_1e.cell_definitions,function(_20,idx){_1f.cell_definitions.push(bfree.api.CellDefinition.clone(_20));});return _1f;},getSystem:function(){if(!this._system){this._system=new Array();this.forEach(function(_21){if(_21.is_system){this._system.push(_21);}},this);}return this._system;},isValidItem:function(_22){var _23=this.inherited(arguments);var _24=_22.item;if(!_23){return;}if(_24.name.length<1){throw new Error("View Definition 'Name' is empty or invalid");}if((!_24.sort_by)||(_24.sort_by.length<1)){throw new Error("View Definition must have a 'Sort By' value");}return true;}});bfree.api.ViewDefinitions.TRGT="/zones/{0}/libraries/{1}/view_definitions";}