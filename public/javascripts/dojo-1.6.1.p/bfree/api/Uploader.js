/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.api.Uploader"]){dojo._hasResource["bfree.api.Uploader"]=true;dojo.provide("bfree.api.Uploader");dojo.require("dojox.embed.Flash");dojo.declare("bfree.api.Uploader",null,{});bfree.api.Uploader.useFlash=function(){if(dojo.isOpera){return false;}return dojox.embed.Flash.available;},bfree.api.Uploader.uploadFiles=function(_1){var _2=bfree.api.Uploader.getUploadUrl({zone:_1.zone,isPackage:false});var fd=new FormData();fd.append("upload_type","html5");fd.append("authenticity_token",bfree.api.XhrHelper.authenticity_token);dojo.forEach(_1.files,function(f,i){fd.append("uploadedfiles[]",f);},this);var _3=new XMLHttpRequest();_3.open("POST",_2);_3.onreadystatechange=function(){if(_3.readyState==4&&_3.status==200){_1.onComplete();}};_3.send(fd);};bfree.api.Uploader.CLEAN_TRGT="/zones/{0}/uploader/clean.json";bfree.api.Uploader.PRV_TRGT="/zones/{0}/uploader/preview?file={1}&authenticity_token={2}";bfree.api.Uploader.DL_TRGT="/zones/{0}/uploader/download?file={1}";bfree.api.Uploader.UL_TRGT="/zones/{0}/uploader/upload?pkg={1}";bfree.api.Uploader.getDownloadUrl=function(_4){return dojo.replace(bfree.api.Uploader.DL_TRGT,[_4.zone.subdomain,encodeURIComponent(_4.item.file)]);};bfree.api.Uploader.getPreviewUrl=function(_5){var _6=(_5.item)?_5.item.binary_file_name:"";return dojo.replace(bfree.api.Uploader.PRV_TRGT,[_5.zone.subdomain,encodeURIComponent(_6),bfree.api.XhrHelper.authenticity_token]);};bfree.api.Uploader.getUploadUrl=function(_7){return dojo.replace(bfree.api.Uploader.UL_TRGT,[_7.zone.subdomain,_7.isPackage]);};bfree.api.Uploader.clean=function(_8){var _9=dojo.replace(bfree.api.Uploader.CLEAN_TRGT,[_8.zone.subdomain]);var _a={};var _b=bfree.api.XhrHelper.doPostAction({target:_9,postData:_a});};}