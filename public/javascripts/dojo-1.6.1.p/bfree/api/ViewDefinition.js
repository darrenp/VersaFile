/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.api.ViewDefinition"]){dojo._hasResource["bfree.api.ViewDefinition"]=true;dojo.provide("bfree.api.ViewDefinition");dojo.require("bfree.api._Object");dojo.require("bfree.api.Error");dojo.require("versa.api.Formatter");dojo.declare("bfree.api.ViewDefinition",bfree.api._Object,{_view:null,constructor:function(_1){dojo.safeMixin(this,((!_1)?{}:_1));},_generate:function(_2){var _3={name:this.name,id:this.getId(),sort_column:1,cells:[]};dojo.forEach(this.cell_definitions,function(_4,_5){var _6={field:dojo.replace("{table_name}.{column_name}",_4),name:String.isBlank(_4.label)?"&nbsp;":_4.label,width:_4.width,noresize:_4.noresize,style:_4.style,date_format:_4.date_format};_6.get=this._generateGetFn(_4,_2);_6.formatter=this._generateFormatterFn(_4);_3.cells.push(_6);if(_6.field==this.sort_by){_3.sort_column=(this.is_desc)?((_5+1)*-1):(_5+1);}},this);return _3;},_generateFormatterFn:function(_7){var fn=bfree.api.CellDefinition.formatData;if(_7.column_name.indexOf("prp_bln")>=0){fn=bfree.api.CellDefinition.formatBoolean;}switch(_7.formatter){case bfree.api.CellDefinition.formats.icon:fn=bfree.api.CellDefinition.formatIcon;break;case bfree.api.CellDefinition.formats.size:fn=bfree.api.CellDefinition.formatSize;break;case bfree.api.CellDefinition.formats.status:fn=bfree.api.CellDefinition.formatStatus;break;}return fn;},_generateGetFn:function(_8,_9){var fn=null;switch(_8.table_name){case "versions":fn=dojo.hitch([this,_8],bfree.api.ViewDefinition._getVersionAttrFn);break;case "documents":fn=dojo.hitch([this,_8],bfree.api.ViewDefinition._getDocumentAttrFn);break;case "document_types":fn=dojo.hitch([this,_8,_9],bfree.api.ViewDefinition._getDocumentTypeAttrFn);break;}return fn;},_formatDateTime:function(_a,_b){return versa.api.Formatter.formatDateTime(_b);},getCellByField:function(_c){var _d=null;dojo.some(this.cell_definitions,function(_e,_f){if(bfree.api.CellDefinition.getDbName(_e)==_c){_d=_e;}return (_d);},this);return _d;},getView:function(_10){return this._generate(_10);},isValid:function(){var _11=true;if(String.isEmpty(this.name.trim())){_11=false;}if(String.isEmpty(this.sort_by)){_11=false;}return _11;},findColumn:function(_12,_13){for(var i=0;i<this.cell_definitions.length;i++){if(this.cell_definitions[i].table_name&&this.cell_definitions[i].column_name&&_12==this.cell_definitions[i].table_name&&_13==this.cell_definitions[i].column_name){return this.cell_definitions[i];}}return null;}});bfree.api.ViewDefinition.getCustomName=function(_14,_15){return dojo.replace("{0}.{1}",[_14.name,_15.name]);};bfree.api.ViewDefinition._getDocumentAttrFn=function(_16,_17){var _18="";var _19=this[0];var _1a=this[1];if(!_17){return _18;}var _1b=_1a.column_name;switch(_1b){case "created_at":case "updated_at":_18=_19._formatDateTime(_1a,_17[_1b]);break;default:if(/prp_dtt/.test(_1b)&&_17[_1b]){_18=_19._formatDateTime(_1a,_17[_1b]);}else{_18=_17[_1b];}break;}return _18;};bfree.api.ViewDefinition._getDocumentTypeAttrFn=function(_1c,_1d){var _1e="";var _1f=this[0];var _20=this[1];var _21=this[2];if((!_1d)){return _1e;}switch(_20.column_name){case "name":_1e=_1d.document_type_name;break;}return _1e;};bfree.api.ViewDefinition._getVersionAttrFn=function(_22,_23){var _24=null;var _25=this[0];var _26=this[1];if(!_23){return _24;}try{switch(_26.column_name){case "binary_content_type":_24=_23.binary_content_type;break;case "version_number":_24=_23.major_version_number;break;case "binary_file_size":_24=_23.binary_file_size;break;}}catch(e){}return (!_24)?"":_24;};bfree.api.ViewDefinition.compare=function(_27,_28){if((!_27)&&(_28)){return -1;}if((_27)&&(!_28)){return 1;}if((!_27)&&(!_28)){return 0;}if((!_27.name)&&(_28.name)){return -1;}if((_27.name)&&(!_28.name)){return 1;}if((!_27.name)&&(!_28.name)){return 0;}if(_27.name.toLowerCase()==_28.name.toLowerCase()){return 0;}return (_27.name.toLowerCase()<_28.name.toLowerCase())?-1:1;};bfree.api.ViewDefinition.schema={type:"object",properties:{"id":{type:"integer"},"name":{type:"string"},"description":{type:"string"},"is_desc":{type:"boolean","default":false},"is_template":{type:"boolean","default":false},"scope":{type:"string","default":"*"},"sort_by":{type:"string"},"cell_definitions":{type:"array","default":[],"items":{type:"object",properties:{"table_name":{type:"string"},"column_name":{type:"string"},"name":{type:"string"},"label":{type:"string"},"column_order":{type:"integer"},"formatter":{type:"integer"},"date_format":{type:"string"},"width":{type:"string"}}}},"created_at":{type:"date",format:"date-time"},"created_by":{type:"string","default":""},"updated_at":{type:"date",format:"date-time"},"updated_by":{type:"string","default":""}},prototype:bfree.api.ViewDefinition.prototype};}