/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.api.ViewDefinition"]){dojo._hasResource["bfree.api.ViewDefinition"]=true;dojo.provide("bfree.api.ViewDefinition");dojo.require("bfree.api._Object");dojo.require("bfree.api.Error");dojo.declare("bfree.api.ViewDefinition",[bfree.api._Object],{_view:null,constructor:function(_1){if(_1){dojo.safeMixin(this,_1);}},_generate:function(_2){var _3={name:this.name,id:this.id,sort_column:1,cells:[]};dojo.forEach(this.cell_definitions,function(_4,_5){var _6={field:dojo.replace("{table_name}.{column_name}",_4),name:String.isBlank(_4.label)?"&nbsp;":_4.label,width:_4.width,noresize:_4.noresize,style:_4.style,date_format:_4.date_format};_6.get=this._generateGetFn(_4,_2);_6.formatter=this._generateFormatterFn(_4);_3.cells.push(_6);if(_6.field==this.sort_by){_3.sort_column=_5+1;}},this);return _3;},_generateFormatterFn:function(_7){var fn=bfree.api.CellDefinition.formatData;switch(_7.formatter){case bfree.api.CellDefinition.formats.icon:fn=bfree.api.CellDefinition.formatIcon;break;case bfree.api.CellDefinition.formats.size:fn=bfree.api.CellDefinition.formatSize;break;case bfree.api.CellDefinition.formats.status:fn=bfree.api.CellDefinition.formatStatus;break;}return fn;},_generateGetFn:function(_8,_9){var fn=null;switch(_8.table_name){case "versions":fn=dojo.hitch([this,_8],bfree.api.ViewDefinition._getVersionAttrFn);break;case "documents":fn=dojo.hitch([this,_8],bfree.api.ViewDefinition._getDocumentAttrFn);break;case "document_types":fn=dojo.hitch([this,_8,_9],bfree.api.ViewDefinition._getDocumentTypeAttrFn);break;}return fn;},_formatDateTime:function(_a,_b){if(_a.date_format&&_a.date_format!=""){return dojo.date.locale.format(_b,{selector:"date",datePattern:_a.date_format});}else{return _b.toLocaleDateString();}},getView:function(_c){if(!this._view){this._view=this._generate(_c);}return this._view;},isValid:function(){var _d=true;if(String.isEmpty(this.name.trim())){_d=false;}if(String.isEmpty(this.sort_by)){_d=false;}return _d;}});bfree.api.ViewDefinition._getDocumentAttrFn=function(_e,_f){var _10="";var _11=this[0];var _12=this[1];if(!_f){return _10;}var _13=_12.column_name;switch(_13){case "created_at":case "updated_at":_10=_11._formatDateTime(_12,_f[_13]);break;default:if(/prp_dtt/.test(_13)&&_f[_13]){_10=dojo.date.stamp.fromISOString(_f[_13]);if(_10){_10=_11._formatDateTime(_12,_10);}}else{_10=_f[_13];}break;}return _10;};bfree.api.ViewDefinition._getDocumentTypeAttrFn=function(_14,_15){var _16="";var _17=this[0];var _18=this[1];var _19=this[2];if((!_15)||(!_15.document_type_id)){return _16;}var _1a=_19.getDocumentTypes().fetchById({id:_15.document_type_id});if(_1a){switch(_18.column_name){case "name":_16=_1a.name;break;}}else{_16=_15.document_type_id.toString();}return _16;};bfree.api.ViewDefinition._getVersionAttrFn=function(_1b,_1c){var _1d="";var _1e=this[0];var _1f=this[1];if(!_1c){return _1d;}switch(_1f.column_name){case "binary_content_type":_1d=((!_1c)||(!_1c.current_version))?"":_1c.current_version.binary_content_type;break;case "version_number":_1d=((!_1c)||(!_1c.current_version))?"0.0":_1c.getFullVersion();break;case "binary_file_size":_1d=((!_1c)||(!_1c.current_version))?0:_1c.current_version.binary_file_size;break;}return _1d;};bfree.api.ViewDefinition.compare=function(_20,_21){if((!_20)&&(_21)){return -1;}if((_20)&&(!_21)){return 1;}if((!_20)&&(!_21)){return 0;}if((!_20.name)&&(_21.name)){return -1;}if((_20.name)&&(!_21.name)){return 1;}if((!_20.name)&&(!_21.name)){return 0;}if(_20.name.toLowerCase()==_21.name.toLowerCase()){return 0;}return (_20.name.toLowerCase()<_21.name.toLowerCase())?-1:1;};bfree.api.ViewDefinition.schema={type:"object",properties:{"id":{type:"integer"},"name":{type:"string"},"description":{type:"string"},"scope":{type:"string","default":"*"},"sort_by":{type:"string"},"cell_definitions":{type:"array","default":[],"items":{type:"object",properties:{"table_name":{type:"string"},"column_name":{type:"string"},"name":{type:"string"},"label":{type:"string"},"column_order":{type:"integer"},"formatter":{type:"integer"},"date_format":{type:"string"},"width":{type:"string"}}}},"created_at":{type:"date",format:"date-time"},"created_by":{type:"string","default":""},"updated_at":{type:"date",format:"date-time"},"updated_by":{type:"string","default":""}},prototype:new bfree.api.ViewDefinition()};}