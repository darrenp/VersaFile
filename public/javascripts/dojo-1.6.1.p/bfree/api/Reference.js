/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.api.Reference"]){dojo._hasResource["bfree.api.Reference"]=true;dojo.provide("bfree.api.Reference");dojo.require("bfree.api._Object");dojo.require("bfree.api._Securable");dojo.require("bfree.api.Utilities");dojo.declare("bfree.api.Reference",[bfree.api._Object,bfree.api._Securable],{zone:null,library:null,constructor:function(_1){dojo.safeMixin(this,((!_1)?{}:_1));this.securable_type=bfree.api._Securable.types.Reference;},cancelCheckout:function(_2){var _3=_2.zone;var _4=_2.library;var _5=dojo.replace(bfree.api.Reference.XCKO_TRGT,[_3.subdomain,_4.id,this.getId()]);var _6={};var _7=bfree.api.XhrHelper.doPutAction({target:_5,putData:_6});return true;},checkin:function(_8){var _9=_8.zone;var _a=_8.library;var _b=dojo.replace(bfree.api.Reference.CKI_TRGT,[_9.subdomain,_a.id,this.getId()]);var _c=dojo.fromJson(dojox.json.ref.toJson(this,false,"",true));var _d=bfree.api.XhrHelper.doPutAction({target:_b,putData:_c});return true;},checkout:function(_e){var _f=_e.zone;var _10=_e.library;var url=dojo.replace(bfree.api.Reference.CKO_TRGT,[_f.subdomain,_10.id,this.getId()]);var _11={};var _12=bfree.api.XhrHelper.doPutAction({target:url,putData:_11});return true;},copyLocal:function(_13){var _14=_13.zone;var _15=_13.library;var url=(_13.version_id)?dojo.replace(bfree.api.Reference.CPV_TRGT,[_14.subdomain,_15.id,this.getId(),_13.version_id]):dojo.replace(bfree.api.Reference.CP_TRGT,[_14.subdomain,_15.id,this.getId()]);bfree.api.Utilities.saveUrl({url:url,window_name:"versa_save"});},file:function(_16){var _17=_16.zone;var _18=_16.library;var _19=_16.folder;var url=dojo.replace(bfree.api.Reference.FILE_TRGT,[_17.subdomain,_18.id,this.getId(),_19.getId()]);var _1a={};var _1b=bfree.api.XhrHelper.doPutAction({target:url,putData:_1a});_18.getReferences().store.onDelete(this);return true;},getPermissionSet:function(_1c,_1d,_1e){var _1f=new versa.api.PermissionSet();_1f.setValue(versa.api.PermissionIndices.VIEW,this.hasRights(bfree.api._Securable.permissions.VIEW));_1f.setValue(versa.api.PermissionIndices.COPY,this.hasRights(bfree.api._Securable.permissions.VIEW));_1f.setValue(versa.api.PermissionIndices.EDIT,this.hasRights(bfree.api._Securable.permissions.WRITE_METADATA));_1f.setValue(versa.api.PermissionIndices.MOVE,_1f.getValue(versa.api.PermissionIndices.EDIT));_1f.setValue(versa.api.PermissionIndices.CKO,(this.hasRights(bfree.api._Securable.permissions.VERSION)&&this.getState(bfree.api.Document.states.CHECKED_IN)));_1f.setValue(versa.api.PermissionIndices.CKI,(this.hasRights(bfree.api._Securable.permissions.VERSION)&&this.getState(bfree.api.Document.states.CHECKED_OUT)&&(this.checked_out_by==_1e.name)));_1f.setValue(versa.api.PermissionIndices.CANCEL_CKO,_1f.getValue(versa.api.PermissionIndices.CKI));_1f.setValue(versa.api.PermissionIndices.DELETE,this.hasRights(bfree.api._Securable.permissions.DELETE_ITEMS));_1f.setValue(versa.api.PermissionIndices.SECURE,this.hasRights(bfree.api._Securable.permissions.WRITE_ACL));_1f.setValue(versa.api.PermissionIndices.RESTORE,this.hasRights(bfree.api._Securable.permissions.DELETE_ITEMS));_1f.setValue(versa.api.PermissionIndices.DESTROY,this.hasRights(bfree.api._Securable.permissions.DELETE_ITEMS));return _1f;},getState:function(_20){return ((this.state&_20)==_20);},isDeleted:function(){return this.getState(bfree.api.Document.states.DELETED);},isShare:function(){return this.reference_type==bfree.api.Reference.types.SHARE;},restore:function(_21){var _22=_21.zone;var _23=_21.library;var url=dojo.replace(bfree.api.Reference.RESTORE_TRGT,[_22.subdomain,_23.getId(),this.getId()]);var _24={};var _25=bfree.api.XhrHelper.doPutAction({target:url,putData:_24});_23.getReferences().store.onDelete(this);return true;},share:function(_26){var _27=_26.zone;var _28=_26.library;var _29=_26.folder;var url=dojo.replace(bfree.api.Reference.SHARE_TRGT,[_27.subdomain,_28.id,this.getId(),_29.getId()]);var _2a={};var _2b=bfree.api.XhrHelper.doPutAction({target:url,putData:_2a});return true;},unshare:function(_2c){var _2d=_2c.zone;var _2e=_2c.library;var url=dojo.replace(bfree.api.Reference.UNSHARE_TRGT,[_2d.subdomain,_2e.id,this.getId()]);var _2f={};var _30=bfree.api.XhrHelper.doPutAction({target:url,putData:_2f});_2e.getReferences().store.onDelete(this);return true;},view:function(_31){var _32=_31.zone;var _33=_31.library;var url=(_31.version_id)?dojo.replace(bfree.api.Reference.VWV_TRGT,[_32.subdomain,_33.id,this.getId(),_31.version_id]):dojo.replace(bfree.api.Reference.VW_TRGT,[_32.subdomain,_33.id,this.getId()]);bfree.api.Utilities.viewUrl({windowBox:_31.windowBox,url:url,window_name:"versa_viewer"});}});bfree.api.Reference.VW_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=inline";bfree.api.Reference.VWV_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=inline&version_id={3}";bfree.api.Reference.CP_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=attachment";bfree.api.Reference.CPV_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=attachment&version_id={3}";bfree.api.Reference.CKO_TRGT="/zones/{0}/libraries/{1}/references/{2}/checkout.json";bfree.api.Reference.CKI_TRGT="/zones/{0}/libraries/{1}/references/{2}/checkin.json";bfree.api.Reference.XCKO_TRGT="/zones/{0}/libraries/{1}/references/{2}/cancel_checkout.json";bfree.api.Reference.FILE_TRGT="/zones/{0}/libraries/{1}/references/{2}/file.json?folder_id={3}";bfree.api.Reference.SHARE_TRGT="/zones/{0}/libraries/{1}/references/{2}/share.json?folder_id={3}";bfree.api.Reference.UNSHARE_TRGT="/zones/{0}/libraries/{1}/references/{2}/unshare.json?";bfree.api.Reference.RESTORE_TRGT="/zones/{0}/libraries/{1}/references/{2}/restore.json";bfree.api.Reference.types={"CONTENT":0,"SHARE":17,"TRASH":18};bfree.api.Reference.schema={type:"object",properties:{"id":{type:"integer"},"reference_type":{type:"integer"},"state":{type:"integer","default":bfree.api.Document.states.PENDING}},prototype:new bfree.api.Reference()};}