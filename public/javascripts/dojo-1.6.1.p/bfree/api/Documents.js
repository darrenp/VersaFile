/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.api.Documents"]){dojo._hasResource["bfree.api.Documents"]=true;dojo.provide("bfree.api.Documents");dojo.require("bfree.api._Collection");dojo.require("bfree.api.Document");dojo.require("bfree.api.Utilities");dojo.declare("bfree.api.Documents",[bfree.api._Collection],{library:null,_isUpdateable:function(_1){return false;},_matchesQuery:function(_2,_3){return false;var _4=_3.query;var _5=_3.queryOptions&&_3.queryOptions.ignoreCase;for(var i in _4){var _6=_4[i];var _7=this.getValue(_2,i);if((typeof _6=="string"&&(_6.match(/[\*\.]/)||_5))?!dojo.data.util.filter.patternToRegExp(_6,_5).test(_7):_7!=_6){return false;}}return true;},constructor:function(_8){if(_8){dojo.safeMixin(this,_8);}this.zone=_8.zone;this.library=_8.library;this.target=dojo.replace(bfree.api.Documents.TRGT,[this.zone.subdomain,this.library.id]);this.schema=bfree.api.Document.schema;this.cache=false;this._initialize();this.store.isUpdateable=dojo.hitch(this,this._isUpdateable);},destroy:function(_9){var _a=_9.document;try{this.inherited(arguments);}catch(e){this.reload({item:_a});throw e;}},export_query:function(_b){var _c=dojo.objectToQuery(_b.query);var _d=dojo.replace("sort({0}{1})",[(_b.sort.descending?"-":"+"),encodeURIComponent(_b.sort.attribute)]);var _e="json";switch(_b.type){case bfree.api.Documents.ExportTypes.CSV:_e="csv";break;case bfree.api.Documents.ExportTypes.PDF:_e="pdf";break;case bfree.api.Documents.ExportTypes.XML:_e="xml";break;}var _f=dojo.replace(bfree.api.Documents.EXPORT_TRGT,[_b.zone.subdomain,_b.library.id,_c,_d,_e]);if(_b.type==bfree.api.Documents.ExportTypes.PDF){bfree.api.Utilities.viewUrl({windowBox:_b.windowBox,url:_f,window_name:"versa_save"});}else{bfree.api.Utilities.saveUrl({url:_f,window_name:"versa_save"});}},print_query:function(_10){var _11=dojo.objectToQuery(_10.query);var _12=dojo.replace("sort({0}{1})",[(_10.sort.descending?"-":"+"),encodeURIComponent(_10.sort.attribute)]);var url=dojo.replace(bfree.api.Documents.EXPORT_TRGT,[_10.zone.subdomain,_10.library.id,_11,_12,"html"]);bfree.api.Utilities.viewUrl({windowBox:_10.windowBox,url:url,window_name:"versa_printer"});}});bfree.api.Documents.States={pending:0,checked_in:1,checked_out:2,busy:16384,deleted:32768};bfree.api.Documents.ExportTypes={"NONE":0,"CSV":1,"PDF":2,"XML":3};bfree.api.Documents.TRGT="/zones/{0}/libraries/{1}/documents";bfree.api.Documents.PRINT_TRGT="/zones/{0}/libraries/{1}/documents?{2}&{3}";bfree.api.Documents.EXPORT_TRGT="/zones/{0}/libraries/{1}/documents.{4}?{2}&{3}";bfree.api.Documents.isCheckedOut=function(_13){var _14;if(_13.document){_14=_13.document.state;}else{if(_13.state){_14=_13.state;}}return ((_14&bfree.api.Documents.States.checked_out)>0);};bfree.api.Documents.isBusy=function(_15){return ((_15.state&bfree.api.Documents.States.busy)>0);};}