/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


var dropbox={};dropbox.consumerKey="utjo1v2e4xal91h";dropbox.consumerSecret="q5eyeavqrg74sws";dropbox.prefix="app_";dropbox.accessType="sandbox";dropbox.authHTML5=true;dropbox.cache=true;dropbox.authCallback="";dropbox.fileLimit=10000;dropbox.cookieTime=3650;document.write("<script type='text/javascript' src='/javascripts/dojo-1.6.1.d/bfree/oauth.js'></script>");document.write("<script type='text/javascript' src='/javascripts/dojo-1.6.1.d/bfree/sha1.js'></script>");if(dropbox.authHTML5==true){temp=localStorage.getItem(dropbox.prefix+"requestToken");if(temp){dropbox.requestToken=temp;}temp=localStorage.getItem(dropbox.prefix+"requestTokenSecret");if(temp){dropbox.requestTokenSecret=temp;}temp=localStorage.getItem(dropbox.prefix+"accessToken");if(temp){dropbox.accessToken=temp;}temp=localStorage.getItem(dropbox.prefix+"accessTokenSecret");if(temp){dropbox.accessTokenSecret=temp;}}else{cookies=document.cookie;cookies=cookies.split(";");for(i in cookies){c=cookies[i];while(c.charAt(0)==" "){c=c.substring(1);}c=c.split("=");switch(c[0]){case dropbox.prefix+"requestToken":dropbox.requestToken=c[1];break;case dropbox.prefix+"requestTokenSecret":dropbox.requestTokenSecret=c[1];break;case dropbox.prefix+"accessToken":dropbox.accessToken=c[1];break;case dropbox.prefix+"accessTokenSecret":dropbox.accessTokenSecret=c[1];break;}}dropbox.cookieExpire=new Date();dropbox.cookieExpire.setDate(dropbox.cookieExpire.getDate()+dropbox.cookieTime);dropbox.cookieExpire=dropbox.cookieExpire.toUTCString();}dropbox.setup=function(){if(!dropbox.accessToken||!dropbox.accessTokenSecret){if(!dropbox.requestToken||!dropbox.requestTokenSecret){dropbox.oauthReqeust({url:"http://api.getdropbox.com/0/oauth/request_token",type:"text",token:true,tokenSecret:true},[],function(_1){_1=_1.split("&");dataArray=new Array();for(i in _1){dataTemp=_1[i].split("=");dataArray[dataTemp[0]]=dataTemp[1];}dropbox.storeData("requestToken",dataArray["oauth_token"]);dropbox.storeData("requestTokenSecret",dataArray["oauth_token_secret"]);document.location="http://api.getdropbox.com/0/oauth/authorize?oauth_token="+dataArray["oauth_token"]+"&oauth_callback="+dropbox.authCallback;});}else{dropbox.oauthReqeust({url:"http://api.getdropbox.com/0/oauth/access_token",type:"text",token:dropbox.requestToken,tokenSecret:dropbox.requestTokenSecret},[],function(_2){_2=_2.split("&");dataArray=new Array();for(i in _2){dataTemp=_2[i].split("=");dataArray[dataTemp[0]]=dataTemp[1];}dropbox.storeData("accessToken",dataArray["oauth_token"]);dropbox.storeData("accessTokenSecret",dataArray["oauth_token_secret"]);dropbox.accessToken=dataArray["oauth_token"];dropbox.accessTokenSecret=dataArray["oauth_token_secret"];});}}};dropbox.buildOathRequest=function(_3,_4){if(!_3.token){_3.token=dropbox.accessToken;}if(!_3.tokenSecret){_3.tokenSecret=dropbox.accessTokenSecret;}if(!_3.type){_3.type="json";}if(!_3.method){_3.method="GET";}accessor={consumerSecret:dropbox.consumerSecret,};message={action:_3.url,method:_3.method,parameters:[["oauth_consumer_key",dropbox.consumerKey],["oauth_signature_method","PLAINTEXT"]]};if(_3.token!=true){message.parameters.push(["oauth_token",_3.token]);}if(_3.tokenSecret!=true){accessor.tokenSecret=_3.tokenSecret;}for(i in _4){message.parameters.push(_4[i]);}OAuth.setTimestampAndNonce(message);OAuth.SignatureMethod.sign(message,accessor);return message.action+"?"+dojo.objectToQuery(OAuth.getParameterMap(message.parameters));};dropbox.oauthReqeust=function(_5,_6,_7){if(!_5.token){_5.token=dropbox.accessToken;}if(!_5.tokenSecret){_5.tokenSecret=dropbox.accessTokenSecret;}if(!_5.type){_5.type="json";}if(!_5.method){_5.method="GET";}accessor={consumerSecret:dropbox.consumerSecret,};message={action:_5.url,method:_5.method,parameters:[["oauth_consumer_key",dropbox.consumerKey],["oauth_signature_method","PLAINTEXT"]]};if(_5.token!=true){message.parameters.push(["oauth_token",_5.token]);}if(_5.tokenSecret!=true){accessor.tokenSecret=_5.tokenSecret;}for(i in _6){message.parameters.push(_6[i]);}OAuth.setTimestampAndNonce(message);OAuth.SignatureMethod.sign(message,accessor);if(dojo.isIE){var _8=new XDomainRequest();_8.open(message.method,message.action+"?"+dojo.objectToQuery(OAuth.getParameterMap(message.parameters)));_8.onload=function(){var _9=dojo.fromJson(_8.responseText);if(_9==null||typeof (_9)=="undefined"){_9=dojo.fromJson(data.firstChild.textContent);}_7(_9);};_8.send();}else{dojo.xhrGet({url:message.action,type:message.method,content:OAuth.getParameterMap(message.parameters),handleAs:_5.type,headers:{"X-Requested-With":null},load:function(_a){_7(_a);},error:function(a,b,c){alert("Error");}});}};dropbox.storeData=function(_b,_c){_c=escape(_c);if(dropbox.authHTML5==true){localStorage.setItem(dropbox.prefix+_b,_c);}else{document.cookie=dropbox.prefix+_b+"="+_c+"; expires="+dropbox.cookieExpire+"; path=/";}};dropbox.getData=function(_d){if(dropbox.authHTML5==true){return unescape(localStorage.getItem(dropbox.prefix+_d));}else{cookies=document.cookie;cookies=cookies.split(";");for(i in cookies){c=cookies[i];while(c.charAt(0)==" "){c=c.substring(1);}c=c.split("=");if(c[0]==dropbox.prefix+_d){return unescape(c[1]);}}}};dropbox.getAccount=function(_e){dropbox.oauthReqeust({url:"http://api.dropbox.com/0/account/info"},[],function(_f){_e(_f);});};dropbox.getMetadata=function(_10,_11){dropbox.oauthReqeust({url:"https://api.dropbox.com/1/metadata/"+dropbox.accessType+"/"+_10},[["list","true"]],function(_12){_11(_12);});};dropbox.getFolderContents=function(_13,_14){if(dropbox.cache==true){hash=dropbox.getData("cache."+_13);if(hash!="null"){hash=jQuery.parseJSON(hash).hash;}else{hash="00000000000000000000000000000000";}}else{hash="00000000000000000000000000000000";}dropbox.oauthReqeust({url:"http://api.dropbox.com/0/metadata/"+dropbox.accessType+"/"+_13,type:"text"},[["list","true"],["status_in_response","true"],["hash",hash]],function(_15){if(dropbox.cache==true){if(jQuery.parseJSON(_15).status==304){_15=dropbox.getData("cache."+_13);}else{_15=_15.substr(1);while(_15.charAt(0)!="{"){_15=_15.substr(1);}_15=_15.substr(0,_15.length-1);while(_15.charAt(_15.length-1)!="}"){_15=_15.substr(0,_15.length-1);}dropbox.storeData("cache."+_13,_15);}}_15=jQuery.parseJSON(_15);_14(_15);});};dropbox.getFile=function(_16,_17){dropbox.oauthReqeust({url:escape("http://api-content.dropbox.com/1/files/"+dropbox.accessType+"/"+_16),type:"text"},[],function(_18){_17(_18);});},dropbox.getFileURL=function(_19){return dropbox.buildOathRequest({url:"https://api-content.dropbox.com/1/files/"+dropbox.accessType+"/"+_19,type:"text"},[]);},dropbox.getFile=function(_1a,to,_1b){dropbox.oauthReqeust({url:"http://api.dropbox.com/0/fileops/move"},[["from_path",_1a],["to_path",to],["root",dropbox.accessType]],function(_1c){_1b(_1c);});};dropbox.copyItem=function(_1d,to,_1e){dropbox.oauthReqeust({url:"http://api.dropbox.com/0/fileops/copy"},[["from_path",_1d],["to_path",to],["root",dropbox.accessType]],function(_1f){_1e(_1f);});};dropbox.deleteItem=function(_20,_21){dropbox.oauthReqeust({url:"http://api.dropbox.com/0/fileops/delete",type:"text"},[["path",_20],["root",dropbox.accessType]],function(_22){_21(_22);});};dropbox.deleteItem=function(_23,_24){dropbox.oauthReqeust({url:"http://api.dropbox.com/0/fileops/create_folder"},[["path",_23],["root",dropbox.accessType]],function(_25){_24(_25);});},dropbox.media=function(_26,_27){dropbox.oauthReqeust({url:"https://api.dropbox.com/1/media/"+dropbox.accessType+"/"+_26,type:"json"},[],_27);},dropbox.getThumbnail=function(_28,_29){if(_29!="small"&&_29!="medium"&&_29!="large"){_29="small";}dropbox.oauthReqeust({url:escape("http://api-content.dropbox.com/0/thumbnails/"+dropbox.accessType+"/"+_28),type:"text"},[["size",_29]],function(_2a){callback(_2a);});};dropbox.uploadFile=function(_2b,_2c){dropbox.oauthReqeust({url:escape("http://api-content.dropbox.com/0/files/"+dropbox.accessType+"/"+_2b),type:"text",method:"POST"},[["file",_2c]],function(_2d){callback(_2d);});};