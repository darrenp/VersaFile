/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.folder.ContextMenu"]){dojo._hasResource["bfree.widget.folder.ContextMenu"]=true;dojo.provide("bfree.widget.folder.ContextMenu");dojo.require("bfree.widget.Bfree");dojo.require("bfree.widget.HeaderMenu");dojo.require("dijit.MenuSeparator");dojo.declare("bfree.widget.folder.ContextMenu",bfree.widget.HeaderMenu,{_btnFldCreate:null,_btnFldEdit:null,_btnFldDelete:null,_btnFldACL:null,_btnDocCreate:null,menuLabel:"Folder",activeLibrary:null,activeNode:null,activeUser:null,tree:null,_onCommand:function(_1,_2){this.onCommand(_1,_2,{folder:this.activeNode.item});},_openMyself:function(_3){if(this.activeNode.declaredClass=="bfree.widget.folder.Tree"){return;}if(!this.activeNode){return;}if(this.activeNode.item.is_trash||this.activeNode.item.is_search){return;}this._setState();this.inherited("_openMyself",arguments);},_setActiveNodeAttr:function(_4){this.activeNode=_4;},_setState:function(){var _5=bfree.api.Folder.getPermissionSet(this.activeNode.item,this.activeLibrary,this.activeUser);this._btnFldEdit.set("disabled",!_5[bfree.api.Folder.permissionIndices.EDIT]);this._btnFldDelete.set("disabled",!_5[bfree.api.Folder.permissionIndices.DELETE]);this._btnFldACL.set("disabled",!_5[bfree.api.Folder.permissionIndices.SECURE]);this._btnFldCreate.set("disabled",!_5[bfree.api.Folder.permissionIndices.CREATE]);this._btnDocCreate.set("disabled",!_5[bfree.api.Folder.permissionIndices.FILE]);},constructor:function(_6){dojo.safeMixin(this,_6);},onCommand:function(_7,_8){},onHide:function(){this.inherited("onHide",arguments);this.activeNode=null;},_onOpen:function(_9){this.tree.model.store.loadItem({item:this.activeNode.item,scope:this});},postCreate:function(){this.inherited("postCreate",arguments);this._btnFldEdit=new dijit.MenuItem({label:"Edit Folder",disabled:true,iconClass:"menuIcon bfreeIconEditFolder",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.EDIT,bfree.widget.Bfree.ObjectTypes.FOLDER)});this.addChild(this._btnFldEdit);this._btnFldDelete=new dijit.MenuItem({label:"Delete Folder",disabled:true,iconClass:"menuIcon bfreeIconDeleteFolder",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.DELETE,bfree.widget.Bfree.ObjectTypes.FOLDER)});this.addChild(this._btnFldDelete);this.addChild(new dijit.MenuSeparator());var _a=new dijit.Menu({});this._btnDocCreate=new dijit.MenuItem({label:"Document",iconClass:"menuIcon bfreeIconNewDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.NEW,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});_a.addChild(this._btnDocCreate);this._btnFldCreate=new dijit.MenuItem({label:"Folder",iconClass:"menuIcon bfreeIconNewFolder",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.NEW,bfree.widget.Bfree.ObjectTypes.Folder)});_a.addChild(this._btnFldCreate);this.addChild(new dijit.PopupMenuItem({label:"New",popup:_a,iconClass:"menuIcon bfreeIconNewSubFolder"}));this.addChild(new dijit.MenuSeparator());this._btnFldACL=new dijit.MenuItem({label:"Permissions...",disabled:true,iconClass:"menuIcon bfreeIconSecureFolder",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.SECURE,bfree.widget.Bfree.ObjectTypes.FOLDER)});this.addChild(this._btnFldACL);dojo.connect(this,"onOpen",this,this._onOpen);},startup:function(){this.inherited("startup",arguments);}});}