/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget._EditTree"]){dojo._hasResource["bfree.widget._EditTree"]=true;dojo.provide("bfree.widget._EditTree");dojo.require("dijit.Tree");dojo.require("dijit.InlineEditBox");dojo.declare("bfree.widget._TreeNode",dijit._TreeNode,{_editor:null,__sortItems:function(_1,_2){return _1.name-_2.name;},postCreate:function(){this.inherited("postCreate",arguments);},_onClick:function(_3){if(this.tree._isEditing){return;}this.inherited("_onClick",arguments);},edit:function(_4){this._createEditor(_4);this._editor.edit();this.tree.setEditing(true);setTimeout(dojo.hitch(this,function(){this._editor.wrapperWidget.editWidget.domNode.focus();}),100);},_onFocus:function(){},_editor_onCancel:function(){var _5=(this.node.item.id==null);var _6=this.tree.model.store.labelAttribute;this.node.labelNode.innerHTML=this.tree.model.store.getValue(this.node.item,_6);this.tree.setEditing(false);this.tree.model.store.revert();if(_5){this.tree.onNewCancel(this.node);}this.tree.setEditing(false);},_editor_onChange:function(_7){var _8=this.tree.model.store.labelAttribute;this.tree.model.store.setValue(this.node.item,"name",_7);var _9=(this.node.item.id==null);this.tree.model.store.save({alwaysPostNewItems:true});this.tree.setEditing(false);node=this.node;this.destroy();node.set("label",_7);if(_9){this.tree.onNew(this.node);}else{this.tree.onUpdate(this.node);}this.tree.setEditing(false);var _a=this.node.getParent();_a.item.children.sort(bfree.widget._TreeNode.compare);_a.setChildItems(_a.item.children);},_createEditor:function(_b){var _c=document.createElement("span");_c.innerHTML=this.label;this.labelNode.innerHTML="";this.labelNode.appendChild(_c);var nc=dojo.coords(this.labelNode);var tc=dojo.coords(this.tree.domNode);this._editor=new dijit.InlineEditBox({intermediateChanges:false,tree:this.tree,node:this,autoSave:true,onChange:this._editor_onChange,onCancel:this._editor_onCancel,width:(tc.w-nc.l-10)+"px",value:_b},_c);this._editor.startup();}});bfree.widget._TreeNode.compare=function(_d,_e){if(_d.name.toLowerCase()==_e.name.toLowerCase()){return 0;}return (_d.name.toLowerCase()<_e.name.toLowerCase())?-1:1;};dojo.declare("bfree.widget._EditTree",[dijit.Tree],{_onSelectedItem:function(_f){var _10=this.getNodesByItem(_f);dojo.forEach(_10,function(_11){this.onSelected(_f,_11);},this);},onClick:function(_12,_13,evt){this.model.store.loadItem({item:_12,scope:this,onItem:this._onSelectedItem});},onSelected:function(_14,_15){},startup:function(){this.inherited("startup",arguments);}});}