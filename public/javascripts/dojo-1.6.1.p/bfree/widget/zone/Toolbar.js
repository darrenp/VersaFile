/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.zone.Toolbar"]){dojo._hasResource["bfree.widget.zone.Toolbar"]=true;dojo.provide("bfree.widget.zone.Toolbar");dojo.require("bfree.widget.zone.AdminMenu");dojo.require("bfree.widget.zone.ExportMenu");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.form.DropDownButton");dojo.declare("bfree.widget.zone.Toolbar",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("bfree.widget.zone","template/Toolbar.html","<div style=\"width:100%;height:30px;\">\n    <div dojoAttachPoint=\"buttonsNode\" style=\"padding: 0 0 0 8px;position:relative\"></div>\n</div>\n"),_btnExport:null,_btnNew:null,_mniDocument:null,_mniFolder:null,_mnuNewItems:null,activeItems:null,activeFolder:null,activeLibrary:null,activeUser:null,_onCommand:function(_1,_2,e){this.onCommand(_1,_2,{document:this.activeDocument,folder:this.activeFolder});},_setActiveFolderAttr:function(_3){this.activeFolder=_3;this._setState();},_setActiveItemsAttr:function(_4){this.activeItems=_4;this._setState();},_setState:function(){var _5=(this.activeFolder)?(this.activeFolder.document_count>0):false;var _6=true;var _7=true;if(this.activeFolder){var _8=bfree.api.Folder.getPermissionSet(this.activeFolder,this.activeLibrary,this.activeUser);_6=_8[bfree.api.Folder.permissionIndices.CREATE];_7=_8[bfree.api.Folder.permissionIndices.FILE];}this._mniDocument.set("disabled",!_7);this._mniFolder.set("disabled",!_6);this._btnNew.set("disabled",!(_7||_6));this._btnExport.set("disabled",!_5);},clear:function(){this.activeFolder=null;this.activeItems=null;},constructor:function(_9){},onCommand:function(_a,_b,_c){},postCreate:function(){this.inherited("postCreate",arguments);if(this.library.hasRights(bfree.api._Securable.permissions.WRITE_METADATA)){this._btnAdmin=new dijit.form.DropDownButton({label:"Administration",showLabel:true,scrollOnFocus:false,dropDown:new bfree.widget.zone.AdminMenu({activeUser:this.activeUser,zone:this.zone,onCommand:dojo.hitch(this,this._onCommand)})});this._btnAdmin.placeAt(this.buttonsNode);}this._mnuNewItems=new dijit.Menu();this._mniFolder=new dijit.MenuItem({label:"Folder",iconClass:"menuIcon bfreeIconFolder",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.NEW,bfree.widget.Bfree.ObjectTypes.FOLDER)});this._mnuNewItems.addChild(this._mniFolder);this._mniDocument=new dijit.MenuItem({label:"Document(s)",iconClass:"menuIcon bfreeIconDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.NEW,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this._mnuNewItems.addChild(this._mniDocument);this._btnNew=new dijit.form.DropDownButton({label:"Add New...",showLabel:true,scrollOnFocus:false,dropDown:this._mnuNewItems});this._btnNew.placeAt(this.buttonsNode);this._btnExport=new dijit.form.DropDownButton({label:"Print/Export",showLabel:true,scrollOnFocus:false,dropDown:new bfree.widget.zone.ExportMenu({activeUser:this.user,zone:this.zone,onCommand:dojo.hitch(this,this._onCommand)}),style:"position:absolute;top:0;right:8px;"});this._btnExport.placeAt(this.buttonsNode);this.activeUser=this.user;this.activeLibrary=this.library;},startup:function(){this.inherited("startup",arguments);}});}