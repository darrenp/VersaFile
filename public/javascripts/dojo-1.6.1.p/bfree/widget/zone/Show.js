/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.zone.Show"]){dojo._hasResource["bfree.widget.zone.Show"]=true;dojo.provide("bfree.widget.zone.Show");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.require("bfree.widget.Bfree");dojo.require("bfree.widget.Dialog");dojo.require("bfree.widget.ErrorManager");dojo.require("bfree.widget.acl.Editor");dojo.require("bfree.widget.choiceList.Administration");dojo.require("bfree.widget.document.Accessor");dojo.require("bfree.widget.document.version.Accessor");dojo.require("bfree.widget.document.Grid");dojo.require("bfree.widget.document.Checkin");dojo.require("bfree.widget.document.Creator");dojo.require("bfree.widget.document.Move");dojo.require("bfree.widget.document.PropertyEditor");dojo.require("bfree.widget.document.version.Versions");dojo.require("bfree.widget.folder.Tree");dojo.require("bfree.widget.group.Administration");dojo.require("bfree.widget.doctype.Administration");dojo.require("bfree.widget.propdef.Administration");dojo.require("bfree.widget.search.TextBox");dojo.require("bfree.widget.user.ProfileButton");dojo.require("bfree.widget.user.ProfileEditor");dojo.require("bfree.widget.user.Administration");dojo.require("bfree.widget.view.Administration");dojo.require("bfree.widget.zone.CommandBar");dojo.require("bfree.widget.zone.ReLogon");dojo.require("bfree.widget.zone.Toolbar");dojo.require("bfree.widget.folder.DndSource");dojo.require("bfree.widget.ItemInfo");dojo.require("versa.widget.zone.metrics.Info");dojo.require("versa.VersaFile");dojo.declare("bfree.widget.zone.Show",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("bfree.widget.zone","template/Show.html","<div style=\"background:#D9D9D6;height:100%;width:100%;\">\n\n<div    dojoType=\"dijit.layout.BorderContainer\"\n        design=\"headline\"\n        gutters=\"false\"\n        style=\"height:100%;width:100%;\">\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"center\"\n            spitter=\"false\"\n            style=\"padding:8px 8px 0 8px\">\n\n        <div    dojoType=\"dijit.layout.BorderContainer\"\n                design=\"headline\"\n                gutters=\"false\"\n                style=\"height:100%;width:100%\">\n\n            <div    dojoType=\"dijit.layout.BorderContainer\"\n                    design=\"sidebar\"\n                    gutters=\"false\"\n                    region=\"top\"\n                    splitter=\"false\"\n                    class=\"versaTopPane\">\n\n                <div    dojoType=\"dijit.layout.ContentPane\"\n                        region=\"left\"\n                        splitter=\"false\"\n                        class=\"versaHeadPane\">\n                    <img src=\"/images/versafile-64-tm.png\" height=\"56\" style=\"position:relative;top:-8px;left:0\"/>\n                </div>\n\n                <div    dojoType=\"dijit.layout.BorderContainer\"\n                        design=\"sidebar\"\n                        gutters=\"false\"\n                        region=\"center\"\n                        class=\"versaBarPane\">\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            region=\"center\"\n                            splitter=\"false\"\n                            style=\"padding:0;overflow:hidden;position:relative;\">\n\n                        <div    dojoAttachPoint=\"trialStateNode\"\n                                style=\"display:none;margin-left:auto;margin-right:auto;text-align: center\">\n                            <span dojoAttachPoint=\"trialMsgNode\" class=\"dijitMediumLabel dijitDarkLabelV\" style=\"display:inline-block\"></span>\n                            <span dojoAttachPoint=\"activateMsgNode\" class=\"dijitMediumLabel dijitDarkLabelV\" style=\"display:inline-block\"></span>\n                        </div>\n\n                        <div dojoAttachPoint=\"toolbarNode\"></div>\n\n                    </div>\n\n                    <div    dojoType=\"dijit.layout.BorderContainer\"\n                            design=\"headline\"\n                            gutters=\"false\"\n                            region=\"right\"\n                            splitter=\"false\"\n                            style=\"width:256px;\">\n\n                        <div    dojoType=\"dijit.layout.ContentPane\"\n                                region=\"center\"\n                                splitter=\"false\"\n                                style=\"position:relative;text-align:right;padding:2px 0 0 0\">\n\n                            <table cellpadding=\"0\" cellspacing=\"0\" style=\"position:absolute;right:0\"><tr>\n                                <td  style=\"padding-right:4px; border-right: 1px solid #75787B\">\n                                    <a href=\"javascript://\" class=\"versaLink\" title=\"Edit Profile\" dojoAttachEvent=\"onclick: _onUserEdit\">\n                                    <span  dojoAttachPoint=\"nameNode\"></span>\n                                    </a>\n                                </td>\n                                <td style=\"padding-left:4px;\"><a href=\"javascript://\" class=\"versaLink\" dojoAttachEvent=\"onclick: _onLogoff\">Logout</a></td>\n                            </tr>\n                            </table>\n\n                        </div>\n\n                        <div    dojoType=\"dijit.layout.ContentPane\"\n                                region=\"bottom\"\n                                splitter=\"false\"\n                                style=\"height:32px;padding:0;\">\n                            <div dojoAttachPoint=\"searchBoxNode\" style=\"\"></div>\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n            <div    dojoType=\"dijit.layout.BorderContainer\"\n                    design=\"headline\"\n                    gutters=\"false\"\n                    region=\"center\"\n                    splitter=\"false\"\n                    class=\"versaMainPane\">\n\n                <div    dojoType=\"dijit.layout.BorderContainer\"\n                        design=\"sidebar\"\n                        gutters=\"true\"\n                        region=\"center\"\n                        splitter=\"false\"\n                        class=\"\">\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            dojoAttachPoint=\"folderPane\"\n                            region=\"left\"\n                            splitter=\"true\"\n                            class=\"versaInfoPane\"\n                            style=\"padding:0;width:256px;\">\n\n                        <div style=\"height: 100%\">\n                           <div dojoAttachPoint=\"folderTreeNode\" style=\"height: 100%\"></div>\n                       </div>\n\n                    </div>\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            dojoAttachPoint=\"contentPane\"\n                            region=\"center\"\n                            splitter=\"true\"\n                            class=\"versaInfoPane\"\n                            style=\"padding:0\">\n\n                        <div dojoAttachPoint=\"documentGridNode\"></div>\n\n                    </div>\n\n                </div>\n\n                <div    dojoType=\"dijit.layout.ContentPane\"\n                        region=\"bottom\"\n                        splitter=\"false\"\n                        style=\"height:96px;padding: 0 6px 8px 6px\">\n\n                   <div style=\"height:100%\" class=\"versaInfoPane\">\n                       <div dojoAttachPoint=\"itemInfoNode\" style=\"width: 100%\"></div>\n                   </div>\n\n                </div>\n\n            </div>\n\n\n        </div>\n\n    </div>\n\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"bottom\"\n            splitter=\"false\"\n            style=\"position:relative;height:16px;overflow:hidden;\">\n\n        <span class=\"dijitMediumLabel dijitDarkLabelV\">VersaFile is an RKO Business Solutions product. Copyright Â© 2012 All rights reserved.</span>\n\n        <span style=\"position:absolute;right:16px;\">\n            <span dojoAttachPoint=\"versionSpan\" class=\"dijitMediumLabel dijitDarkLabelV\"></span>\n            <a href=\"mailto:support@versafile.com\" class=\"versaLink\">Contact Support</a>\n        </span>\n\n    </div>\n\n</div>\n\n</div>\n\n\n\n"),widgetsInTemplate:true,_duration:60000,_btnAvatar:null,_cmdBar:null,_grdDocuments:null,activeDocuments:[],activeFolder:null,activeGroup:null,activeLibrary:null,activeType:bfree.widget.Bfree.ObjectTypes.FOLDER,activeUser:null,zone:null,folders:null,__doAction:function(_1,_2,_3){var _4=-1;if((_1==null)||(_1.length<1)){return;}try{dojo.forEach(_1,function(_5,_6){this._grdDocuments.setBusy(_5,true);},this);_4=this._grdDocuments.getItemIndex(_1[0]);this._grdDocuments.beginUpdate();dojo.forEach(_1,function(_7,_8){try{_2(_7);}catch(e){_3(_7,e);if(e.status==404){this._grdDocuments.store.onDelete(_7);}}},this);}finally{this._grdDocuments.endUpdate();dojo.forEach(_1,function(_9,_a){this._grdDocuments.setBusy(_9,false);},this);this._grdDocuments.selectItems(_1,_4);}},__doDialog:function(_b,_c,_d,_e){var _f=-1;if((_b==null)||(_b.length<1)){return;}function _10(_11,_12){var _13=false;if(_d(_11,_12)){this._grdDocuments.endUpdate();dojo.forEach(_12,function(_14,idx){this._grdDocuments.setBusy(_14,false);},this);this._grdDocuments.selectItems(_12,_f);_13=true;}return _13;};try{dojo.forEach(_b,function(_15,idx){this._grdDocuments.setBusy(_15,true);},this);_f=this._grdDocuments.getItemIndex(_b[0]);this._grdDocuments.beginUpdate();_c({zone:this.zone,user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,folder:this.activeFolder,items:_b,onClose:dojo.hitch(this,_10)});}catch(e){this._grdDocuments.endUpdate();_e(_b,e);dojo.forEach(_b,function(_16,idx){this._grdDocuments.setBusy(_16,false);},this);this._grdDocuments.selectItems(_b,_f);}},__onDocumentLoad:function(_17){if(this.activeType==bfree.widget.Bfree.ObjectTypes.DOCUMENT){this._wdgItemInfo.loadItem({item:_17});}},__onDocumentLoadError:function(_18,e){var _19=false;var err=new bfree.api.Error(dojo.replace("Failed to retrieve document '{0}'",[_18.name]),e);bfree.widget.ErrorManager.handleError({error:err});if(e.status==404){_19=true;this._grdDocuments.store.onDelete(_18);}this._wdgItemInfo.errorItem({item:_18,isDeleted:_19});},__onFolderLoad:function(_1a){if(this.activeType==bfree.widget.Bfree.ObjectTypes.FOLDER){this._wdgItemInfo.loadItem({item:_1a});}},__onFolderLoadError:function(_1b,e){var err=new bfree.api.Error(dojo.replace("Failed to retrieve folder '{0}'",[folder.name]),e);bfree.widget.ErrorManager.handleError({error:err});},__onCommand:function(_1c,_1d,_1e){switch(_1c){case bfree.widget.Bfree.Commands.ADMIN:this.__onAdmin(_1d);break;case bfree.widget.Bfree.Commands.REFRESH:this.__onRefresh(_1d);break;case bfree.widget.Bfree.Commands.EDIT:this.__onEdit(_1d,_1e);break;case bfree.widget.Bfree.Commands.NEW:this.__onNew(_1d,_1e);break;case bfree.widget.Bfree.Commands.VIEW:this.__onView(_1d,_1e);break;case bfree.widget.Bfree.Commands.COPY:this.__onCopy(_1d,_1e);break;case bfree.widget.Bfree.Commands.MOVE:this.__onMove(_1d,_1e);break;case bfree.widget.Bfree.Commands.CHECKOUT:this.__onCheckout(_1d,_1e);break;case bfree.widget.Bfree.Commands.CHECKIN:this.__onCheckin(_1d,_1e);break;case bfree.widget.Bfree.Commands.CANCEL_CKO:this.__onCancelCheckout(_1d,_1e);break;case bfree.widget.Bfree.Commands.DELETE:this.__onDelete(_1d,_1e);break;case bfree.widget.Bfree.Commands.DESTROY:this.__onDestroy(_1d,_1e);break;case bfree.widget.Bfree.Commands.RESTORE:this.__onRestore(_1d,_1e);break;case bfree.widget.Bfree.Commands.SECURE:this.__onSecure(_1d,_1e);break;case bfree.widget.Bfree.Commands.EMPTY:this._onEmpty();break;case bfree.widget.Bfree.Commands.PRINT:this._onPrint();break;case bfree.widget.Bfree.Commands.EXPORT:this._onExport(_1d);break;case bfree.widget.Bfree.Commands.LOGOFF:this._onLogoff();break;}},__onAdmin:function(_1f){switch(_1f){case bfree.widget.Bfree.ObjectTypes.USER:this._onUserAdmin();break;case bfree.widget.Bfree.ObjectTypes.GROUP:this._onGroupAdmin();break;case bfree.widget.Bfree.ObjectTypes.PROP_DEF:this._onAdminPropDefs();break;case bfree.widget.Bfree.ObjectTypes.CHOICE_LIST:this._onChoiceListAdmin();break;case bfree.widget.Bfree.ObjectTypes.DOC_TYPE:this._onDocTypeAdmin();break;case bfree.widget.Bfree.ObjectTypes.VIEW_DEF:this._onViewDefAdmin();break;case bfree.widget.Bfree.ObjectTypes.QUOTA:this._onAdminQuota();break;}},__onCancelCheckout:function(_20,_21){switch(_20){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCancelCKO(_21.documents);break;}},__onCheckin:function(_22,_23){switch(_22){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCKI(_23.documents);break;}},__onCheckout:function(_24,_25){switch(_24){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCKO(_25.documents);break;}},__onCopy:function(_26,_27){switch(_26){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCopy(_27.documents);break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionCopy(_27.document,_27.version);break;}},__onDelete:function(_28,_29){switch(_28){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentDelete(_29.documents);break;}},__onDestroy:function(_2a,_2b){switch(_2a){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentDestroy(_2b.documents);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderDestroy(_2b.folder);break;}},__onEdit:function(_2c,_2d){switch(_2c){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentEdit(_2d.documents);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderEdit(_2d.folder);break;case bfree.widget.Bfree.ObjectTypes.USER:this._onUserEdit();break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionEdit(_2d.documents);break;}},__onMove:function(_2e,_2f){switch(_2e){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentMove(_2f.documents);break;}},__onNew:function(_30,_31){switch(_30){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentNew(_31.folder);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderNew(_31.folder);break;}},__onRefresh:function(_32){switch(_32){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentsRefresh();break;}},__onRestore:function(_33,_34){switch(_33){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentRestore(_34.documents);break;}},__onSecure:function(_35,_36){switch(_35){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentSecure(_36.documents);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderSecure(_36.folder);break;}},__onView:function(_37,_38){switch(_37){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentView(_38.documents);break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionView(_38.document,_38.version);break;}},__wdgDocuments_onSelectedItems:function(_39){this.set("activeDocuments",_39);},__wdgFolders_onSelected:function(_3a,_3b){this.set("activeFolder",_3a);},__wdgPane_onFocus:function(_3c){if(_3c===this.contentPane){this.set("activeType",bfree.widget.Bfree.ObjectTypes.DOCUMENT);}else{if(_3c===this.folderPane){this.set("activeType",bfree.widget.Bfree.ObjectTypes.FOLDER);}else{this.set("activeType",bfree.widget.Bfree.ObjectTypes.NONE);}}},_checkSession:function(){var _3d=false;try{_3d=this.zone.isAlive();}catch(e){}if(_3d){setTimeout(bfree.widget.zone.Show._buildCheckFnRef(this),this._duration);}else{this._showLogon();}},_doAdHocQuery:function(_3e){if(_3e.queryData==""){return;}var _3f=this.activeLibrary.getFolders().getSearchFolder();if(_3f){_3f.setActiveQuery(_3e);this._tvwFolders.showSearch();this._tvwFolders.setSelectedItem(_3f);}},_onAdminPropDefs:function(){try{function _40(_41,_42){var _43=this._grdDocuments.activeView;this.activeLibrary.getViewDefinitions().clearCache();this.activeLibrary.getViewDefinitions().fetch();var _44=this.activeLibrary.getViewDefinitions().fetchById({id:_43.id});var _45=_44.getView(this.activeLibrary);this._grdDocuments.set("activeView",_45);this._grdDocuments.set("structure",_45);this._grdDocuments.set("sortInfo",_45.sort_column);this._grdDocuments.refresh();this._grdDocuments.refreshViews();return true;};bfree.widget.propdef.Administration.show({zone:this.zone,library:this.activeLibrary,user:this.activeUser,onClose:dojo.hitch(this,_40)});}catch(e){var err=new bfree.api.Error("Failed to open 'Property Definition Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onAdminQuota:function(){try{function _46(_47,_48){return true;};versa.widget.zone.metrics.Info.show({library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_46)});}catch(e){var err=new bfree.api.Error("Failed to open 'Quota Information' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocTypeAdmin:function(){try{bfree.widget.doctype.Administration.show({user:this.activeUser,zone:this.zone,library:this.activeLibrary,onClose:dojo.hitch(this,function(_49,_4a){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Property Definition Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onChoiceListAdmin:function(){try{bfree.widget.choiceList.Administration.show({user:this.activeUser,zone:this.zone,library:this.activeLibrary,onClose:dojo.hitch(this,function(_4b,_4c){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Choice List Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocumentCancelCKO:function(_4d){var _4e=new bfree.widget.document.Accessor({library:this.activeLibrary,zone:this.zone});function _4f(_50){var msg=dojo.replace("Are you sure you want to cancel the checkout of document '{name}'?",_50);if(confirm(msg)){_4e.doCancelCheckout(_50);}};function _51(_52,e){var err=new bfree.api.Error(dojo.replace("Failed to cancel checkout of document '{0}'",[_52.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_4d,_4f,_51);},_onDocumentCKI:function(_53){function _54(_55,_56){return true;};function _57(_58,e){var err=new bfree.api.Error(dojo.replace("Failed to checkin document '{0}'",[_58.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doDialog(_53,bfree.widget.document.Checkin.show,dojo.hitch(this,_54),_57);},_onDocumentCKO:function(_59){var _5a=new bfree.widget.document.Accessor({library:this.activeLibrary,zone:this.zone});function _5b(_5c){_5a.doCheckout(_5c);_5a.doCopyLocal(_5c);};function _5d(_5e,e){var err=new bfree.api.Error(dojo.replace("Failed to checkout document '{0}'",[_5e.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_59,_5b,_5d);},_onDocumentCopy:function(_5f){var _60=new bfree.widget.document.Accessor({library:this.activeLibrary,zone:this.zone});function _61(_62){_60.doCopyLocal(_62);};function _63(_64,e){var err=new bfree.api.Error(dojo.replace("Failed to copy document '{0}'",[_64.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_5f,_61,_63);},_onDocumentDelete:function(_65){var msg="Are you sure you want to delete the selected documents?";if(!confirm(msg)){return;}var _66=new bfree.widget.document.Accessor({library:this.activeLibrary,zone:this.zone});function _67(_68){_66.library.getDocuments().destroy({soft:true,item:_68});};function _69(_6a,e){var err=new bfree.api.Error(dojo.replace("Failed to delete document '{0}'",[_6a.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_65,_67,_69);},_onDocumentDestroy:function(_6b){var idx=-1;if((_6b==null)||(_6b.length<1)){return;}var msg=(_6b[0].getState(bfree.api.Document.states.DELETED))?"Are you sure you want to permanently delete the selected documents?\nWarning: This cannot be undone.":"Are you sure you want to delete the selected documents?";if(!confirm(msg)){return;}try{idx=this._grdDocuments.getItemIndex(_6b[0]);dojo.forEach(_6b,function(_6c,idx){this._grdDocuments.setBusy(_6c,true);},this);this._grdDocuments.beginUpdate();dojo.forEach(_6b,function(_6d,idx){this.activeLibrary.getDocuments().destroy({item:_6d});},this);}catch(e){var err=new bfree.api.Error("Failed to delete selected document(s)",e);bfree.widget.ErrorManager.handleError({error:err});idx=-1;}finally{this._grdDocuments.endUpdate();if(idx>0){this._grdDocuments.setSelectedIndex(idx);}else{dojo.forEach(_6b,function(_6e,idx){this._grdDocuments.setBusy(_6e,false);},this);}}},_onDocumentEdit:function(_6f){function _70(_71,_72){return true;};function _73(_74,e){dojo.forEach(_74,function(_75,idx){var err=new bfree.api.Error(dojo.replace("Failed to edit document '{0}'",[_75.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_6f,bfree.widget.document.PropertyEditor.show,dojo.hitch(this,_70),_73);},_onDocumentMove:function(_76){function _77(_78,_79){if(_78==bfree.widget.Dialog.dialogResult.ok){this._grdDocuments.refresh();this._grdDocuments.update();}return true;};function _7a(_7b,e){var err=new bfree.api.Error("Failed to move documents",e);bfree.widget.ErrorManager.handleError({error:err});};this.__doDialog(_76,bfree.widget.document.Move.show,dojo.hitch(this,_77),_7a);},_onDocumentNew:function(_7c){try{this._grdDocuments.beginUpdate();bfree.widget.document.Creator.show({folder:(_7c),library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,function(_7d,_7e){this._grdDocuments.endUpdate();this._grdDocuments.refresh();return true;})});}catch(e){this._grdDocuments.endUpdate();var err=new bfree.api.Error("Failed to open 'Create Documents' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocumentRestore:function(_7f){try{if(!_7f){return;}if(!_7f.length){_7f=[_7f];}dojo.forEach(_7f,dojo.hitch(this,function(it,idx){this._grdDocuments.setBusy(it);}));var _80=new bfree.widget.document.Accessor({library:this.activeLibrary,zone:this.zone});dojo.forEach(_7f,dojo.hitch(this,function(it,idx){_80.doRestore(it,false);}));this._grdDocuments.selection.clear();this.activeLibrary.getDocuments().save({onComplete:dojo.hitch(this,function(){this._grdDocuments.refresh();})});}catch(e){var err=new bfree.api.Error("Failed to restore document",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocumentSecure:function(_81){function _82(_83,_84){return true;};function _85(_86,e){dojo.forEach(_86,function(_87,idx){var err=new bfree.api.Error(dojo.replace("Failed to edit document security '{0}'",[_87.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_81,bfree.widget.acl.Editor.show,dojo.hitch(this,_82),_85);},_onDocumentView:function(_88){var _89=new bfree.widget.document.Accessor({library:this.activeLibrary,zone:this.zone});function _8a(_8b){_89.doView(_8b);};function _8c(_8d,e){var err=new bfree.api.Error(dojo.replace("Failed to view document '{0}'",[_8d.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_88,_8a,_8c);},_onDocumentsRefresh:function(){this._grdDocuments.refresh();},_onFolderDestroy:function(_8e){try{if(!_8e){return;}this.activeLibrary.getFolders().loadItem({item:_8e,callback:dojo.hitch(this,function(_8f){this._tvwFolders.deleteFolder(_8f);})});}catch(e){var err=new bfree.api.Error("Failed to delete folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderEdit:function(_90){try{if(!_90){return;}this.activeLibrary.getFolders().loadItem({item:_90,callback:dojo.hitch(this,function(_91){this._tvwFolders.editFolder(_91);})});}catch(e){var err=new bfree.api.Error("Failed to rename folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderNew:function(_92){try{if(!_92){return;}if(_92.root){this._tvwFolders.createFolder(_92);}else{this.activeLibrary.getFolders().loadItem({item:_92,callback:dojo.hitch(this,function(_93){this._tvwFolders.createFolder(_93);})});}}catch(e){var err=new bfree.api.Error("Failed to create a new folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderSecure:function(_94){try{function _95(_96,_97){return true;};if(!_94){return;}if(_94.root){bfree.widget.acl.Editor.show({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,item:this.activeLibrary,onClose:dojo.hitch(this,_95)});}else{this.activeLibrary.getFolders().loadItem({item:_94,callback:dojo.hitch(this,function(_98){bfree.widget.acl.Editor.show({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,item:_94,onClose:dojo.hitch(this,_95)});})});}}catch(e){var err=new bfree.api.Error("Failed to create a new folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onGroupAdmin:function(){try{bfree.widget.group.Administration.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,function(_99,_9a){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Group Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onExport:function(_9b){try{this._grdDocuments.export_results(_9b);}catch(e){var err=new bfree.api.Error("Failed to export results",e);bfree.widget.ErrorManager.handleError({error:err});}},_onPrint:function(){try{this._grdDocuments.print_results();}catch(e){var err=new bfree.api.Error("Failed to print results",e);bfree.widget.ErrorManager.handleError({error:err});}},_onLogoff:function(){try{var _9c=true;if(_9c){var msg="Continue to exit VersaFile?";if(!confirm(msg)){return;}}this.onWorking();this.zone.logoff();parent.frames["zoneframe"].location.reload(true);}catch(e){var err=new bfree.api.Error("Failed to logout",e);bfree.widget.ErrorManager.handleError({error:err});}},_onUserAdmin:function(){try{bfree.widget.user.Administration.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,function(_9d,_9e){this.activeUser=this.zone.getUsers().fetchById({id:this.activeUser.id});this.nameNode.innerHTML=this.activeUser.getFullName();return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'User Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onUserEdit:function(){try{if(!this.activeUser){return;}function _9f(_a0,_a1){if(_a0==bfree.widget.Dialog.dialogResult.ok){this.nameNode.innerHTML=this.activeUser.getFullName();}return true;};bfree.widget.user.ProfileEditor.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,_9f)});}catch(e){var err=new bfree.api.Error("Failed to edit user properties",e);bfree.widget.ErrorManager.handleError({error:err});}},_onVersionCopy:function(_a2,_a3){try{if(!_a2||!_a3){return;}var _a4=new bfree.widget.document.version.Accessor({library:this.activeLibrary,zone:this.zone});_a4.doCopyLocal(_a2,_a3);}catch(e){var err=new bfree.api.Error("Failed to copy document",e);bfree.widget.ErrorManager.handleError({error:err});}finally{}},_onVersionEdit:function(_a5){function _a6(_a7,_a8){return true;};function _a9(_aa,e){var err=new bfree.api.Error(dojo.replace("Failed to display version information for document '{0}'",[_aa.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doDialog(_a5,bfree.widget.document.version.Versions.show,dojo.hitch(this,_a6),_a9);},_onVersionView:function(_ab,_ac){if(!_ab&&!_ac){return;}try{var _ad=new bfree.widget.document.version.Accessor({library:this.activeLibrary,zone:this.zone});_ad.doView(_ab,_ac);}catch(e){var err=new bfree.api.Error("Failed to view version",e);bfree.widget.ErrorManager.handleError({error:err});}finally{}},_onViewDefAdmin:function(){try{function _ae(_af,_b0){var _b1=this._grdDocuments.activeView;var _b2=this.activeLibrary.getViewDefinitions().fetchById({id:_b1.id});var _b3=_b2.getView(this.activeLibrary);this._grdDocuments.set("activeView",_b3);this._grdDocuments.set("structure",_b3);this._grdDocuments.set("sortInfo",_b3.sort_column);this._grdDocuments.refresh();this._grdDocuments.refreshViews();return true;};bfree.widget.view.Administration.show({user:this.activeUser,library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_ae)});}catch(e){var err=new bfree.api.Error("Failed to open 'View Definition' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_setActiveDocumentsAttr:function(_b4){_b4.clean();if((!_b4)||(_b4.length<1)){this.activeDocuments=[];return;}this.activeDocuments=_b4;if(this.activeType==bfree.widget.Bfree.ObjectTypes.DOCUMENT){this._wdgItemInfo.preload(bfree.widget.Bfree.ObjectTypes.DOCUMENT,_b4);}this._cmdBar.set("activeDocuments",this.activeDocuments);dojo.forEach(_b4,function(_b5,idx){this.activeLibrary.getDocuments().loadItem({item:_b5,scope:this,onItem:this.__onDocumentLoad,onError:function(_b6){this.__onDocumentLoadError(_b5,new bfree.api.Error(_b6.responseText,_b6));}});},this);},_setActiveFolderAttr:function(_b7){var _b8=(_b7!==this.activeFolder);this.activeFolder=_b7;if(this.activeType==bfree.widget.Bfree.ObjectTypes.FOLDER){this._wdgItemInfo.preload(bfree.widget.Bfree.ObjectTypes.FOLDER,[_b7]);}if(_b8){this.activeFolder.document_count=0;this._cmdBar.set("activeFolder",this.activeFolder);this.queryDocuments(_b7.getActiveQuery());}this.activeFolder.document_count=this._grdDocuments.rowCount;this._cmdBar.set("activeFolder",this.activeFolder);this._grdDocuments.set("activeFolder",_b7);this.activeLibrary.getFolders().loadItem({item:this.activeFolder,scope:this,onItem:this.__onFolderLoad,onError:function(_b9){this.__onFolderLoadError(_b7,new bfree.api.Error(_b9.responseText,_b9));}});},_showLogon:function(){function _ba(_bb){if(_bb==bfree.widget.Dialog.dialogResult.ok){setTimeout(bfree.widget.zone.Show._buildCheckFnRef(this),this._duration);}else{this.logoff(false);}return true;};var dlg=new bfree.widget.Dialog({title:"Bfree Logon",widgetConstructor:bfree.widget.zone.ReLogon,widgetParams:{zone:this.zone,activeUser:this.activeUser},noResize:true,height:240,width:400,zIndex:1024,onClose:dojo.hitch(this,_ba)});dlg.startup();dlg.show();},constructor:function(_bc){},editUserGroups:function(){var dlg=new bfree.widget.Dialog({title:"Edit User/Groups",widgetConstructor:bfree.widget.zone.UserGroupsAdmin,widgetParams:{zone:this.zone},noResize:true,height:240,width:400,zIndex:1024});dlg.startup();dlg.show();},onLoad:function(wdg){},onWorking:function(){},_onEmpty:function(){this.activeLibrary.getDocuments().empty_recycling({zone:this.zone,library:this.activeLibrary});this._grdDocuments.refresh();},postCreate:function(){this.inherited("postCreate",arguments);bfree.api.Application.getDataTypes();bfree.api.Application.getOperators();this.activeLibrary.getPropertyDefinitions().fetch();this.activeLibrary.getDocumentTypes().fetch();this.activeLibrary.getViewDefinitions().fetch();if((this.zone.trial_expiry!=bfree.api.Zone.TrialStates.NO_TRIAL)&&(this.zone.trial_expiry!=bfree.api.Zone.TrialStates.INFINITE)){if(this.zone.trial_expiry>bfree.api.Zone.TrialStates.EXPIRED+1){this.trialMsgNode.innerHTML=dojo.replace(versa.VersaFile.messages.TRIAL_REMAINING,{days_left:this.zone.trial_expiry});}else{if(this.zone.trial_expiry==bfree.api.Zone.TrialStates.EXPIRED+1){this.trialMsgNode.innerHTML=versa.VersaFile.messages.TRIAL_FINAL;}else{this.trialMsgNode.innerHTML=versa.VersaFile.messages.TRIAL_EXPIRED;}}dojo.style(this.trialStateNode,{display:"block"});}this.nameNode.innerHTML=this.activeUser.getFullName();this._cmdBar=new bfree.widget.zone.Toolbar({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,onCommand:dojo.hitch(this,this.__onCommand),style:"z-index: 512;bottom:4px;left:0;position:absolute"},this.toolbarNode);new bfree.widget.search.TextBox({library:this.activeLibrary,onSearch:dojo.hitch(this,this._doAdHocQuery),style:"width:100%"},this.searchBoxNode);this._tvwFolders=new bfree.widget.folder.Tree({library:this.activeLibrary,user:this.activeUser,folders:this.activeLibrary.getFolders(),documents:this.activeLibrary.getDocuments(),dndController:"bfree.widget.folder.DndSource",dndType:"Folder",onCommand:dojo.hitch(this,this.__onCommand),onSelected:dojo.hitch(this,this.__wdgFolders_onSelected),style:"height: 100%"},this.folderTreeNode);this._grdDocuments=new bfree.widget.document.Grid({id:"grdDocuments",zone:this.zone,library:this.activeLibrary,user:this.activeUser,style:"width: 100%",onCommand:dojo.hitch(this,this.__onCommand),onSelectedItems:dojo.hitch(this,this.__wdgDocuments_onSelectedItems)},this.documentGridNode);this._wdgItemInfo=new bfree.widget.ItemInfo({library:this.activeLibrary,root:this._tvwFolders.rootNode},this.itemInfoNode);bfree.widget.document.PropertyEditor.refresh=dojo.hitch(this,this._onDocumentsRefresh);bfree.widget.acl.Editor.refresh=dojo.hitch(this,this._onDocumentsRefresh);this.versionSpan.innerHTML="V"+this.version+" | ";dojo.connect(this.folderPane,"onFocus",dojo.hitch(this,this.__wdgPane_onFocus,this.folderPane));dojo.connect(this.contentPane,"onFocus",dojo.hitch(this,this.__wdgPane_onFocus,this.contentPane));this.onLoad(this);},queryDocuments:function(_bd){this._grdDocuments.set("activeQuery",_bd.getQuery());},showEditDocumentTypes:function(){try{function _be(_bf,_c0){if(_bf==bfree.widget.Dialog.dialogResult.ok){}return true;};}catch(e){var err=new bfree.api.Error("Failed to open 'Edit Property Definitions' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},startup:function(){this._grdDocuments.startup();this._cmdBar.set("activeLibrary",this.activeLibrary);this._cmdBar.set("activeUser",this.activeUser);this.inherited("startup",arguments);this._grdDocuments.auto();this._grdDocuments.initialize();this._tvwFolders.initialize();}});bfree.widget.zone.Show._buildCheckFnRef=function(_c1){return (function(){_c1._checkSession();});};}