/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.zone.Show"]){dojo._hasResource["bfree.widget.zone.Show"]=true;dojo.provide("bfree.widget.zone.Show");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.require("bfree.widget.Bfree");dojo.require("bfree.widget.Dialog");dojo.require("bfree.widget.ErrorManager");dojo.require("bfree.widget.acl.Editor");dojo.require("bfree.widget.choiceList.Administration");dojo.require("bfree.widget.document.Accessor");dojo.require("bfree.widget.document.version.Accessor");dojo.require("bfree.widget.document.Checkin");dojo.require("bfree.widget.document.Creator");dojo.require("bfree.widget.document.Move");dojo.require("bfree.widget.document.PropertyEditor");dojo.require("bfree.widget.document.version.Versions");dojo.require("bfree.widget.folder.DndSource");dojo.require("bfree.widget.folder.Tree");dojo.require("bfree.widget.group.Administration");dojo.require("bfree.widget.doctype.Administration");dojo.require("bfree.widget.propdef.Administration");dojo.require("bfree.widget.search.TextBox");dojo.require("bfree.widget.user.ProfileButton");dojo.require("bfree.widget.user.ProfileEditor");dojo.require("bfree.widget.user.Administration");dojo.require("bfree.widget.view.Administration");dojo.require("bfree.widget.zone.CommandBar");dojo.require("bfree.widget.zone.ReLogon");dojo.require("bfree.widget.zone.Toolbar");dojo.require("bfree.widget.ItemInfo");dojo.require("versa.widget.reference.Accessor");dojo.require("versa.widget.reference.Grid");dojo.require("versa.widget.share.CopyLink");dojo.require("versa.widget.share.Editor");dojo.require("versa.widget.zone.metrics.Info");dojo.require("versa.VersaFile");dojo.declare("bfree.widget.zone.Show",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("bfree.widget.zone","template/Show.html","<div style=\"background:#D9D9D6;height:100%;width:100%;\">\n\n<div    dojoType=\"dijit.layout.BorderContainer\"\n        design=\"headline\"\n        gutters=\"false\"\n        style=\"height:100%;width:100%;\">\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"center\"\n            spitter=\"false\"\n            style=\"padding:8px 8px 0 8px\">\n\n        <div    dojoType=\"dijit.layout.BorderContainer\"\n                design=\"headline\"\n                gutters=\"false\"\n                style=\"height:100%;width:100%\">\n\n            <div    dojoType=\"dijit.layout.BorderContainer\"\n                    design=\"sidebar\"\n                    gutters=\"false\"\n                    region=\"top\"\n                    splitter=\"false\"\n                    class=\"versaTopPane\">\n\n                <div    dojoType=\"dijit.layout.ContentPane\"\n                        region=\"left\"\n                        splitter=\"false\"\n                        class=\"versaHeadPane\">\n                    <img src=\"/images/versafile-64-tm.png\" height=\"56\" style=\"position:relative;top:-8px;left:0\"/>\n                </div>\n\n                <div    dojoType=\"dijit.layout.BorderContainer\"\n                        design=\"sidebar\"\n                        gutters=\"false\"\n                        region=\"center\"\n                        class=\"versaBarPane\">\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            region=\"center\"\n                            splitter=\"false\"\n                            style=\"padding:0;overflow:hidden;position:relative;\">\n\n                        <div    dojoAttachPoint=\"trialStateNode\"\n                                style=\"display:none;margin-left:auto;margin-right:auto;text-align: center\">\n                            <span dojoAttachPoint=\"trialMsgNode\" class=\"dijitMediumLabel dijitDarkLabelV\" style=\"display:inline-block\"></span>\n                            <span dojoAttachPoint=\"activateMsgNode\" class=\"dijitMediumLabel dijitDarkLabelV\" style=\"display:inline-block\"></span>\n                        </div>\n\n                        <div dojoAttachPoint=\"toolbarNode\"></div>\n\n                    </div>\n\n                    <div    dojoType=\"dijit.layout.BorderContainer\"\n                            design=\"headline\"\n                            gutters=\"false\"\n                            region=\"right\"\n                            splitter=\"false\"\n                            style=\"width:256px;\">\n\n                        <div    dojoType=\"dijit.layout.ContentPane\"\n                                region=\"center\"\n                                splitter=\"false\"\n                                style=\"position:relative;text-align:right;padding:2px 0 0 0\">\n\n                            <table cellpadding=\"0\" cellspacing=\"0\" style=\"position:absolute;right:0\"><tr>\n                                <td  style=\"padding-right:4px; border-right: 1px solid #75787B\">\n                                    <a href=\"javascript://\" class=\"versaLink\" title=\"Edit Profile\" dojoAttachEvent=\"onclick: _onUserEdit\">\n                                    <span  dojoAttachPoint=\"nameNode\"></span>\n                                    </a>\n                                </td>\n                                <td style=\"padding-left:4px;\"><a href=\"javascript://\" class=\"versaLink\" dojoAttachEvent=\"onclick: _onLogoff\">Logout</a></td>\n                            </tr>\n                            </table>\n\n                        </div>\n\n                        <div    dojoType=\"dijit.layout.ContentPane\"\n                                region=\"bottom\"\n                                splitter=\"false\"\n                                style=\"height:32px;padding:0;\">\n                            <div dojoAttachPoint=\"searchBoxNode\" style=\"\"></div>\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n            <div    dojoType=\"dijit.layout.BorderContainer\"\n                    design=\"headline\"\n                    gutters=\"false\"\n                    region=\"center\"\n                    splitter=\"false\"\n                    class=\"versaMainPane\">\n\n                <div    dojoType=\"dijit.layout.BorderContainer\"\n                        design=\"sidebar\"\n                        gutters=\"true\"\n                        region=\"center\"\n                        splitter=\"false\"\n                        class=\"\">\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            dojoAttachPoint=\"folderPane\"\n                            region=\"left\"\n                            splitter=\"true\"\n                            class=\"versaInfoPane\"\n                            style=\"padding:0;width:256px;\">\n\n                        <div style=\"height: 100%\">\n                           <div dojoAttachPoint=\"folderTreeNode\" style=\"height: 100%\"></div>\n                       </div>\n\n                    </div>\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            dojoAttachPoint=\"contentPane\"\n                            region=\"center\"\n                            splitter=\"true\"\n                            class=\"versaInfoPane\"\n                            style=\"padding:0\">\n\n                        <div dojoAttachPoint=\"documentGridNode\"></div>\n\n                    </div>\n\n                </div>\n\n                <div    dojoType=\"dijit.layout.ContentPane\"\n                        region=\"bottom\"\n                        splitter=\"false\"\n                        style=\"height:96px;padding: 0 6px 8px 6px\">\n\n                   <div style=\"height:100%\" class=\"versaInfoPane\">\n                       <div dojoAttachPoint=\"itemInfoNode\" style=\"width: 100%\"></div>\n                   </div>\n\n                </div>\n\n            </div>\n\n\n        </div>\n\n    </div>\n\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"bottom\"\n            splitter=\"false\"\n            style=\"position:relative;height:16px;overflow:hidden;\">\n\n        <span class=\"dijitMediumLabel dijitDarkLabelV\">VersaFile is an RKO Business Solutions product. Copyright Â© 2012 All rights reserved.</span>\n\n        <span style=\"position:absolute;right:16px;\">\n            <table>\n                <tr>\n                    <td style=\"padding-right:4px; border-right: 1px solid #75787B\">\n                        <span dojoAttachPoint=\"versionSpan\" class=\"dijitMediumLabel dijitDarkLabelV\"></span>\n                    </td><td style=\"padding-right:4px; border-right: 1px solid #75787B\">\n                        <a dojoAttachPoint=\"guideAnchor\" href=\"http://www.versafile.com/assets/VersaFile%20Quick%20Reference%20Guide.pdf\" target=\"_blank\">How-to</a>\n                    </td><td>\n                        <a href=\"mailto:support@versafile.com\" class=\"versaLink\">Contact Support</a>\n                    </td>\n                </tr>\n            </table>\n        </span>\n\n    </div>\n\n</div>\n\n</div>\n\n\n\n"),widgetsInTemplate:true,_duration:60000,_btnAvatar:null,_cmdBar:null,_grdDocuments:null,_txtSearch:null,activeDocuments:[],activeFolder:null,activeGroup:null,activeLibrary:null,activeType:bfree.widget.Bfree.ObjectTypes.FOLDER,activeUser:null,zone:null,folders:null,location:null,__doAction:function(_1,_2,_3,_4){var _5=-1;if((_1==null)||(_1.length<1)){return;}try{dojo.forEach(_1,function(_6,_7){this._grdDocuments.setBusy(_6,true);},this);_5=this._grdDocuments.getItemIndex(_1[0]);this._grdDocuments.beginUpdate();dojo.forEach(_1,function(_8,_9){try{_2(_8);}catch(e){_4(_8,e);if(e.status==404){this._grdDocuments.store.onDelete(_8);}}},this);}finally{this._grdDocuments.endUpdate();dojo.forEach(_1,function(_a,_b){this._grdDocuments.setBusy(_a,false);},this);this._grdDocuments.selectItems(_1,_5);_3(_1);}},__doDialog:function(_c,_d,_e,_f){var _10=-1;if((_c==null)||(_c.length<1)){return;}function _11(_12,_13){var _14=false;if(_e(_12,_13)){this._grdDocuments.endUpdate();dojo.forEach(_13,function(_15,idx){this._grdDocuments.setBusy(_15,false);},this);this._grdDocuments.selectItems(_13,_10);this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);_14=true;}return _14;};try{dojo.forEach(_c,function(_16,idx){this._grdDocuments.setBusy(_16,true);},this);_10=this._grdDocuments.getItemIndex(_c[0]);this._grdDocuments.beginUpdate();_d({zone:this.zone,user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,folder:this.activeFolder,items:_c,onClose:dojo.hitch(this,_11)});}catch(e){this._grdDocuments.endUpdate();_f(_c,e);dojo.forEach(_c,function(_17,idx){this._grdDocuments.setBusy(_17,false);},this);this._grdDocuments.selectItems(_c,_10);}},__onDocumentLoad:function(_18){var _19=dojo.isArray(_18)?_18:[_18];this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.DOCUMENT,items:_19});},__onDocumentLoadError:function(_1a,e){var _1b=false;var err=new bfree.api.Error(dojo.replace("Failed to retrieve document '{0}'",[_1a.name]),e);bfree.widget.ErrorManager.handleError({error:err});if(e.status==404){_1b=true;this._grdDocuments.store.onDelete(_1a);}this._wdgItemInfo.errorItem({item:_1a,isDeleted:_1b});},__onFolderLoad:function(_1c){this.activeFolder=_1c;if(this.activeFolder.isSearch()&&(!this.activeFolder._activeQuery)){this.activeFolder.setActiveQuery(this._txtSearch.get("activeQuery"));}this._grdDocuments.set("activeFolder",this.activeFolder);},__onFolderLoadError:function(_1d,e){var err=new bfree.api.Error(dojo.replace("Failed to retrieve folder '{0}'",[folder.name]),e);bfree.widget.ErrorManager.handleError({error:err});},__onCommand:function(_1e,_1f,_20){switch(_1e){case bfree.widget.Bfree.Commands.ADMIN:this.__onAdmin(_1f);break;case bfree.widget.Bfree.Commands.REFRESH:this.__onRefresh(_1f);break;case bfree.widget.Bfree.Commands.EDIT:this.__onEdit(_1f,_20);break;case bfree.widget.Bfree.Commands.NEW:this.__onNew(_1f,_20);break;case bfree.widget.Bfree.Commands.VIEW:this.__onView(_1f,_20);break;case bfree.widget.Bfree.Commands.COPY:this.__onCopy(_1f,_20);break;case bfree.widget.Bfree.Commands.MOVE:this.__onMove(_1f,_20);break;case bfree.widget.Bfree.Commands.CHECKOUT:this.__onCheckout(_1f,_20);break;case bfree.widget.Bfree.Commands.CHECKIN:this.__onCheckin(_1f,_20);break;case bfree.widget.Bfree.Commands.CANCEL_CKO:this.__onCancelCheckout(_1f,_20);break;case bfree.widget.Bfree.Commands.DELETE:this.__onDelete(_1f,_20);break;case bfree.widget.Bfree.Commands.DESTROY:this.__onDestroy(_1f,_20);break;case bfree.widget.Bfree.Commands.RESTORE:this.__onRestore(_1f,_20);break;case bfree.widget.Bfree.Commands.SECURE:this.__onSecure(_1f,_20);break;case bfree.widget.Bfree.Commands.SHARE:this.__onShare(_1f,_20);break;case bfree.widget.Bfree.Commands.UNSHARE:this.__onUnshare(_1f,_20);break;case bfree.widget.Bfree.Commands.RENAME:this.__onRename(_1f,_20);break;case bfree.widget.Bfree.Commands.EMPTY:this._onFolderTrashEmpty();break;case bfree.widget.Bfree.Commands.PRINT:this._onPrint();break;case bfree.widget.Bfree.Commands.EXPORT:this._onExport(_1f);break;case bfree.widget.Bfree.Commands.LOGOFF:this._onLogoff();break;}},__onAdmin:function(_21){switch(_21){case bfree.widget.Bfree.ObjectTypes.USER:this._onUserAdmin();break;case bfree.widget.Bfree.ObjectTypes.GROUP:this._onGroupAdmin();break;case bfree.widget.Bfree.ObjectTypes.PROP_DEF:this._onAdminPropDefs();break;case bfree.widget.Bfree.ObjectTypes.CHOICE_LIST:this._onChoiceListAdmin();break;case bfree.widget.Bfree.ObjectTypes.DOC_TYPE:this._onDocTypeAdmin();break;case bfree.widget.Bfree.ObjectTypes.VIEW_DEF:this._onViewDefAdmin();break;case bfree.widget.Bfree.ObjectTypes.QUOTA:this._onAdminQuota();break;}},__onCancelCheckout:function(_22,_23){switch(_22){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCancelCKO(_23.items);break;}},__onCheckin:function(_24,_25){switch(_24){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCKI(_25.items);break;}},__onCheckout:function(_26,_27){switch(_26){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCKO(_27.items);break;}},__onCopy:function(_28,_29){switch(_28){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCopy(_29.items);break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionCopy(_29.document,_29.version);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareShowLink(_29.folder);break;}},__onDelete:function(_2a,_2b){switch(_2a){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentDelete(_2b.items);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShar;}},__onDestroy:function(_2c,_2d){switch(_2c){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentDestroy(_2d.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderDestroy(_2d.folder);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareDestroy(_2d.folder);break;}},__onEdit:function(_2e,_2f){switch(_2e){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentEdit(_2f.items);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareEdit(_2f.folder);break;case bfree.widget.Bfree.ObjectTypes.USER:this._onUserEdit();break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionEdit(_2f.items);break;}},__onMove:function(_30,_31){switch(_30){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:(!_31.folder)?this._onDocumentMove(_31.items):this._onDocumentQuickMove(_31.folder,_31.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderMove(_31.parent,_31.folder);break;}},__onNew:function(_32,_33){switch(_32){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentNew(_33.folder);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderNew(_33.folder);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareNew(_33.folder);break;}},__onRefresh:function(_34){switch(_34){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentsRefresh();break;}},__onRename:function(_35,_36){switch(_35){case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderRename(_36.folder);break;}},__onRestore:function(_37,_38){switch(_37){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentRestore(_38.folder,_38.items);break;}},__onSecure:function(_39,_3a){switch(_39){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentSecure(_3a.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderSecure(_3a.folder);break;}},__onShare:function(_3b,_3c){switch(_3b){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onShareDocuments(_3c.folder,_3c.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:break;}},__onUnshare:function(_3d,_3e){switch(_3d){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentUnshare(_3e.items);break;}},__onView:function(_3f,_40){switch(_3f){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentView(_40.items);break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionView(_40.document,_40.version);break;}},__wdg_onFocus:function(_41){this.set("activeType",_41);},__wdgDocuments_onQueryComplete:function(_42){this.activeFolder.document_count=_42;this._cmdBar.set("activeFolder",this.activeFolder);if((_42<1)&&(this.activeType==bfree.widget.Bfree.ObjectTypes.DOCUMENT)){this.set("activeType",bfree.widget.Bfree.ObjectTypes.FOLDER);this._tvwFolders.setSelectedItem(this.activeFolder);}this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[this.activeFolder]});},__wdgDocuments_onSelectedItems:function(_43){this.set("activeDocuments",_43);},__wdgFolders_onSelected:function(_44,_45){this.set("activeFolder",_44);},__wdgFolders_onNewNode:function(_46){this.activeFolder.document_count=this._grdDocuments.rowCount;this._cmdBar.set("activeFolder",this.activeFolder);this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[this.activeFolder]});},__wdgFolders_onUpdateNode:function(_47){var _48=_47.item;if((this.activeType==bfree.widget.Bfree.ObjectTypes.FOLDER)&&(_48===this.activeFolder)){this._wdgItemInfo.preload({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[_48]});this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[_48]});}},_checkSession:function(){var _49=false;try{_49=this.zone.isAlive();}catch(e){}if(_49){setTimeout(bfree.widget.zone.Show._buildCheckFnRef(this),this._duration);}else{this._showLogon();}},_doAdHocQuery:function(_4a){if(_4a.queryData==""){return;}var _4b=this._tvwFolders.getRoot();var _4c=_4b.getSearchFolder();if(_4c){this._grdDocuments.set("activeFolder",null);this.set("activeType",bfree.widget.Bfree.ObjectTypes.FOLDER);_4c.setActiveQuery(_4a);this._tvwFolders.showSearch();this._tvwFolders.setSelectedItem(_4c);}},_onAdminPropDefs:function(){try{function _4d(_4e,_4f){this._grdDocuments.refreshViews(false);return true;};bfree.widget.propdef.Administration.show({zone:this.zone,library:this.activeLibrary,user:this.activeUser,onClose:dojo.hitch(this,_4d)});}catch(e){var err=new bfree.api.Error("Failed to open 'Property Definition Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onAdminQuota:function(){try{function _50(_51,_52){return true;};versa.widget.zone.metrics.Info.show({library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_50)});}catch(e){var err=new bfree.api.Error("Failed to open 'Quota Information' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocTypeAdmin:function(){try{bfree.widget.doctype.Administration.show({user:this.activeUser,zone:this.zone,library:this.activeLibrary,onClose:dojo.hitch(this,function(_53,_54){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Property Definition Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onChoiceListAdmin:function(){try{bfree.widget.choiceList.Administration.show({user:this.activeUser,zone:this.zone,library:this.activeLibrary,onClose:dojo.hitch(this,function(_55,_56){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Choice List Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocumentCancelCKO:function(_57){this._wdgItemInfo.setBusy(true);var _58=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _59(_5a){var msg=dojo.replace("Are you sure you want to cancel the checkout of document '{name}'?",_5a);if(confirm(msg)){_58.doCancelCheckout(_5a);}};function _5b(_5c){};function _5d(_5e,e){var err=new bfree.api.Error(dojo.replace("Failed to cancel checkout of document '{0}'",[_5e.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_57,_59,_5b,_5d);},_onDocumentCKI:function(_5f){this._wdgItemInfo.setBusy(true);function _60(_61,_62){dojo.forEach(_62,function(_63,idx){this.activeLibrary.getReferences().refreshItem(_63.getId());},this);return true;};function _64(_65,e){var err=new bfree.api.Error(dojo.replace("Failed to checkin document '{0}'",[_65.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doDialog(_5f,bfree.widget.document.Checkin.show,dojo.hitch(this,_60),_64);},_onDocumentCKO:function(_66){this._wdgItemInfo.setBusy(true);var _67=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _68(_69){_67.doCheckout(_69);_67.doCopyLocal(_69);};function _6a(_6b){};function _6c(_6d,e){var err=new bfree.api.Error(dojo.replace("Failed to checkout document '{0}'",[_6d.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_66,dojo.hitch(this,_68),dojo.hitch(this,_6a),dojo.hitch(this,_6c));},_onDocumentCopy:function(_6e){var _6f=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _70(_71){_6f.doCopyLocal(_71);};function _72(_73){};function _74(_75,e){var err=new bfree.api.Error(dojo.replace("Failed to copy document '{0}'",[_75.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_6e,_70,_72,_74);},_onDocumentDelete:function(_76){var msg="Are you sure you want to delete the selected documents?";if(!confirm(msg)){return;}function _77(_78){this.activeLibrary.getReferences().destroy({soft:true,item:_78});};function _79(_7a){this._grdDocuments.update();dojo.forEach(_7a,function(_7b,idx){this._grdDocuments.store.onDelete(_7b);},this);this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _7c(_7d,e){var err=new bfree.api.Error(dojo.replace("Failed to delete document '{0}'",[_7d.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_76,dojo.hitch(this,_77),dojo.hitch(this,_79),_7c);},_onDocumentDestroy:function(_7e){var msg="Are you sure you want to permanently delete the selected documents?\nWarning: This cannot be undone.";if(!confirm(msg)){return;}function _7f(_80){this.activeLibrary.getReferences().destroy({item:_80});};function _81(_82){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _83(_84,e){var err=new bfree.api.Error(dojo.replace("Failed to destroy document '{0}'",[_84.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_7e,dojo.hitch(this,_7f),dojo.hitch(this,_81),_83);},_onDocumentEdit:function(_85){this._wdgItemInfo.setBusy(true);function _86(_87,_88){dojo.forEach(_88,function(_89,idx){this.activeLibrary.getReferences().refreshItem(_89.getId());},this);return true;};function _8a(_8b,e){dojo.forEach(_8b,function(_8c,idx){var err=new bfree.api.Error(dojo.replace("Failed to edit document '{0}'",[_8c.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_85,bfree.widget.document.PropertyEditor.show,dojo.hitch(this,_86),_8a);},_onDocumentMove:function(_8d){function _8e(_8f,_90){return true;};function _91(_92,e){var err=new bfree.api.Error("Failed to move documents",e);bfree.widget.ErrorManager.handleError({error:err});};this.__doDialog(_8d,bfree.widget.document.Move.show,dojo.hitch(this,_8e),_91);},_onDocumentNew:function(_93){try{this._tvwFolders.setSelectedItem(_93);this._grdDocuments.beginUpdate();bfree.widget.document.Creator.show({folder:(_93),library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,function(_94,_95){this._grdDocuments.endUpdate();this._grdDocuments.refresh();if(this._grdDocuments.selection.getSelectedCount()<1){this._grdDocuments.setSelectedIndex(0);}this.__wdgFolders_onSelected(this.activeFolder,null);return true;})});}catch(e){this._grdDocuments.endUpdate();var err=new bfree.api.Error("Failed to open 'Create Documents' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocumentQuickMove:function(_96,_97){var _98=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _99(_9a){_98.doMove(_96,_9a);};function _9b(_9c){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _9d(_9e,e){var err=new bfree.api.Error(dojo.replace("Failed to move document '{0}'",[_9e.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_97,_99,dojo.hitch(this,_9b),_9d);},_onDocumentRestore:function(_9f,_a0){var _a1=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _a2(_a3){_a1.doRestore(_9f,_a3);};function _a4(_a5){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _a6(_a7,e){var err=new bfree.api.Error(dojo.replace("Failed to restore document '{0}'",[_a7.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_a0,_a2,dojo.hitch(this,_a4),_a6);},_onDocumentSecure:function(_a8){function _a9(_aa,_ab){return true;};function _ac(_ad,e){dojo.forEach(_ad,function(_ae,idx){var err=new bfree.api.Error(dojo.replace("Failed to edit document security '{0}'",[_ae.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_a8,bfree.widget.acl.Editor.show,dojo.hitch(this,_a9),_ac);},_onDocumentShare:function(_af,_b0){var _b1=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _b2(_b3){_b1.doShare(_af,_b3);};function _b4(_b5){};function _b6(_b7,e){var err=new bfree.api.Error(dojo.replace("Failed to share document '{0}'",[_b7.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_b0,_b2,_b4,_b6);},_onDocumentUnshare:function(_b8){var _b9=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _ba(_bb){_b9.doUnshare(_bb);};function _bc(_bd){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _be(_bf,e){var err=new bfree.api.Error(dojo.replace("Failed to un-share document '{0}'",[_bf.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_b8,_ba,dojo.hitch(this,_bc),_be);},_onDocumentView:function(_c0){var _c1=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _c2(_c3){_c1.doView(_c3);};function _c4(_c5){};function _c6(_c7,e){var err=new bfree.api.Error(dojo.replace("Failed to view document '{0}'",[_c7.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_c0,_c2,dojo.hitch(this,_c4),_c6);},_onDocumentsRefresh:function(){this._grdDocuments.refresh();},_onFolderDestroy:function(_c8){try{if(!_c8){return;}this.activeLibrary.getFolders().loadItem({item:_c8,callback:dojo.hitch(this,function(_c9){this._tvwFolders.deleteFolder(_c9);})});}catch(e){var err=new bfree.api.Error("Failed to delete folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderEdit:function(_ca){},_onFolderMove:function(_cb,_cc){try{if(!_cb||!_cc){return;}this.activeLibrary.getFolders().loadItem({item:_cb,callback:dojo.hitch(this,function(_cd){this._tvwFolders.moveFolder(_cd,_cc);this._tvwFolders.model.getChildren(_cd,dojo.hitch(this,function(_ce){dojo.forEach(_ce,function(_cf){this.activeLibrary.getFolders().loadItem({item:_cf});},this);}));})});}catch(e){var err=new bfree.api.Error("Failed to move folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderNew:function(_d0){try{if(!_d0){return;}if(_d0.root){this._tvwFolders.createFolder(_d0);}else{this.activeLibrary.getFolders().loadItem({item:_d0,callback:dojo.hitch(this,function(_d1){this._tvwFolders.createFolder(_d1);})});}}catch(e){var err=new bfree.api.Error("Failed to create a new folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderRename:function(_d2){try{if(!_d2){return;}this.activeLibrary.getFolders().loadItem({item:_d2,callback:dojo.hitch(this,function(_d3){this._tvwFolders.editFolder(_d3);})});}catch(e){var err=new bfree.api.Error("Failed to rename folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderSecure:function(_d4){try{function _d5(_d6,_d7){return true;};if(!_d4){return;}if(_d4.root){bfree.widget.acl.Editor.show({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,item:this.activeLibrary,onClose:dojo.hitch(this,_d5)});}else{this.activeLibrary.getFolders().loadItem({item:_d4,callback:dojo.hitch(this,function(_d8){bfree.widget.acl.Editor.show({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,item:_d4,onClose:dojo.hitch(this,_d5)});})});}}catch(e){var err=new bfree.api.Error("Failed to create a new folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderTrashEmpty:function(){var msg="Are you sure you want to permanently delete all of the documents in the Recycle Bin?\nWarning: This cannot be undone.";if(!confirm(msg)){return;}try{this.activeLibrary.empty_trash({zone:this.zone});this._grdDocuments.refresh();this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);}catch(e){var err=new bfree.api.Error("Failed to empty the Recycle Bin",e);bfree.widget.ErrorManager.handleError({error:err});}},_onGroupAdmin:function(){try{bfree.widget.group.Administration.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,function(_d9,_da){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Group Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onExport:function(_db){try{this._grdDocuments.export_results(_db);}catch(e){var err=new bfree.api.Error("Failed to export results",e);bfree.widget.ErrorManager.handleError({error:err});}},_onPrint:function(){try{this._grdDocuments.print_results();}catch(e){var err=new bfree.api.Error("Failed to print results",e);bfree.widget.ErrorManager.handleError({error:err});}},_onLogoff:function(){try{var _dc=true;if(_dc){var msg="Continue to exit VersaFile?";if(!confirm(msg)){return;}}this.onWorking();this.zone.logoff();parent.frames["zoneframe"].location.reload(true);}catch(e){var err=new bfree.api.Error("Failed to logout",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareDocuments:function(_dd,_de){try{dojo.forEach(_de,function(_df){this._grdDocuments.setBusy(_df,true);},this);_dd.shareItems({zone:this.zone,library:this.activeLibrary,references:_de});}catch(e){var err=new bfree.api.Error("Failed to share documents",e);bfree.widget.ErrorManager.handleError({error:err});}finally{dojo.forEach(_de,function(_e0){this._grdDocuments.setBusy(_e0,false);},this);}},_onShareDestroy:function(_e1){try{if(!_e1){return;}this._tvwFolders.setBusy(_e1,true);this.activeLibrary.getFolders().loadItem({item:_e1,callback:dojo.hitch(this,function(_e2){this._tvwFolders.deleteFolder(_e2);})});}catch(e){var err=new bfree.api.Error("Failed to delete folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareEdit:function(_e3){try{function _e4(_e5,_e6){return true;};versa.widget.share.Editor.show({share:_e3,seed:null,library:this.activeLibrary,rootFolder:this._tvwFolders.getRoot(),zone:this.zone,onClose:dojo.hitch(this,_e4)});}catch(e){var err=new bfree.api.Error("Failed to open 'Share Edit' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareNew:function(_e7){try{function _e8(_e9,_ea){return true;};versa.widget.share.Editor.show({share:null,seed:_e7,rootFolder:this._tvwFolders.getRoot(),library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_e8)});}catch(e){var err=new bfree.api.Error("Failed to open 'Share Creation' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareShowLink:function(_eb){try{function _ec(_ed,_ee){return true;};versa.widget.share.CopyLink.show({share:_eb,library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_ec)});}catch(e){var err=new bfree.api.Error("Failed to open 'Share Link' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onUserAdmin:function(){try{bfree.widget.user.Administration.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,function(_ef,_f0){this.activeUser=this.zone.getUsers().fetchById({id:this.activeUser.id});this.nameNode.innerHTML=this.activeUser.getFullName();return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'User Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onUserEdit:function(){try{if(!this.activeUser){return;}function _f1(_f2,_f3){if(_f2==bfree.widget.Dialog.dialogResult.ok){this.nameNode.innerHTML=this.activeUser.getFullName();}return true;};bfree.widget.user.ProfileEditor.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,_f1)});}catch(e){var err=new bfree.api.Error("Failed to edit user properties",e);bfree.widget.ErrorManager.handleError({error:err});}},_onVersionCopy:function(_f4,_f5){try{if(!_f4||!_f5){return;}var _f6=new bfree.widget.document.version.Accessor({library:this.activeLibrary,zone:this.zone});_f6.doCopyLocal(_f4,_f5);}catch(e){var err=new bfree.api.Error("Failed to copy document",e);bfree.widget.ErrorManager.handleError({error:err});}finally{}},_onVersionEdit:function(_f7){function _f8(_f9,_fa){return true;};function _fb(_fc,e){dojo.forEach(_fc,function(_fd,idx){var err=new bfree.api.Error(dojo.replace("Failed to display version information for document '{0}'",[_fd.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_f7,bfree.widget.document.version.Versions.show,dojo.hitch(this,_f8),_fb);},_onVersionView:function(_fe,_ff){if(!_fe&&!_ff){return;}try{var _100=new bfree.widget.document.version.Accessor({library:this.activeLibrary,zone:this.zone});_100.doView(_fe,_ff);}catch(e){var err=new bfree.api.Error("Failed to view version",e);bfree.widget.ErrorManager.handleError({error:err});}finally{}},_onViewDefAdmin:function(){try{function _101(_102,_103){if(_103){this._grdDocuments.refreshViews(true);}return true;};bfree.widget.view.Administration.show({user:this.activeUser,library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_101)});}catch(e){var err=new bfree.api.Error("Failed to open 'View Definition' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_setActiveDocumentsAttr:function(_104){_104.clean();if((!_104)||(_104.length<1)){this.activeDocuments=[];return;}this.activeDocuments=_104;this._cmdBar.set("activeDocuments",this.activeDocuments);if(this.activeType==bfree.widget.Bfree.ObjectTypes.DOCUMENT){this._wdgItemInfo.preload({type:bfree.widget.Bfree.ObjectTypes.DOCUMENT,items:_104});if(_104.length<=1){dojo.forEach(_104,function(item,idx){this.activeLibrary.getDocuments().refreshAsync({scope:this,identity:item.document_id,onItem:this.__onDocumentLoad,onError:this.__onDocumentLoadError});},this);}else{this.__onDocumentLoad(this.activeDocuments);}}},_setActiveFolderAttr:function(item){this.activeFolder=item;this.activeFolder.document_count=0;this._cmdBar.set("activeFolder",this.activeFolder);if(this.activeType==bfree.widget.Bfree.ObjectTypes.FOLDER){this._wdgItemInfo.preload({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[this.activeFolder]});this.activeLibrary.getFolders().loadItem({item:this.activeFolder,scope:this,onItem:this.__onFolderLoad,onError:function(_105){this.__onFolderLoadError(item,new bfree.api.Error(_105.responseText,_105));}});}},_showLogon:function(){function _106(_107){if(_107==bfree.widget.Dialog.dialogResult.ok){setTimeout(bfree.widget.zone.Show._buildCheckFnRef(this),this._duration);}else{this.logoff(false);}return true;};var dlg=new bfree.widget.Dialog({title:"Bfree Logon",widgetConstructor:bfree.widget.zone.ReLogon,widgetParams:{zone:this.zone,activeUser:this.activeUser},noResize:true,height:240,width:400,zIndex:1024,onClose:dojo.hitch(this,_106)});dlg.startup();dlg.show();},constructor:function(args){},editUserGroups:function(){var dlg=new bfree.widget.Dialog({title:"Edit User/Groups",widgetConstructor:bfree.widget.zone.UserGroupsAdmin,widgetParams:{zone:this.zone},noResize:true,height:240,width:400,zIndex:1024});dlg.startup();dlg.show();},onLoad:function(wdg){},onWorking:function(){},postCreate:function(){this.inherited("postCreate",arguments);bfree.api.Application.getDataTypes();bfree.api.Application.getOperators();this.zone.getRoles().fetch();this.activeLibrary.getPropertyDefinitions().fetch();this.activeLibrary.getDocumentTypes().fetch();this.activeLibrary.getViewDefinitions().fetch();if((this.zone.trial_expiry!=bfree.api.Zone.TrialStates.NO_TRIAL)&&(this.zone.trial_expiry!=bfree.api.Zone.TrialStates.INFINITE)){if(this.zone.trial_expiry>bfree.api.Zone.TrialStates.EXPIRED+1){this.trialMsgNode.innerHTML=dojo.replace(versa.VersaFile.messages.TRIAL_REMAINING,{days_left:this.zone.trial_expiry});}else{if(this.zone.trial_expiry==bfree.api.Zone.TrialStates.EXPIRED+1){this.trialMsgNode.innerHTML=versa.VersaFile.messages.TRIAL_FINAL;}else{this.trialMsgNode.innerHTML=versa.VersaFile.messages.TRIAL_EXPIRED;}}dojo.style(this.trialStateNode,{display:"block"});}this.nameNode.innerHTML=this.activeUser.getFullName();this._cmdBar=new bfree.widget.zone.Toolbar({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,onCommand:dojo.hitch(this,this.__onCommand),style:"z-index: 512;bottom:4px;left:0;position:absolute"},this.toolbarNode);this._txtSearch=new bfree.widget.search.TextBox({library:this.activeLibrary,onSearch:dojo.hitch(this,this._doAdHocQuery),style:"width:100%"},this.searchBoxNode);this._tvwFolders=new bfree.widget.folder.Tree({zone:this.zone,library:this.activeLibrary,group:this.activeGroup,user:this.activeUser,folders:this.activeLibrary.getFolders(),documents:this.activeLibrary.getDocuments(),onCommand:dojo.hitch(this,this.__onCommand),onSelected:dojo.hitch(this,this.__wdgFolders_onSelected),onNewNode:dojo.hitch(this,this.__wdgFolders_onNewNode),onUpdateNode:dojo.hitch(this,this.__wdgFolders_onUpdateNode),onFocus:dojo.hitch(this,this.__wdg_onFocus,bfree.widget.Bfree.ObjectTypes.FOLDER),style:"height: 100%"},this.folderTreeNode);this._grdDocuments=new versa.widget.reference.Grid({id:"grdReferences",activeLibrary:this.activeLibrary,activeUser:this.activeUser,activeZone:this.zone,onCommand:dojo.hitch(this,this.__onCommand),onSelectedItems:dojo.hitch(this,this.__wdgDocuments_onSelectedItems),onFocus:dojo.hitch(this,this.__wdg_onFocus,bfree.widget.Bfree.ObjectTypes.DOCUMENT),onQueryComplete:dojo.hitch(this,this.__wdgDocuments_onQueryComplete)},this.documentGridNode);this._wdgItemInfo=new bfree.widget.ItemInfo({library:this.activeLibrary,root:this._tvwFolders.rootNode},this.itemInfoNode);bfree.widget.document.PropertyEditor.refresh=dojo.hitch(this,this._onDocumentsRefresh);bfree.widget.acl.Editor.refresh=dojo.hitch(this,this._onDocumentsRefresh);this.versionSpan.innerHTML=dojo.replace("v{version}",this);this.onLoad(this);},startup:function(){this._cmdBar.set("activeLibrary",this.activeLibrary);this._cmdBar.set("activeUser",this.activeUser);this.inherited("startup",arguments);dijit.focus(this._tvwFolders.domNode);this._tvwFolders.selectRoot();}});bfree.widget.zone.Show._buildCheckFnRef=function(that){return (function(){that._checkSession();});};}