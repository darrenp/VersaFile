/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.zone.Show"]){dojo._hasResource["bfree.widget.zone.Show"]=true;dojo.provide("bfree.widget.zone.Show");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.require("bfree.api.DropboxAccount");dojo.require("bfree.widget.Bfree");dojo.require("bfree.widget.Dialog");dojo.require("bfree.widget.ErrorManager");dojo.require("bfree.widget.acl.Editor");dojo.require("bfree.widget.choiceList.Administration");dojo.require("bfree.widget.document.Accessor");dojo.require("bfree.widget.document.version.Accessor");dojo.require("bfree.widget.document.Checkin");dojo.require("bfree.widget.document.Creator");dojo.require("bfree.widget.document.Move");dojo.require("bfree.widget.document.PropertyEditor");dojo.require("bfree.widget.document.version.Versions");dojo.require("bfree.widget.folder.DndSource");dojo.require("bfree.widget.folder.Tree");dojo.require("bfree.widget.group.Administration");dojo.require("bfree.widget.doctype.Administration");dojo.require("bfree.widget.propdef.Administration");dojo.require("bfree.widget.search.TextBox");dojo.require("bfree.widget.user.ProfileButton");dojo.require("bfree.widget.user.ProfileEditor");dojo.require("bfree.widget.user.Administration");dojo.require("bfree.widget.view.Administration");dojo.require("bfree.widget.zone.CommandBar");dojo.require("bfree.widget.zone.ReLogon");dojo.require("bfree.widget.zone.Toolbar");dojo.require("bfree.widget.ItemInfo");dojo.require("versa.widget.reference.Accessor");dojo.require("versa.widget.reference.Grid");dojo.require("versa.widget.share.CopyLink");dojo.require("versa.widget.share.Editor");dojo.require("versa.widget.zone.metrics.Info");dojo.require("versa.VersaFile");dojo.declare("bfree.widget.zone.Show",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("bfree.widget.zone","template/Show.html","<div style=\"background:#D9D9D6;height:100%;width:100%;\">\n\n<div    dojoType=\"dijit.layout.BorderContainer\"\n        design=\"headline\"\n        gutters=\"false\"\n        style=\"height:100%;width:100%;\">\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"center\"\n            spitter=\"false\"\n            style=\"padding:8px 8px 0 8px\">\n\n        <div    dojoType=\"dijit.layout.BorderContainer\"\n                design=\"headline\"\n                gutters=\"false\"\n                style=\"height:100%;width:100%\">\n\n            <div    dojoType=\"dijit.layout.BorderContainer\"\n                    design=\"sidebar\"\n                    gutters=\"false\"\n                    region=\"top\"\n                    splitter=\"false\"\n                    class=\"versaTopPane\">\n\n                <div    dojoType=\"dijit.layout.ContentPane\"\n                        region=\"left\"\n                        splitter=\"false\"\n                        class=\"versaHeadPane\">\n                    <img src=\"/images/versafile-64-tm.png\" height=\"56\" style=\"position:relative;top:-8px;left:0\"/>\n                </div>\n\n                <div    dojoType=\"dijit.layout.BorderContainer\"\n                        design=\"sidebar\"\n                        gutters=\"false\"\n                        region=\"center\"\n                        class=\"versaBarPane\">\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            region=\"center\"\n                            splitter=\"false\"\n                            style=\"padding:0;overflow:hidden;position:relative;\">\n\n                        <div    dojoAttachPoint=\"trialStateNode\"\n                                style=\"display:none;margin-left:auto;margin-right:auto;text-align: center\">\n                            <span dojoAttachPoint=\"trialMsgNode\" class=\"dijitMediumLabel dijitDarkLabelV\" style=\"display:inline-block\"></span>\n                            <span dojoAttachPoint=\"activateMsgNode\" class=\"dijitMediumLabel dijitDarkLabelV\" style=\"display:inline-block\"></span>\n                        </div>\n\n                        <div dojoAttachPoint=\"toolbarNode\"></div>\n\n                    </div>\n\n                    <div    dojoType=\"dijit.layout.BorderContainer\"\n                            design=\"headline\"\n                            gutters=\"false\"\n                            region=\"right\"\n                            splitter=\"false\"\n                            style=\"width:256px;\">\n\n                        <div    dojoType=\"dijit.layout.ContentPane\"\n                                region=\"center\"\n                                splitter=\"false\"\n                                style=\"position:relative;text-align:right;padding:2px 0 0 0\">\n\n                            <table cellpadding=\"0\" cellspacing=\"0\" style=\"position:absolute;right:0\"><tr>\n                                <td  style=\"padding-right:4px; border-right: 1px solid #75787B\">\n                                    <a href=\"javascript://\" class=\"versaLink\" title=\"Edit Profile\" dojoAttachEvent=\"onclick: _onUserEdit\">\n                                    <span  dojoAttachPoint=\"nameNode\"></span>\n                                    </a>\n                                </td>\n                                <td style=\"padding-left:4px;\"><a href=\"javascript://\" class=\"versaLink\" dojoAttachEvent=\"onclick: _onLogoff\">Logout</a></td>\n                            </tr>\n                            </table>\n\n                        </div>\n\n                        <div    dojoType=\"dijit.layout.ContentPane\"\n                                region=\"bottom\"\n                                splitter=\"false\"\n                                style=\"height:32px;padding:0;\">\n                            <div dojoAttachPoint=\"searchBoxNode\" style=\"\"></div>\n                        </div>\n\n                    </div>\n\n                </div>\n\n            </div>\n\n            <div    dojoType=\"dijit.layout.BorderContainer\"\n                    design=\"headline\"\n                    gutters=\"false\"\n                    region=\"center\"\n                    splitter=\"false\"\n                    class=\"versaMainPane\">\n\n                <div    dojoType=\"dijit.layout.BorderContainer\"\n                        design=\"sidebar\"\n                        gutters=\"true\"\n                        region=\"center\"\n                        splitter=\"false\"\n                        class=\"\">\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            dojoAttachPoint=\"folderPane\"\n                            region=\"left\"\n                            splitter=\"true\"\n                            class=\"versaInfoPane\"\n                            style=\"padding:0;width:256px;\">\n\n                        <div style=\"height: 100%;overflow:auto;\">\n                           <div dojoAttachPoint=\"folderTreeNode\" style=\"height: 100%\"></div>\n                       </div>\n\n                    </div>\n\n                    <div    dojoType=\"dijit.layout.ContentPane\"\n                            dojoAttachPoint=\"contentPane\"\n                            region=\"center\"\n                            splitter=\"true\"\n                            class=\"versaInfoPane\"\n                            style=\"padding:0\">\n\n                        <div dojoAttachPoint=\"documentGridNode\"></div>\n\n                    </div>\n\n                </div>\n\n                <div    dojoType=\"dijit.layout.ContentPane\"\n                        region=\"bottom\"\n                        splitter=\"false\"\n                        style=\"height:96px;padding: 0 6px 8px 6px\">\n\n                   <div style=\"height:100%\" class=\"versaInfoPane\">\n                       <div dojoAttachPoint=\"itemInfoNode\" style=\"width: 100%\"></div>\n                   </div>\n\n                </div>\n\n            </div>\n\n\n        </div>\n\n    </div>\n\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"bottom\"\n            splitter=\"false\"\n            style=\"position:relative;height:16px;overflow:hidden;\">\n\n        <span class=\"dijitMediumLabel dijitDarkLabelV\">VersaFile is an RKO Business Solutions product. Copyright Â© 2012 All rights reserved.</span>\n\n        <span style=\"position:absolute;right:16px;\">\n            <table>\n                <tr>\n                    <td style=\"padding-right:4px; border-right: 1px solid #75787B\">\n                        <span dojoAttachPoint=\"versionSpan\" class=\"dijitMediumLabel dijitDarkLabelV\"></span>\n                    </td><td style=\"padding-right:4px; border-right: 1px solid #75787B\">\n                        <a dojoAttachPoint=\"guideAnchor\" href=\"http://www.versafile.com/assets/VersaFile%20Quick%20Reference%20Guide.pdf\" target=\"_blank\">How-to</a>\n                    </td><td>\n                        <a href=\"mailto:support@versafile.com\" class=\"versaLink\">Contact Support</a>\n                    </td>\n                </tr>\n            </table>\n        </span>\n\n    </div>\n\n</div>\n\n</div>\n\n\n\n"),widgetsInTemplate:true,_duration:60000,_btnAvatar:null,_cmdBar:null,_grdDocuments:null,_txtSearch:null,activeDocuments:[],activeFolder:null,activeGroup:null,activeLibrary:null,activeType:bfree.widget.Bfree.ObjectTypes.FOLDER,activeUser:null,zone:null,folders:null,location:null,__doAction:function(_1,_2,_3,_4){var _5=-1;if((_1==null)||(_1.length<1)){return;}dojo.forEach(_1,function(_6,_7){this._grdDocuments.setBusy(_6,true);},this);setTimeout(dojo.hitch(this,function(){try{_5=this._grdDocuments.getItemIndex(_1[0]);this._grdDocuments.beginUpdate();dojo.forEach(_1,function(_8,_9){try{_2(_8);}catch(e){_4(_8,e);if(e.status==404){this._grdDocuments.store.onDelete(_8);}}},this);}finally{this._grdDocuments.endUpdate();dojo.forEach(_1,function(_a,_b){this._grdDocuments.setBusy(_a,false);},this);this._grdDocuments.selectItems(_1,_5);_3(_1);}}),100);},__doArrayAction:function(_c,_d,_e,_f){var _10=-1;if((_c==null)||(_c.length<1)){return;}try{dojo.forEach(_c,function(_11,idx){this._grdDocuments.setBusy(_11,true);},this);_10=this._grdDocuments.getItemIndex(_c[0]);this._grdDocuments.beginUpdate();try{_d(_c);}catch(e){dojo.forEach(_c,function(_12,idx){_f(_12,e);if(e.status==404){this._grdDocuments.store.onDelete(_12);}},this);}}finally{this._grdDocuments.endUpdate();dojo.forEach(_c,function(_13,idx){this._grdDocuments.setBusy(_13,false);},this);this._grdDocuments.selectItems(_c,_10);_e(_c);}},__doDialog:function(_14,_15,_16,_17){var _18=-1;if((_14==null)||(_14.length<1)){return;}function _19(_1a,_1b){var _1c=false;if(_16(_1a,_1b)){this._grdDocuments.endUpdate();dojo.forEach(_1b,function(_1d,idx){this._grdDocuments.setBusy(_1d,false);},this);this._grdDocuments.selectItems(_1b,_18);this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);_1c=true;}return _1c;};try{dojo.forEach(_14,function(_1e,idx){this._grdDocuments.setBusy(_1e,true);},this);_18=this._grdDocuments.getItemIndex(_14[0]);this._grdDocuments.beginUpdate();_15({zone:this.zone,user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,folder:this.activeFolder,items:_14,onClose:dojo.hitch(this,_19)});}catch(e){this._grdDocuments.endUpdate();_17(_14,e);dojo.forEach(_14,function(_1f,idx){this._grdDocuments.setBusy(_1f,false);},this);this._grdDocuments.selectItems(_14,_18);}},__onDocumentLoad:function(_20){var _21=dojo.isArray(_20)?_20:[_20];this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.DOCUMENT,items:_21});},__onDocumentLoadError:function(_22,e){var _23=false;var err=new bfree.api.Error(dojo.replace("Failed to retrieve document '{0}'",[_22.name]),e);bfree.widget.ErrorManager.handleError({error:err});if(e.status==404){_23=true;this._grdDocuments.store.onDelete(_22);}this._wdgItemInfo.errorItem({item:_22,isDeleted:_23});},__onFolderLoad:function(_24){this.activeFolder=_24;if(this.activeFolder.isSearch()&&(!this.activeFolder._activeQuery)){this.activeFolder.setActiveQuery(this._txtSearch.get("activeQuery"));}this._grdDocuments.set("activeFolder",this.activeFolder);},__onFolderLoadError:function(_25,e){var err=new bfree.api.Error(dojo.replace("Failed to retrieve folder '{0}'",[folder.name]),e);bfree.widget.ErrorManager.handleError({error:err});},__onCommand:function(_26,_27,_28){switch(_26){case bfree.widget.Bfree.Commands.ADMIN:this.__onAdmin(_27);break;case bfree.widget.Bfree.Commands.REFRESH:this.__onRefresh(_27);break;case bfree.widget.Bfree.Commands.EDIT:this.__onEdit(_27,_28);break;case bfree.widget.Bfree.Commands.NEW:this.__onNew(_27,_28);break;case bfree.widget.Bfree.Commands.VIEW:this.__onView(_27,_28);break;case bfree.widget.Bfree.Commands.COPY:this.__onCopy(_27,_28);break;case bfree.widget.Bfree.Commands.MOVE:this.__onMove(_27,_28);break;case bfree.widget.Bfree.Commands.CHECKOUT:this.__onCheckout(_27,_28);break;case bfree.widget.Bfree.Commands.CHECKIN:this.__onCheckin(_27,_28);break;case bfree.widget.Bfree.Commands.CANCEL_CKO:this.__onCancelCheckout(_27,_28);break;case bfree.widget.Bfree.Commands.DELETE:this.__onDelete(_27,_28);break;case bfree.widget.Bfree.Commands.DESTROY:this.__onDestroy(_27,_28);break;case bfree.widget.Bfree.Commands.RESTORE:this.__onRestore(_27,_28);break;case bfree.widget.Bfree.Commands.SECURE:this.__onSecure(_27,_28);break;case bfree.widget.Bfree.Commands.SHARE:this.__onShare(_27,_28);break;case bfree.widget.Bfree.Commands.UNSHARE:this.__onUnshare(_27,_28);break;case bfree.widget.Bfree.Commands.RENAME:this.__onRename(_27,_28);break;case bfree.widget.Bfree.Commands.EMPTY:this._onFolderTrashEmpty();break;case bfree.widget.Bfree.Commands.PRINT:this._onPrint();break;case bfree.widget.Bfree.Commands.EXPORT:this._onExport(_27);break;case bfree.widget.Bfree.Commands.LOGOFF:this._onLogoff();break;case bfree.widget.Bfree.Commands.ADD_DROPBOX:this._onAddDropbox();break;case bfree.widget.Bfree.Commands.SYNCHRONIZE:this.__onSynchronize(_27,_28);break;}},_onAddDropbox:function(){try{bfree.api.DropboxAccount.requestAccess(this.zone,this.activeLibrary);}catch(e){var err=new bfree.api.Error("Failed to add new dropbox account",e);bfree.widget.ErrorManager.handleError({error:err});}},__onAdmin:function(_29){switch(_29){case bfree.widget.Bfree.ObjectTypes.USER:this._onUserAdmin();break;case bfree.widget.Bfree.ObjectTypes.GROUP:this._onGroupAdmin();break;case bfree.widget.Bfree.ObjectTypes.PROP_DEF:this._onAdminPropDefs();break;case bfree.widget.Bfree.ObjectTypes.CHOICE_LIST:this._onChoiceListAdmin();break;case bfree.widget.Bfree.ObjectTypes.DOC_TYPE:this._onDocTypeAdmin();break;case bfree.widget.Bfree.ObjectTypes.VIEW_DEF:this._onViewDefAdmin();break;case bfree.widget.Bfree.ObjectTypes.QUOTA:this._onAdminQuota();break;}},__onCancelCheckout:function(_2a,_2b){switch(_2a){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCancelCKO(_2b.items);break;}},__onCheckin:function(_2c,_2d){switch(_2c){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCKI(_2d.items);break;}},__onCheckout:function(_2e,_2f){switch(_2e){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCKO(_2f.items);break;}},__onCopy:function(_30,_31){switch(_30){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentCopy(_31.items);break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionCopy(_31.document,_31.version);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareShowLink(_31.folder);break;}},__onDelete:function(_32,_33){switch(_32){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentDelete(_33.items);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShar;}},__onDestroy:function(_34,_35){switch(_34){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentDestroy(_35.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderDestroy(_35.folder);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareDestroy(_35.folder);break;}},__onEdit:function(_36,_37){switch(_36){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentEdit(_37.items);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareEdit(_37.folder);break;case bfree.widget.Bfree.ObjectTypes.USER:this._onUserEdit();break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionEdit(_37.items);break;}},__onSynchronize:function(_38,_39){switch(_38){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this.__onDocumentSynchronize(_39.items);break;}},__onDocumentSynchronize:function(_3a){this._wdgItemInfo.setBusy(true);var _3b=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _3c(_3d){_3b.doSynchronize(_3d);};function _3e(_3f){};function _40(_41,e){var err=new bfree.api.Error(dojo.replace("Failed to synchronize document '{0}'",[_41.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_3a,dojo.hitch(this,_3c),dojo.hitch(this,_3e),dojo.hitch(this,_40));},__onMove:function(_42,_43){switch(_42){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:(!_43.folder)?this._onDocumentMove(_43.items):this._onDocumentQuickMove(_43.folder,_43.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderMove(_43.parent,_43.folder);break;}},__onNew:function(_44,_45){switch(_44){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentNew(_45.folder,_45.fileItems);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderNew(_45.folder);break;case bfree.widget.Bfree.ObjectTypes.SHARE:this._onShareNew(_45.folder);break;}},__onRefresh:function(_46){switch(_46){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentsRefresh();break;}},__onRename:function(_47,_48){switch(_47){case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderRename(_48.folder);break;}},__onRestore:function(_49,_4a){switch(_49){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentRestore(_4a.folder,_4a.items);break;}},__onSecure:function(_4b,_4c){switch(_4b){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentSecure(_4c.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:this._onFolderSecure(_4c.folder);break;}},__onShare:function(_4d,_4e){switch(_4d){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onShareDocuments(_4e.folder,_4e.items);break;case bfree.widget.Bfree.ObjectTypes.FOLDER:break;}},__onUnshare:function(_4f,_50){switch(_4f){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentUnshare(_50.items);break;}},__onView:function(_51,_52){switch(_51){case bfree.widget.Bfree.ObjectTypes.DOCUMENT:this._onDocumentView(_52.items);break;case bfree.widget.Bfree.ObjectTypes.VERSION:this._onVersionView(_52.document,_52.version);break;}},__wdg_onFocus:function(_53){this.set("activeType",_53);},__wdgDocuments_onQueryComplete:function(_54){this.activeFolder.document_count=_54;this._cmdBar.set("activeFolder",this.activeFolder);if((_54<1)&&(this.activeType==bfree.widget.Bfree.ObjectTypes.DOCUMENT)){this.set("activeType",bfree.widget.Bfree.ObjectTypes.FOLDER);this._tvwFolders.setSelectedItem(this.activeFolder);}this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[this.activeFolder]});},__wdgDocuments_onFetchComplete:function(_55){if(this.activeDocuments.length<this._grdDocuments.selection.getSelected().length){this.set("activeDocuments",this._grdDocuments.selection.getSelected());this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.DOCUMENT,items:this.activeDocuments});}},__wdgDocuments_onSelectedItems:function(_56){this.set("activeDocuments",_56);},__wdgFolders_onSelected:function(_57,_58){this.set("activeFolder",_57);},__wdgFolders_onNewNode:function(_59){this.activeFolder.document_count=this._grdDocuments.rowCount;this._cmdBar.set("activeFolder",this.activeFolder);this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[this.activeFolder]});},__wdgFolders_onUpdateNode:function(_5a){var _5b=_5a.item;if((this.activeType==bfree.widget.Bfree.ObjectTypes.FOLDER)&&(_5b===this.activeFolder)){this._wdgItemInfo.preload({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[_5b]});this._wdgItemInfo.load({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[_5b]});}},_checkSession:function(){var _5c=false;try{_5c=this.zone.isAlive();}catch(e){}if(_5c){setTimeout(bfree.widget.zone.Show._buildCheckFnRef(this),this._duration);}else{this._showLogon();}},_doAdHocQuery:function(_5d){if(_5d.queryData==""){return;}var _5e=this._tvwFolders.getRoot();var _5f=_5e.getSearchFolder();if(_5f){this._grdDocuments.set("activeFolder",null);this.set("activeType",bfree.widget.Bfree.ObjectTypes.FOLDER);_5f.setActiveQuery(_5d);this._tvwFolders.showSearch();this._tvwFolders.setSelectedItem(_5f);}},_onAdminPropDefs:function(){try{function _60(_61,_62){this._grdDocuments.refreshViews(false);return true;};bfree.widget.propdef.Administration.show({zone:this.zone,library:this.activeLibrary,user:this.activeUser,onClose:dojo.hitch(this,_60)});}catch(e){var err=new bfree.api.Error("Failed to open 'Property Definition Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onAdminQuota:function(){try{function _63(_64,_65){return true;};versa.widget.zone.metrics.Info.show({library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_63)});}catch(e){var err=new bfree.api.Error("Failed to open 'Quota Information' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocTypeAdmin:function(){try{bfree.widget.doctype.Administration.show({user:this.activeUser,zone:this.zone,library:this.activeLibrary,onClose:dojo.hitch(this,function(_66,_67){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Property Definition Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onChoiceListAdmin:function(){try{bfree.widget.choiceList.Administration.show({user:this.activeUser,zone:this.zone,library:this.activeLibrary,onClose:dojo.hitch(this,function(_68,_69){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Choice List Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocumentCancelCKO:function(_6a){this._wdgItemInfo.setBusy(true);var _6b=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _6c(_6d){var msg=dojo.replace("Are you sure you want to cancel the checkout of document '{name}'?",_6d);if(confirm(msg)){_6b.doCancelCheckout(_6d);}};function _6e(_6f){};function _70(_71,e){var err=new bfree.api.Error(dojo.replace("Failed to cancel checkout of document '{0}'",[_71.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_6a,_6c,_6e,_70);},_onDocumentCKI:function(_72){this._wdgItemInfo.setBusy(true);function _73(_74,_75){dojo.forEach(_75,function(_76,idx){this.activeLibrary.getReferences().refreshItem(_76.getId());},this);return true;};function _77(_78,e){var err=new bfree.api.Error(dojo.replace("Failed to checkin document '{0}'",[_78.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doDialog(_72,bfree.widget.document.Checkin.show,dojo.hitch(this,_73),_77);},_onDocumentCKO:function(_79){this._wdgItemInfo.setBusy(true);var _7a=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _7b(_7c){_7a.doCheckout(_7c);_7a.doCopyLocal(_7c);};function _7d(_7e){};function _7f(_80,e){var err=new bfree.api.Error(dojo.replace("Failed to checkout document '{0}'",[_80.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_79,dojo.hitch(this,_7b),dojo.hitch(this,_7d),dojo.hitch(this,_7f));},_onDocumentCopy:function(_81){var _82=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _83(_84){_82.doCopyLocal(_84);};function _85(_86){};function _87(_88,e){var err=new bfree.api.Error(dojo.replace("Failed to copy document '{0}'",[_88.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_81,_83,_85,_87);},_onDocumentDelete:function(_89){var msg="Are you sure you want to delete the selected documents?";if(!confirm(msg)){return;}function _8a(_8b){this.activeLibrary.getReferences().destroy({soft:true,item:_8b});};function _8c(_8d){this._grdDocuments.update();dojo.forEach(_8d,function(_8e,idx){this._grdDocuments.store.onDelete(_8e);},this);this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _8f(_90,e){var err=new bfree.api.Error(dojo.replace("Failed to delete document '{0}'",[_90.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_89,dojo.hitch(this,_8a),dojo.hitch(this,_8c),_8f);},_onDocumentDestroy:function(_91){var msg="Are you sure you want to permanently delete the selected documents?\nWarning: This cannot be undone.";if(!confirm(msg)){return;}function _92(_93){this.activeLibrary.getReferences().destroy({item:_93});};function _94(_95){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _96(_97,e){var err=new bfree.api.Error(dojo.replace("Failed to destroy document '{0}'",[_97.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_91,dojo.hitch(this,_92),dojo.hitch(this,_94),_96);},_onDocumentEdit:function(_98){this._wdgItemInfo.setBusy(true);function _99(_9a,_9b){dojo.forEach(_9b,function(_9c,idx){this.activeLibrary.getReferences().refreshItem(_9c.getId());},this);return true;};function _9d(_9e,e){dojo.forEach(_9e,function(_9f,idx){var err=new bfree.api.Error(dojo.replace("Failed to edit document '{0}'",[_9f.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_98,bfree.widget.document.PropertyEditor.show,dojo.hitch(this,_99),_9d);},_onDocumentMove:function(_a0){function _a1(_a2,_a3){return true;};function _a4(_a5,e){var err=new bfree.api.Error("Failed to move documents",e);bfree.widget.ErrorManager.handleError({error:err});};this.__doDialog(_a0,bfree.widget.document.Move.show,dojo.hitch(this,_a1),_a4);},_onDocumentNew:function(_a6,_a7){try{if(_a7){var _a8=[];var pos=0;for(var i=0;i<_a7.length;i++){if(!(_a7[i].type==""&&(_a7[i].size==0||_a7[i].size==4096))){_a8[pos++]=_a7[i];}}if(_a8.length==0){alert("Folders cannot be uploaded to the VersaFile system");return;}}this._tvwFolders.setSelectedItem(_a6);this._grdDocuments.beginUpdate();bfree.widget.document.Creator.show({folder:(_a6),library:this.activeLibrary,zone:this.zone,fileItems:_a8,onClose:dojo.hitch(this,function(_a9,_aa){this._grdDocuments.endUpdate();this._grdDocuments.refresh();if(this._grdDocuments.selection.getSelectedCount()<1){this._grdDocuments.setSelectedIndex(0);}this.__wdgFolders_onSelected(this.activeFolder,null);return true;})});}catch(e){this._grdDocuments.endUpdate();var err=new bfree.api.Error("Failed to open 'Create Documents' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onDocumentQuickMove:function(_ab,_ac){var _ad=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _ae(_af){_ad.doMove(_ab,_af);};function _b0(_b1){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);this._grdDocuments.refresh();this._grdDocuments.selection.clear();this.set("activeType",bfree.widget.Bfree.ObjectTypes.FOLDER);this.set("activeFolder",this.activeFolder);};function _b2(_b3,e){var err=new bfree.api.Error(dojo.replace("Failed to move document '{0}'",[_b3.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_ac,_ae,dojo.hitch(this,_b0),_b2);},_onDocumentRestore:function(_b4,_b5){var _b6=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _b7(_b8){_b6.doRestore(_b4,_b8);};function _b9(_ba){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _bb(_bc,e){var err=new bfree.api.Error(dojo.replace("Failed to restore document '{0}'",[_bc.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_b5,_b7,dojo.hitch(this,_b9),_bb);},_onDocumentSecure:function(_bd){function _be(_bf,_c0){return true;};function _c1(_c2,e){dojo.forEach(_c2,function(_c3,idx){var err=new bfree.api.Error(dojo.replace("Failed to edit document security '{0}'",[_c3.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_bd,bfree.widget.acl.Editor.show,dojo.hitch(this,_be),_c1);},_onDocumentShare:function(_c4,_c5){var _c6=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _c7(_c8){_c6.doShare(_c4,_c8);};function _c9(_ca){};function _cb(_cc,e){var err=new bfree.api.Error(dojo.replace("Failed to share document '{0}'",[_cc.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_c5,_c7,_c9,_cb);},_onDocumentUnshare:function(_cd){var _ce=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _cf(_d0){_ce.doUnshare(_d0);};function _d1(_d2){this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);};function _d3(_d4,e){var err=new bfree.api.Error(dojo.replace("Failed to un-share document '{0}'",[_d4.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_cd,_cf,dojo.hitch(this,_d1),_d3);},_onDocumentView:function(_d5){var _d6=new versa.widget.reference.Accessor({activeLibrary:this.activeLibrary,activeZone:this.zone});function _d7(_d8){_d6.doView(_d8);};function _d9(_da){};function _db(_dc,e){var err=new bfree.api.Error(dojo.replace("Failed to view document '{0}'",[_dc.name]),e);bfree.widget.ErrorManager.handleError({error:err});};this.__doAction(_d5,_d7,dojo.hitch(this,_d9),_db);},_onDocumentsRefresh:function(){this._grdDocuments.refresh();},_onFolderDestroy:function(_dd){try{if(!_dd){return;}this.activeLibrary.getFolders().loadItem({item:_dd,callback:dojo.hitch(this,function(_de){this._tvwFolders.deleteFolder(_de);})});}catch(e){var err=new bfree.api.Error("Failed to delete folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderEdit:function(_df){},_onFolderMove:function(_e0,_e1){try{if(!_e0||!_e1){return;}this.activeLibrary.getFolders().loadItem({item:_e0,callback:dojo.hitch(this,function(_e2){this._tvwFolders.moveFolder(_e2,_e1);})});}catch(e){var err=new bfree.api.Error("Failed to move folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderNew:function(_e3){try{if(!_e3){return;}if(_e3.root){this._tvwFolders.createFolder(_e3);}else{this.activeLibrary.getFolders().loadItem({item:_e3,callback:dojo.hitch(this,function(_e4){this._tvwFolders.createFolder(_e4);})});}}catch(e){var err=new bfree.api.Error("Failed to create a new folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderRename:function(_e5){try{if(!_e5){return;}this.activeLibrary.getFolders().loadItem({item:_e5,callback:dojo.hitch(this,function(_e6){this._tvwFolders.editFolder(_e6);})});}catch(e){var err=new bfree.api.Error("Failed to rename folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderSecure:function(_e7){try{function _e8(_e9,_ea){return true;};if(!_e7){return;}if(_e7.root){bfree.widget.acl.Editor.show({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,item:this.activeLibrary,onClose:dojo.hitch(this,_e8)});}else{this.activeLibrary.getFolders().loadItem({item:_e7,callback:dojo.hitch(this,function(_eb){bfree.widget.acl.Editor.show({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,item:_e7,onClose:dojo.hitch(this,_e8)});})});}}catch(e){var err=new bfree.api.Error("Failed to create a new folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onFolderTrashEmpty:function(){var msg="Are you sure you want to permanently delete all of the documents in the Recycle Bin?\nWarning: This cannot be undone.";if(!confirm(msg)){return;}try{this.activeLibrary.empty_trash({zone:this.zone});this._grdDocuments.refresh();this.__wdgDocuments_onQueryComplete(this._grdDocuments.rowCount);}catch(e){var err=new bfree.api.Error("Failed to empty the Recycle Bin",e);bfree.widget.ErrorManager.handleError({error:err});}},_onGroupAdmin:function(){try{bfree.widget.group.Administration.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,function(_ec,_ed){return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'Group Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onExport:function(_ee){try{this._grdDocuments.export_results(_ee);}catch(e){var err=new bfree.api.Error("Failed to export results",e);bfree.widget.ErrorManager.handleError({error:err});}},_onPrint:function(){try{this._grdDocuments.print_results();}catch(e){var err=new bfree.api.Error("Failed to print results",e);bfree.widget.ErrorManager.handleError({error:err});}},_onLogoff:function(){try{var _ef=true;if(_ef){var msg="Continue to exit VersaFile?";if(!confirm(msg)){return;}}this.onWorking();this.zone.logoff();parent.frames["zoneframe"].location.reload(true);}catch(e){var err=new bfree.api.Error("Failed to logout",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareDocuments:function(_f0,_f1){try{dojo.forEach(_f1,function(_f2){this._grdDocuments.setBusy(_f2,true);},this);_f0.shareItems({zone:this.zone,library:this.activeLibrary,references:_f1});}catch(e){var err=new bfree.api.Error("Failed to share documents",e);bfree.widget.ErrorManager.handleError({error:err});}finally{dojo.forEach(_f1,function(_f3){this._grdDocuments.setBusy(_f3,false);},this);}},_onShareDestroy:function(_f4){try{if(!_f4){return;}this._tvwFolders.setBusy(_f4,true);this.activeLibrary.getFolders().loadItem({item:_f4,callback:dojo.hitch(this,function(_f5){this._tvwFolders.deleteFolder(_f5);})});}catch(e){var err=new bfree.api.Error("Failed to delete folder",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareEdit:function(_f6){try{function _f7(_f8,_f9){if(_f8==bfree.widget.Dialog.dialogResult.ok){var _fa=this._tvwFolders.getRoot().getShareRootFolder();if(_fa){this._tvwFolders.resortChildren(_fa);}}return true;};versa.widget.share.Editor.show({share:_f6,seed:null,library:this.activeLibrary,rootFolder:this._tvwFolders.getRoot(),zone:this.zone,onClose:dojo.hitch(this,_f7)});}catch(e){var err=new bfree.api.Error("Failed to open 'Share Edit' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareNew:function(_fb){try{function _fc(_fd,_fe){return true;};versa.widget.share.Editor.show({share:null,seed:_fb,rootFolder:this._tvwFolders.getRoot(),library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_fc)});}catch(e){var err=new bfree.api.Error("Failed to open 'Share Creation' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onShareShowLink:function(_ff){try{function _100(_101,_102){return true;};versa.widget.share.CopyLink.show({share:_ff,library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_100)});}catch(e){var err=new bfree.api.Error("Failed to open 'Share Link' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onUserAdmin:function(){try{bfree.widget.user.Administration.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,function(_103,_104){this.activeUser=this.zone.getUsers().fetchById({id:this.activeUser.id});this.nameNode.innerHTML=this.activeUser.getFullName();return true;})});}catch(e){var err=new bfree.api.Error("Failed to open 'User Administration' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_onUserEdit:function(){try{if(!this.activeUser){return;}function _105(_106,_107){if(_106==bfree.widget.Dialog.dialogResult.ok){this.nameNode.innerHTML=this.activeUser.getFullName();}return true;};bfree.widget.user.ProfileEditor.show({user:this.activeUser,zone:this.zone,onClose:dojo.hitch(this,_105)});}catch(e){var err=new bfree.api.Error("Failed to edit user properties",e);bfree.widget.ErrorManager.handleError({error:err});}},_onVersionCopy:function(_108,_109){try{if(!_108||!_109){return;}var _10a=new bfree.widget.document.version.Accessor({library:this.activeLibrary,zone:this.zone});_10a.doCopyLocal(_108,_109);}catch(e){var err=new bfree.api.Error("Failed to copy document",e);bfree.widget.ErrorManager.handleError({error:err});}finally{}},_onVersionEdit:function(_10b){function _10c(_10d,_10e){return true;};function _10f(_110,e){dojo.forEach(_110,function(item,idx){var err=new bfree.api.Error(dojo.replace("Failed to display version information for document '{0}'",[item.name]),e);bfree.widget.ErrorManager.handleError({error:err});},this);};this.__doDialog(_10b,bfree.widget.document.version.Versions.show,dojo.hitch(this,_10c),_10f);},_onVersionView:function(_111,_112){if(!_111&&!_112){return;}try{var _113=new bfree.widget.document.version.Accessor({library:this.activeLibrary,zone:this.zone});_113.doView(_111,_112);}catch(e){var err=new bfree.api.Error("Failed to view version",e);bfree.widget.ErrorManager.handleError({error:err});}finally{}},_onViewDefAdmin:function(){try{function _114(_115,_116){if(_116){this._grdDocuments.refreshViews(true);}return true;};bfree.widget.view.Administration.show({user:this.activeUser,library:this.activeLibrary,zone:this.zone,onClose:dojo.hitch(this,_114)});}catch(e){var err=new bfree.api.Error("Failed to open 'View Definition' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}},_setActiveDocumentsAttr:function(_117){_117.clean();if((!_117)||(_117.length<1)){this.activeDocuments=[];return;}this.activeDocuments=_117;this._cmdBar.set("activeDocuments",this.activeDocuments);if(this.activeType==bfree.widget.Bfree.ObjectTypes.DOCUMENT){this._wdgItemInfo.preload({type:bfree.widget.Bfree.ObjectTypes.DOCUMENT,items:_117});if(_117.length<=1){dojo.forEach(_117,function(item,idx){this.activeLibrary.getDocuments().refreshAsync({scope:this,identity:item.document_id,onItem:this.__onDocumentLoad,onError:this.__onDocumentLoadError});},this);}else{this.__onDocumentLoad(this.activeDocuments);}}},_setActiveFolderAttr:function(item){this.activeFolder=item;this.activeFolder.document_count=0;this._cmdBar.set("activeFolder",this.activeFolder);if(this.activeType==bfree.widget.Bfree.ObjectTypes.FOLDER){this._wdgItemInfo.preload({type:bfree.widget.Bfree.ObjectTypes.FOLDER,items:[this.activeFolder]});this.activeLibrary.getFolders().loadItem({item:this.activeFolder,scope:this,onItem:this.__onFolderLoad,onError:function(_118){this.__onFolderLoadError(item,new bfree.api.Error(_118.responseText,_118));}});}},_showLogon:function(){function _119(_11a){if(_11a==bfree.widget.Dialog.dialogResult.ok){setTimeout(bfree.widget.zone.Show._buildCheckFnRef(this),this._duration);}else{this.logoff(false);}return true;};var dlg=new bfree.widget.Dialog({title:"Bfree Logon",widgetConstructor:bfree.widget.zone.ReLogon,widgetParams:{zone:this.zone,activeUser:this.activeUser},noResize:true,height:240,width:400,zIndex:1024,onClose:dojo.hitch(this,_119)});dlg.startup();dlg.show();},constructor:function(args){},editUserGroups:function(){var dlg=new bfree.widget.Dialog({title:"Edit User/Groups",widgetConstructor:bfree.widget.zone.UserGroupsAdmin,widgetParams:{zone:this.zone},noResize:true,height:240,width:400,zIndex:1024});dlg.startup();dlg.show();},onLoad:function(wdg){},onWorking:function(){},postCreate:function(){this.inherited("postCreate",arguments);bfree.api.Application.getDataTypes();bfree.api.Application.getOperators();this.zone.getRoles().fetch();this.activeLibrary.getPropertyDefinitions().fetch();this.activeLibrary.getDocumentTypes().fetch();this.activeLibrary.getViewDefinitions().fetch();if((this.zone.trial_expiry!=bfree.api.Zone.TrialStates.NO_TRIAL)&&(this.zone.trial_expiry!=bfree.api.Zone.TrialStates.INFINITE)){if(this.zone.trial_expiry>bfree.api.Zone.TrialStates.EXPIRED+1){this.trialMsgNode.innerHTML=dojo.replace(versa.VersaFile.messages.TRIAL_REMAINING,{days_left:this.zone.trial_expiry});}else{if(this.zone.trial_expiry==bfree.api.Zone.TrialStates.EXPIRED+1){this.trialMsgNode.innerHTML=versa.VersaFile.messages.TRIAL_FINAL;}else{this.trialMsgNode.innerHTML=versa.VersaFile.messages.TRIAL_EXPIRED;}}dojo.style(this.trialStateNode,{display:"block"});}this.nameNode.innerHTML=this.activeUser.getFullName();this._cmdBar=new bfree.widget.zone.Toolbar({user:this.activeUser,group:this.activeGroup,library:this.activeLibrary,zone:this.zone,onCommand:dojo.hitch(this,this.__onCommand),style:"z-index: 512;bottom:4px;left:0;position:absolute"},this.toolbarNode);this._txtSearch=new bfree.widget.search.TextBox({library:this.activeLibrary,onSearch:dojo.hitch(this,this._doAdHocQuery),style:"width:100%"},this.searchBoxNode);this._tvwFolders=new bfree.widget.folder.Tree({zone:this.zone,library:this.activeLibrary,group:this.activeGroup,user:this.activeUser,folders:this.activeLibrary.getFolders(),documents:this.activeLibrary.getDocuments(),onCommand:dojo.hitch(this,this.__onCommand),onSelected:dojo.hitch(this,this.__wdgFolders_onSelected),onNewNode:dojo.hitch(this,this.__wdgFolders_onNewNode),onUpdateNode:dojo.hitch(this,this.__wdgFolders_onUpdateNode),onFocus:dojo.hitch(this,this.__wdg_onFocus,bfree.widget.Bfree.ObjectTypes.FOLDER),style:"overflow:visible"},this.folderTreeNode);this._grdDocuments=new versa.widget.reference.Grid({id:"grdReferences",activeLibrary:this.activeLibrary,activeUser:this.activeUser,activeZone:this.zone,onCommand:dojo.hitch(this,this.__onCommand),onSelectedItems:dojo.hitch(this,this.__wdgDocuments_onSelectedItems),onFetchComplete:dojo.hitch(this,this.__wdgDocuments_onFetchComplete),onFocus:dojo.hitch(this,this.__wdg_onFocus,bfree.widget.Bfree.ObjectTypes.DOCUMENT),onQueryComplete:dojo.hitch(this,this.__wdgDocuments_onQueryComplete)},this.documentGridNode);this._wdgItemInfo=new bfree.widget.ItemInfo({library:this.activeLibrary,root:this._tvwFolders.rootNode},this.itemInfoNode);bfree.widget.document.PropertyEditor.refresh=dojo.hitch(this,this._onDocumentsRefresh);bfree.widget.acl.Editor.refresh=dojo.hitch(this,this._onDocumentsRefresh);this.versionSpan.innerHTML=dojo.replace("v{version}",this);this.onLoad(this);},startup:function(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){dojo.body().addEventListener("dragover",dojo.hitch(this,this.showOnDrop),false);dojo.body().addEventListener("dragleave",dojo.hitch(this,this.showOnDrop),false);dojo.body().addEventListener("drop",dojo.hitch(this,this.showOnDrop),false);}this._cmdBar.set("activeLibrary",this.activeLibrary);this._cmdBar.set("activeUser",this.activeUser);this.inherited("startup",arguments);dijit.focus(this._tvwFolders.domNode);this._tvwFolders.selectRoot();},showOnDrop:function(e){e.stopPropagation();e.preventDefault();}});bfree.widget.zone.Show._buildCheckFnRef=function(that){return (function(){that._checkSession();});};}