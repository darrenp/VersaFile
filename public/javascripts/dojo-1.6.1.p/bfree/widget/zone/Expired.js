/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.zone.Expired"]){dojo._hasResource["bfree.widget.zone.Expired"]=true;dojo.provide("bfree.widget.zone.Expired");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.form.Button");dojo.require("dijit.form.Form");dojo.require("bfree.api.User");dojo.require("bfree.widget.ValidationTextBox");dojo.declare("bfree.widget.zone.Expired",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("bfree.widget.zone","template/Expired.html","<div align=\"center\" style=\"height:68px;width:554px;position:relative\">\n<div dojoAttachPoint=\"logonFormNode\">\n\n    <span style=\"position:absolute;top:0px;left:0\" class=\"logonLabel\">\n        Your password has expired, please enter a new one.\n    </span>\n\n    <span style=\"position:absolute;top:24px;left:0px\" class=\"logonLabel\">New Password</span>\n    <div style=\"position:absolute;top:38px;left:0px\"><input dojoAttachPoint=\"txtNewPassword\"/></div>\n\n    <span style=\"position:absolute;top:24px;left:168px\" class=\"logonLabel\">Repeat New Password</span>\n    <div style=\"position:absolute;top:38px;left:168px\"><input dojoAttachPoint=\"txtRepeatPassword\"/></div>\n\n    <span style=\"position:absolute;top:60px;left:168px\" class=\"logonLabel\">\n        <a href=\"javascript://\" class=\"versaLink\" dojoattachpoint=\"aReturn\">Return to log in</a>\n    </span>\n\n    <div style=\"position:absolute;top:32px;left:336px;\">\n        <button dojoAttachPoint=\"logonButtonNode\" type=\"submit\"></button>\n    </div>\n</div>\n</div>\n"),_btnSubmit:null,_frmLogon:null,_txtNewPassword:null,_txtRepeatPassword:null,user:null,zone:null,_onSubmit:function(e){try{if(this._frmLogon.validate()){var _1=this._txtNewPassword.get("value");if(this.method=="user"){this.users.setValue(this.user,"new_password",_1);this.users.save();this.onSuccess(false);}else{if(this.method=="fingerprint"){this.users.reset(this.fingerprint,_1);this.onSuccess(true);}}}}catch(e){var _2=dojo.replace(bfree.widget.zone.Expired.ERR_MESSAGE,e);this.onError(_2);}finally{e.preventDefault();}},constructor:function(_3){if(_3.user){this.method="user";this.user=_3.user;}else{if(_3.fingerprint){this.method="fingerprint";this.fingerprint=_3.fingerprint;}}this.users=_3.users;this.zone=_3.zone;},onSuccess:function(){},onError:function(){},_passwordValidator:function(_4,_5){return this._txtNewPassword.get("value")==_4;},resetValue:function(){this.set("value","");},postCreate:function(){this.inherited("postCreate",arguments);this.statusMsgNode=dojo.byId("statusMsgNode");this.statusImgNode=dojo.byId("statusImgNode");this._frmLogon=new dijit.form.Form({onSubmit:dojo.hitch(this,this._onSubmit)},this.logonFormNode);this._txtNewPassword=new dijit.form.ValidationTextBox({name:"txtNewPassword",placeHolder:"Enter a new password",type:"password",required:true,invalidMessage:"Password must be unique and 8 characters in length.",promptMessage:"Password must be unique and 8 characters in length.",onFocus:dojo.hitch(this._txtNewPassword,this.resetValue)},this.txtNewPassword);this._txtRepeatPassword=new dijit.form.ValidationTextBox({name:"txtRepeatPassword",placeHolder:"Repeat your new password",type:"password",required:true,validator:dojo.hitch(this,this._passwordValidator),onFocus:dojo.hitch(this._txtRepeatPassword,this.resetValue)},this.txtRepeatPassword);this._btnSubmit=new dijit.form.Button({"class":"bfreeButton",iconClass:"buttonIcon bfreeIconLock",label:"Update",type:"submit"},this.logonButtonNode);dojo.connect(this.aReturn,"onclick",this,this.onReturn);this._txtNewPassword.focus();},onReturn:function(){if(this.method=="fingerprint"){var _6=dojo.replace("window.top.location='{0}'",[url]);setTimeout(_6,1000);}else{if(this.method=="user"){this.zone.logoff();var _6=dojo.replace("window.top.location='{0}'",[url]);setTimeout(_6,1000);}}}});bfree.widget.zone.Expired.STS_CODES={"ERR":0,"OK":1};bfree.widget.zone.Expired.ERR_MESSAGE="Error: <b>{message}</b>";bfree.widget.zone.Expired.OK_MESSAGE="Success: <b>Your password has been changed.</b>";}