/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.Dialog"]){dojo._hasResource["bfree.widget.Dialog"]=true;dojo.provide("bfree.widget.Dialog");dojo.require("bfree.widget.Button");dojo.require("bfree.widget.ErrorManager");dojo.require("bfree.widget.Standby");dojo.require("dijit.Dialog");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.declare("bfree.widget.Dialog",[dijit.Dialog],{templateString:null,templateString:dojo.cache("bfree/widget","template/Dialog.html","<div class=\"dijitDialog\" role=\"dialog\" aria-labelledby=\"${id}_title\">\n\n\t<div data-dojo-attach-point=\"titleBar\" class=\"dijitDialogTitleBar\">\n\t<span data-dojo-attach-point=\"titleNode\" class=\"dijitDialogTitle\" id=\"${id}_title\"></span>\n\t<span data-dojo-attach-point=\"closeButtonNode\" class=\"dijitDialogCloseIcon\" data-dojo-attach-event=\"ondijitclick: _onDialogCancel\" title=\"${buttonCancel}\" role=\"button\" tabIndex=\"-1\">\n\t\t<span data-dojo-attach-point=\"closeText\" class=\"closeText\" title=\"${buttonCancel}\">x</span>\n\t</span>\n\t</div>\n\t<div    data-dojo-attach-point=\"containerNode\"\n            class=\"dijitDialogPaneContent\"\n            style=\"overflow:hidden;padding:0 !important;position:absolute;top:0;left:0;height:100% !important;width:100% !important;z-index:-1\">\n\n        <div \tdata-dojo-type=\"dijit.layout.BorderContainer\"\n                data-dojo-props='design:\"headline\",gutters:false,style:\"width:100%;height:100%\"'>\n\n            <div \tdata-dojo-type=\"dijit.layout.ContentPane\"\n                    data-dojo-props='region:\"top\",splitter:false,style:\"height:8px\"'>\n                <!-- buffer for header -->\n\t\t\t</div>\n\n            <div \tdata-dojo-type=\"dijit.layout.BorderContainer\"\n                    data-dojo-attach-point=\"mainWidget\"\n                    data-dojo-props='region:\"center\",splitter:false,design:\"headline\",gutters:false,style:\"width:100%;height:100%\"'>\n\n               <div \tdata-dojo-type=\"dijit.layout.ContentPane\"\n                        data-dojo-props='region:\"center\",splitter:false,style:\"padding:0;overflow:hidden\"'>\n                    <div data-dojo-attach-point=\"widgetNode\" style=\"height:100%;width:100%;\"></div>\n                </div>\n\n                <div \tdata-dojo-attach-point=\"buttonPane\"\n                        data-dojo-type=\"dijit.layout.ContentPane\"\n                        data-dojo-props='region:\"bottom\",splitter:false,style:\"height:36px;padding:0 8px 0 0;text-align:right\"'>\n\n                    <div data-dojo-attach-point=\"btnOkNode\"></div>\n                    <div data-dojo-attach-point=\"btnCancelNode\"></div>\n                    <div data-dojo-attach-point=\"btnCloseNode\"></div>\n\n                </div>\n\n             </div>\n\n        </div>\n\n\t</div>\n    <div data-dojo-attach-point=\"standbyNode\"></div>\n</div>\n"),widgetsInTemplate:true,widget:null,width:640,height:480,shown:false,_buttons:[],_wdgBusy:null,_buildWidget:function(){try{this.widget=new this.widgetConstructor(this.widgetParams,this.widgetNode);this.widget.dialog=this;dojo.connect(this.widget,"onWidgetLoaded",dojo.hitch(this,this._onWidgetLoaded));dojo.connect(this.widget,"onValueChange",dojo.hitch(this,this._onValueChange));dojo.connect(this.widget,"onDialogClose",dojo.hitch(this,this._onClose));this.widget.startup();this.widget.focus();}catch(e){this._wdgBusy.hide();var _1=new bfree.api.Error("Failed to create widget",e);bfree.widget.ErrorManager.handleError({error:_1});}finally{this.onLoad();}},_onClose:function(_2){var _3=true;try{this.onClosing();if(this.widget){_3=this.widget.onDialogClosing(_2);if(_3){_3&=this.onClose(_2,this.widget.returnValue);}}}catch(e){var _4=new bfree.api.Error("Failed to close dialog box",e);bfree.widget.ErrorManager.handleError({error:_4});_3=false;}if(!_3){}else{this.hide();}},_onDialogCancel:function(_5){this._onClose(bfree.widget.Dialog.dialogResult.cancel);},_onShow:function(){if(!this.shown){var _6=bfree.widget.Dialog.buildWidgetFnRef(this);setTimeout(_6,100);this.shown=true;}},_onValueChange:function(){this._setState();},_onWidgetLoaded:function(){this._wdgBusy.hide();},_setState:function(){var _7=false;if(this.widget){_7=this.widget.isValid();}this._btnOk.set("disabled",!_7);},constructor:function(_8){},onClose:function(){return true;},onClosing:function(){},onHide:function(){setTimeout(bfree.widget.Dialog.destroyFnRef(this),this.duration);},onLoad:function(){},postCreate:function(){this.inherited("postCreate",arguments);var vp=dijit.getViewport();if(this.height>(vp.h-8)){this.height=(vp.h-8);}if(this.width>(vp.w-8)){this.width=(vp.w-8);}this._setStyleAttr({width:this.width+"px",height:this.height+"px"});this._wdgBusy=new bfree.widget.Standby({target:this.mainWidget.domNode,color:"white",showOnStart:true,opacity:0.75,zIndex:2048},this.standbyNode);this._wdgBusy.startup();this._wdgBusy.show();if(this.buttons&bfree.widget.Dialog.buttons.ok){this._btnOk=new bfree.widget.Button({"class":"versaButton",iconClass:"buttonIcon bfreeIconOk",disabledIconClass:"buttonIcon bfreeIconOkD",label:"OK",disabled:true,onClick:dojo.hitch(this,this._onClose,bfree.widget.Dialog.dialogResult.ok)},this.btnOkNode);}if(this.buttons&bfree.widget.Dialog.buttons.cancel){new dijit.form.Button({"class":"versaButton",iconClass:"buttonIcon bfreeIconCancel",disabledIconClass:"buttonIcon bfreeIconCancelD",label:"Cancel",onClick:dojo.hitch(this,this._onClose,bfree.widget.Dialog.dialogResult.cancel)},this.btnCancelNode);}if(this.buttons&bfree.widget.Dialog.buttons.close){this._buttons.push(new bfree.widget.Button({"class":"versaButton",iconClass:"buttonIcon bfreeIconClose",disabledIconClass:"buttonIcon bfreeIconCloseD",label:"Close",onClick:dojo.hitch(this,this._onClose,bfree.widget.Dialog.dialogResult.cancel)},this.btnCloseNode));}if(this.buttons==bfree.widget.Dialog.buttons.none){dojo.style(this.buttonPane.domNode,{display:"none"});}dojo.removeAttr(this.titleBar,"title");},resize:function(_9){this.inherited("resize",arguments);this.widget.resize();this._position();},startup:function(){this.inherited("startup",arguments);}});bfree.widget.Dialog.dialogResult={none:0,ok:1,cancel:2,abort:3,retry:4,ignore:5,yes:6,no:7};bfree.widget.Dialog.buttons={none:0,ok:1,cancel:2,close:4};bfree.widget.Dialog.destroyFnRef=function(_a){return (function(){try{if(_a.widget){_a.widget.destroy();_a.widget=null;}if(this._wdgBusy){_a._wdgBusy.hide();_a._wdgBusy.destroy();_a._wdgBusy=null;}_a.destroy();}catch(e){}});};bfree.widget.Dialog.buildWidgetFnRef=function(_b){return (function(){_b._buildWidget();});};}