/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.Edit"]){dojo._hasResource["bfree.widget.document.Edit"]=true;dojo.provide("bfree.widget.document.Edit");dojo.require("bfree.api.Documents");dojo.require("bfree.widget._DialogWidget");dojo.require("bfree.widget.document.GridItem");dojo.require("bfree.widget.propdef.PropertyEditor");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.declare("bfree.widget.document.Edit",[dijit._Widget,dijit._Templated,bfree.widget._DialogWidget],{templateString:null,templateString:dojo.cache("bfree/widget/document","template/Edit.html","<div style=\"width:100%;height:100%\">\n\n<div \tdojoType=\"dijit.layout.BorderContainer\"\n\t\tdojoAttachPoint=\"pneMain\"\n\t\tdesign=\"headline\" \n\t\tgutters=\"false\" \n\t\tstyle=\"width:100%;height:100%\">\n\t\t\n\t\t\n<div \tdojoType=\"dijit.layout.BorderContainer\"\n\t\tdesign=\"headline\" \n\t\tgutters=\"false\"\n\t\tregion=\"center\" \t\t\t\t\n\t\tsplitter=\"true\" \n\t\tstyle=\"padding:8px 8px 0 8px\">\n\t\t\n\t<div \tdojoType=\"dijit.layout.ContentPane\"\t\t\t\t\t\t\t\n\t\t\tregion=\"top\" \t\t\t\t\n\t\t\tsplitter=\"false\" \n\t\t\tstyle=\"position:relative;overflow:hidden;height:32px;padding:0;\">\n\t\t\t\n\t\t<div dojoAttachPoint=\"docInfoNode\"></div>\t\t\t\n\t\t\t\n\t</div>\n\t\n\t<div \tdojoType=\"dijit.layout.ContentPane\"\t\t\t\t\t\t\t\n\t\t\tregion=\"center\" \t\t\t\t\n\t\t\tsplitter=\"false\" \n\t\t\tstyle=\"position:relative;overflow:hidden;padding:0;\">\n\t\t\t\n\t\t<div \tdojoType=\"dijit.layout.BorderContainer\"\n\t\t\t\tdesign=\"headline\" \n\t\t\t\tgutters=\"false\"\n\t\t\t\tregion=\"center\" \t\t\t\t\n\t\t\t\tsplitter=\"true\" \n\t\t\t\tstyle=\"\">\n\t\t\t\t\n\t\t\t<div \tdojoType=\"dijit.layout.ContentPane\"\t\t\t\t\t\t\t\n\t\t\t\t\tregion=\"center\" \t\t\t\t\n\t\t\t\t\tsplitter=\"false\" \n\t\t\t\t\tstyle=\"position:relative;overflow:hidden;padding:0;\">\n\t\t\t\t\t\n\t\t\t\t<div dojoAttachPoint=\"propertyEditorNode\"></div>\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t</div>\t\n\t\t\t\n\t\t\t<div \tdojoType=\"dijit.layout.ContentPane\"\t\t\t\t\t\t\t\n\t\t\t\t\tregion=\"bottom\" \t\t\t\t\n\t\t\t\t\tsplitter=\"false\" \n\t\t\t\t\tstyle=\"height:112px;position:relative;overflow:hidden;padding:8px 8px 0 8px;\">\n\t\t\t\t\t\n\t\t\t\t<table style=\"width:100%\" border=\"0\">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"mediumLabel darkBoldLabel\" style=\"padding-right:4px;white-space:nowrap;\">\n\t\t\t\t\t\t\tDocument Id:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td dojoAttachPoint=\"docIdNode\" class=\"mediumLabel darkLabel\" style=\"width:100%\">\t\t\t\t\t\t\t\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"mediumLabel darkBoldLabel\" style=\"padding-right:4px;white-space:nowrap;\">\n\t\t\t\t\t\t\tChecked Out: \n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td dojoAttachPoint=\"docCheckedOutNode\" class=\"mediumLabel darkLabel\">\t\t\t\t\t\t\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"mediumLabel darkBoldLabel\" style=\"padding-right:4px;white-space:nowrap;\">\n\t\t\t\t\t\t\tChecked Out By:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td dojoAttachPoint=\"docCheckedOutByNode\" class=\"mediumLabel darkLabel\">\t\t\t\t\t\t\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"mediumLabel darkBoldLabel\" style=\"padding-right:4px;white-space:nowrap;\">\n\t\t\t\t\t\t\tCreated By:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td dojoAttachPoint=\"docCreatedByNode\" class=\"mediumLabel darkLabel\">\t\t\t\t\t\t\n\t\t\t\t\t\t</td>\t\t\t\t\t\t\n\t\t\t\t\t</tr>\t\t\t\t\t\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"mediumLabel darkBoldLabel\" style=\"padding-right:4px;white-space:nowrap;\">\n\t\t\t\t\t\t\tCreated At:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td dojoAttachPoint=\"docCreatedAtNode\" class=\"mediumLabel darkLabel\">\t\t\t\t\t\t\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\t\t\t\t\t\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"mediumLabel darkBoldLabel\" style=\"padding-right:4px;white-space:nowrap;\">\n\t\t\t\t\t\t\tLast Modified By:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td dojoAttachPoint=\"docUpdatedByNode\" class=\"mediumLabel darkLabel\">\t\t\t\t\t\t\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"mediumLabel darkBoldLabel\" style=\"padding-right:4px;white-space:nowrap;\">\n\t\t\t\t\t\t\tLast Modified At:\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td dojoAttachPoint=\"docUpdatedAtNode\" class=\"mediumLabel darkLabel\">\t\t\t\t\t\t\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\n\t\t\t</div>\n\t\t\t\t\n\t\t</div>\t\t\t\n\t\t\t\n\t</div>\n\t\t\n\t<div \tdojoType=\"dijit.layout.ContentPane\"\t\t\t\t\t\t\t\n\t\t\tregion=\"bottom\" \t\t\t\t\n\t\t\tsplitter=\"false\" \n\t\t\tstyle=\"position:relative;overflow:hidden;height:36px;padding:0;text-align:right;\">\n\t\t\t\n\t\t<div id=\"btnOkNode\">\n\t\t\t<div style=\"width:40px\">OK</div>\n\t\t</div>\n\t\t\n\t\t<div id=\"btnCancelNode\">\n\t\t\t<div style=\"width:40px\">Cancel</div>\n\t\t</div>\t\t\t\n\t\t\t\n\t</div>\t\t\n\t\t\t\n</div>\t\t\n\t\t\n</div>\n\n</div>\n"),widgetsInTemplate:true,library:null,documentTypes:null,documents:null,user:null,document:null,documentType:null,_btnCancel:null,_btnOk:null,_wdgDocumentInfo:null,_wdgPropertyEditor:null,_saveDocument:function(){if(!this._wdgPropertyEditor.validate()){return;}this._wdgPropertyEditor.copyProperties({document:this.document});this.document.updated_by=this.user.name;this.documents.update({document:this.document});},_btnCancel_onClick:function(_1){this.dialogResult=bfree.widget.Dialog.dialogResult.cancel;this._closeDialog();},_btnOk_onClick:function(_2){this.dialogResult=bfree.widget.Dialog.dialogResult.ok;this._closeDialog();},onDialogClosing:function(_3){var _4=_3;var _5=false;try{if(_4==bfree.widget.Dialog.dialogResult.ok){this._saveDocument();}_5=true;}catch(e){_5=false;this.documents.revert();var _6=new bfree.api.Error("Failed to save document property changes",e);bfree.widget.ErrorManager.handleError({error:_6});}return _5;},postCreate:function(){this.inherited("postCreate",arguments);this.documentType=this.documentTypes.fetchById({id:this.document.document_type_id});this._wdgDocumentInfo=new bfree.widget.document.GridItem({name:this.document.name,documentType:this.documentType.name,size:this.document.current_version.size},this.docInfoNode);var _7=bfree.EditorHelper.getValues({document:this.document});this._wdgPropertyEditor=new bfree.widget.propdef.PropertyEditor({hideDocTypes:false,zone:this.zone,library:this.library,documentTypes:this.documentTypes,documentType:this.documentType,documents:this.documents,valueCache:_7},this.propertyEditorNode);this._wdgPropertyEditor.startup();this.docIdNode.innerHTML=this.document.id;this.docCheckedOutNode.innerHTML=bfree.api.Documents.isCheckedOut({document:this.document});this.docCheckedOutByNode.innerHTML=this.document.checked_out_by!=null?this.document.checked_out_by:"Nobody";this.docCreatedByNode.innerHTML=this.document.created_by;this.docCreatedAtNode.innerHTML=this.document.created_at.toLocaleString();this.docUpdatedByNode.innerHTML=this.document.updated_by;this.docUpdatedAtNode.innerHTML=this.document.updated_at.toLocaleString();this._btnOk=new dijit.form.Button({iconClass:"buttonIcon bfreeIconOk",onClick:dojo.hitch(this,this._btnOk_onClick)},dojo.byId("btnOkNode"));this._btnCancel=new dijit.form.Button({iconClass:"buttonIcon bfreeIconCancel",onClick:dojo.hitch(this,this._btnCancel_onClick)},dojo.byId("btnCancelNode"));}});}