/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.Grid"]){dojo._hasResource["bfree.widget.document.Grid"]=true;dojo.provide("bfree.widget.document.Grid");dojo.require("dojo.date.locale");dojo.require("bfree.api.Search");dojo.require("bfree.widget._Grid");dojo.require("bfree.widget.Utils");dojo.require("bfree.widget.document.ContextMenu");dojo.require("bfree.widget.document.Move");dojo.require("bfree.widget.document.ViewMenu");dojo.declare("bfree.widget.document.Grid",bfree.widget._Grid,{_documents:null,library:null,activeView:null,activeFolder:null,zone:null,dndType:"Document",deleting:false,_canSort:function(_1){if(_1==1||this._isLoading){return false;}else{return true;}},_onCommand:function(_2,_3,_4){this.onCommand(_2,_3,_4);},selectItem:function(_5){},_onRowContextMenu:function(_6){if((this._mnuDocument==null)||(_6.rowIndex<0)){this.rowHit=false;_6.cancelBubble=true;}else{var _7=this.selection.selected[_6.rowIndex];var _8;if(_7){if(this.selection.getSelectedCount()==1){_8=this.getItem(_6.rowIndex);}else{_8=this.selection.getSelected();}this.setSelectedIndex(_6.rowIndex);}else{this.selection.clear();_8=this.getItem(_6.rowIndex);this.selection.select(_6.rowIndex);this._mnuDocument.rowHit=true;this._mnuDocument.activeItem=_8;this._mnuDocument.activeFolder=this.activeFolder;}this._mnuDocument.rowHit=true;this._mnuDocument.activeItem=_8;this._mnuDocument.activeFolder=this.activeFolder;}},_onViewChange:function(_9,_a){this.focus.findAndFocusGridCell();this.activeView=_9;this.set("structure",_9);this.set("sortInfo",_9.sort_column);this.onViewChange(_9);},_onViewNew:function(_b){this.onViewNew(_b);},_setActiveQueryAttr:function(_c){_c["view"]=this.activeView.id;this.setQuery(_c,{cache:false});},sort:function(){this.setQuery(this.query,{cache:false});},constructor:function(_d){_d=(!_d)?{}:_d;dojo.safeMixin(this,_d);this.updateDelay=0;this.rowsPerPage=25;this.queryOptions={cache:false};this.selectionMode="extended";this.clientSort=false;this.canSort=this._canSort;this.noDataMessage="No Documents Found";},export_results:function(_e){var _f=bfree.api.Utilities.getBox({scale:0.75});var _10=this.getSortProps();this._documents.export_query({zone:this.zone,library:this.library,windowBox:_f,type:_e,query:this.get("query"),sort:((_10)&&(_10.length>0))?_10[0]:null});},postCreate:function(){this.inherited("postCreate",arguments);this._documents=this.library.getDocuments();var _11=this.library.getViewDefinitions().fetch()[0];this.activeView=_11.getView(this.library);this._mnuDocument=new bfree.widget.document.ContextMenu({onCommand:dojo.hitch(this,this._onCommand),activeLibrary:this.library,activeUser:this.user,documents:this._documents,refresh:dojo.hitch(this,this.refresh),targetNodeIds:[this.id]});this._mnuView=new bfree.widget.document.ViewMenu({library:this.library,viewDefinitions:this.library.getViewDefinitions(),parentMenu:this});this._mnuView.startup();this.onRowContextMenu=dojo.hitch(this,this._onRowContextMenu);this._mnuView.onChange=dojo.hitch(this,this._onViewChange);this.onHeaderContextMenu=dojo.hitch(this,this._onHeaderContextMenu);this._mnuView.set("activeView",this.activeView);this.set("headerMenu",this._mnuView);},onCommand:function(_12,_13,_14){},onRowDblClick:function(evt){if(evt.rowIndex<0){evt.cancelBubble=true;return;}var _15=this.getItem(evt.rowIndex);this._onCommand(bfree.widget.Bfree.Commands.VIEW,bfree.widget.Bfree.ObjectTypes.DOCUMENT,{document:_15});},onViewChange:function(_16,evt){},onViewNew:function(evt){},_onHeaderContextMenu:function(evt){this._mnuView.rowHit=true;},refreshViews:function(){this._mnuView.refresh();},print_results:function(){var box=bfree.api.Utilities.getBox({scale:0.75});var _17=this.getSortProps();this._documents.print_query({zone:this.zone,library:this.library,windowBox:box,query:this.get("query"),sort:((_17)&&(_17.length>0))?_17[0]:null});},setBusy:function(_18){var idx=this.getItemIndex(_18);var _19=this.getRowNode(idx);var e=_19.getElementsByTagName("img");dojo.forEach(e,function(_1a,idx){if(_1a.name=="statusIcon"){dojo.attr(_1a,"src","/images/loading/loading16.gif");}});},startup:function(){this.inherited("startup",arguments);this.setStore(this._documents.store,{type:bfree.api.Search.types.NONE});}});}