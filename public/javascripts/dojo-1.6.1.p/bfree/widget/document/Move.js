/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.Move"]){dojo._hasResource["bfree.widget.document.Move"]=true;dojo.provide("bfree.widget.document.Move");dojo.require("bfree.widget._DialogWidget");dojo.require("bfree.widget.folder.Tree");dojo.require("bfree.widget.document.Header");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.declare("bfree.widget.document.Move",[dijit._Widget,dijit._Templated,bfree.widget._DialogWidget],{templateString:dojo.cache("bfree/widget/document","template/Move.html","<div style=\"height:100%;width:100%;\">\n\n<div    dojoType=\"dijit.layout.BorderContainer\"\n        design=\"headline\"\n        gutters=\"false\"\n        style=\"padding:0px 8px 4px 8px;height:100%;width:100%;\">\n\n     <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"top\"\n            splitter=\"false\"\n            style=\"overflow:hidden;height:32px\">\n\n         <div dojoAttachPoint=\"headerNode\"></div>\n\n    </div>\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n                splitter=\"false\"\n                region=\"center\"\n                splitter=\"true\"\n                style=\"padding:8px\"\n                class=\"highlightPane\">\n\n       <div dojoAttachPoint=\"treeNode\"></div>\n\n    </div>\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"bottom\"\n            splitter=\"false\"\n            style=\"padding:8px;overflow:hidden;height:32px\">\n\n\n    </div>\n\n</div>\n\n</div>\n"),widgetsInTemplate:true,_documents:null,_documentType:null,_tvwFolders:null,activeFolder:null,documents:null,folder:null,library:null,zone:null,_tvwFolders_onSelected:function(_1,_2){this.activeFolder=_1;this.onValueChange();},constructor:function(_3){},destroy:function(){if(this._tvwFolders){this._tvwFolders.destroy();this._tvwFolders=null;}this.inherited("destroy",arguments);},isValid:function(){return true;},onDialogClosing:function(_4){var _5=false;try{if(_4==bfree.widget.Dialog.dialogResult.ok){if((!this.activeFolder)||(this.activeFolder.root)){dojo.forEach(this.documents,function(_6,_7){this._documents.setValue(_6,"folder_id",0);});}else{dojo.forEach(this.documents,dojo.hitch(this,function(_8,_9){this._documents.setValue(_8,"folder_id",this.activeFolder.id);}));}this._documents.save({onComplete:dojo.hitch(this,this.onBeforeClose,bfree.widget.Dialog.dialogResult.ok)});_5=true;}else{_5=true;}}catch(e){var _a=new bfree.api.Error("Failed to close 'Edit Document' dialog",e);bfree.widget.ErrorManager.handleError({error:_a});}return _5;},postCreate:function(){this.inherited("postCreate",arguments);this._documents=this.library.getDocuments();this._documentType=this.library.getDocumentTypes().fetchById({id:this.documents[0].document_type_id});this._header=new bfree.widget.document.Header({document:this.documents[0],documentType:this._documentType},this.headerNode);this._tvwFolders=new bfree.widget.folder.Tree({id:"tvwFolders",library:this.library,folders:this.library.getFolders(),isSearchHidden:true,isTrashHidden:true,onSelected:dojo.hitch(this,this._tvwFolders_onSelected),style:"height: 100%"},this.treeNode);},startup:function(){this.inherited("startup",arguments);this._tvwFolders.startup();if((this.folder)&&(this.folder.path)){this._tvwFolders.set("path",this.folder.path);}}});bfree.widget.document.Move.show=function(_b){var _c=_b.documents.length?dojo.replace("Move {length} documents",_b.documents):dojo.replace("Move document: {name}",_b.documents);if(!_b.documents.length){_b.documents=[_b.documents];}var _d=new bfree.widget.Dialog({id:"dlgMoveDocument",title:_c,widgetConstructor:bfree.widget.document.Move,widgetParams:{documents:_b.documents,folder:_b.folder,library:_b.library,zone:_b.zone,onBeforeClose:_b.onBeforeClose},noResize:true,height:480,width:480,zIndex:1024,buttons:bfree.widget.Dialog.buttons.ok|bfree.widget.Dialog.buttons.cancel,onClose:_b.onClose});_d.startup();_d.show();};}