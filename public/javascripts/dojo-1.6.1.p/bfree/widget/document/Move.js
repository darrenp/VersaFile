/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.Move"]){dojo._hasResource["bfree.widget.document.Move"]=true;dojo.provide("bfree.widget.document.Move");dojo.require("bfree.widget._DialogWidget");dojo.require("bfree.widget.folder.Tree");dojo.require("bfree.widget.document.Header");dojo.require("dijit._Templated");dojo.require("dijit._Widget");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.declare("bfree.widget.document.Move",[dijit._Widget,dijit._Templated,bfree.widget._DialogWidget],{templateString:dojo.cache("bfree/widget/document","template/Move.html","<div style=\"height:100%;width:100%;\">\n\n<div    dojoType=\"dijit.layout.BorderContainer\"\n        design=\"headline\"\n        gutters=\"false\"\n        style=\"padding:8px;height:100%;width:100%;\">\n\n     <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"top\"\n            splitter=\"false\"\n            style=\"padding:0;overflow:hidden;height:20px\">\n        <!-- Does not handle multi-select yet -->\n        <!-- div dojoAttachPoint=\"headerNode\"></div -->\n        <span dojoAttachPoint=\"folderNameNode\" class=\"dijitDarkLabel dijitMediumLabel\">Select Folder:</span>\n\n    </div>\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n                splitter=\"false\"\n                region=\"center\"\n                splitter=\"true\"\n                style=\"padding:0\"\n                class=\"highlightPane\">\n\n       <div dojoAttachPoint=\"treeNode\"></div>\n\n    </div>\n\n</div>\n\n</div>\n"),widgetsInTemplate:true,_tvwFolders:null,activeFolder:null,references:null,folder:null,library:null,zone:null,_doCancel:function(){var _1=false;try{_1=true;}catch(e){var _2=new bfree.api.Error("Failed to revert changes",e);bfree.widget.ErrorManager.handleError({error:_2});}return _1;},_doSave:function(){var _3=false;try{dojo.forEach(this.references,function(_4,_5){_4.file({zone:this.zone,library:this.library,folder:this.activeFolder});},this);_3=true;}catch(e){var _6=new bfree.api.Error("Failed to move documents to folder",e);bfree.widget.ErrorManager.handleError({error:_6});}return _3;},_loadItems:function(){try{if((this.folder)&&(this.folder.path)){this._tvwFolders.set("path",this.folder.path);}}finally{this.onWidgetLoaded();}},_tvwFolders_onSelected:function(_7,_8){this.activeFolder=_7;this.onValueChange();},constructor:function(_9){},destroy:function(){if(this._tvwFolders){this._tvwFolders.destroy();this._tvwFolders=null;}this.inherited("destroy",arguments);},isValid:function(){return (this.activeFolder!==this.folder);},onDialogClosing:function(_a){var _b=false;try{this.returnValue=this.references;_b=(_a==bfree.widget.Dialog.dialogResult.ok)?this._doSave():this._doCancel();}catch(e){var _c=new bfree.api.Error("Failed to close 'Edit Document' dialog",e);bfree.widget.ErrorManager.handleError({error:_c});}return _b;},postCreate:function(){this.inherited("postCreate",arguments);this._tvwFolders=new bfree.widget.folder.Tree({id:"tvwFolders",library:this.library,folders:this.library.getFolders(),isSearchHidden:true,isTrashHidden:true,isShareRootHidden:true,onSelected:dojo.hitch(this,this._tvwFolders_onSelected),style:"height: 100%"},this.treeNode);},startup:function(){this.inherited("startup",arguments);this._tvwFolders.startup();setTimeout(bfree.widget.document.Move._loadFnRef(this),10);}});bfree.widget.document.Move._loadFnRef=function(_d){return (function(){_d._loadItems();});};bfree.widget.document.Move.show=function(_e){var _f=(dojo.isArray(_e.items)&&(_e.items.length>1))?dojo.replace("Move {length} documents",_e.items):dojo.replace("Move document: {name}",_e.items[0]);var dlg=new bfree.widget.Dialog({id:"dlgMoveDocument",title:_f,widgetConstructor:bfree.widget.document.Move,widgetParams:{references:_e.items,folder:_e.folder,library:_e.library,zone:_e.zone},noResize:true,height:480,width:480,zIndex:1024,buttons:bfree.widget.Dialog.buttons.ok|bfree.widget.Dialog.buttons.cancel,onClose:_e.onClose});dlg.startup();dlg.show();};}