/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.ContextMenu"]){dojo._hasResource["bfree.widget.document.ContextMenu"]=true;dojo.provide("bfree.widget.document.ContextMenu");dojo.require("bfree.widget.Bfree");dojo.require("bfree.widget.HeaderMenu");dojo.declare("bfree.widget.document.ContextMenu",bfree.widget.HeaderMenu,{_btnDocACL:null,_btnDocCancelCKO:null,_btnDocCKI:null,_btnDocCKO:null,_btnDocCopy:null,_btnDocDelete:null,_btnDocEdit:null,_btnDocMove:null,_btnDocView:null,_btnDocDestroy:null,_btnDocRestore:null,_btnVersions:null,_arrDivides:[],menuLabel:"Document",activeItem:null,activeLibrary:null,activeUser:null,activeFolder:null,documents:null,refresh:function(){},_onCommand:function(_1,_2,e){this.onCommand(_1,_2,{document:this.activeItem});},_openMyself:function(_3){this._setState();try{if((!this.rowHit)||(this.activeItem==null)){_3.cancelBubble=true;_3.returnValue=false;}else{var _4=this.documents.query({query:(this.activeItem.length?this.activeItem[0]:this.activeItem).id});if(_4.length==0||(_4.isDeleted()&&!this.activeFolder.is_trash)){alert(dojo.replace("Document {name} has been deleted.",this.activeItem[0]));this.refresh();_3.cancelBubble=true;_3.returnValue=false;}else{this.inherited("_openMyself",arguments);}}}finally{this.rowHit=false;}},_setState:function(){var _5=false;if(!this.activeItem.length||this.activeItem.length==1){_5=true;}if((!this.activeItem.length&&this.activeItem.getState(bfree.api.Document.states.DELETED))||(this.activeItem[0]&&this.activeItem[0].getState(bfree.api.Document.states.DELETED))){dojo.forEach(this._arrDivides,function(_6,_7){dojo.toggleClass(_6.domNode,"versaHide",true);},this);dojo.toggleClass(this._btnDocView.domNode,"versaHide",true);dojo.toggleClass(this._btnDocCopy.domNode,"versaHide",true);dojo.toggleClass(this._btnDocEdit.domNode,"versaHide",true);dojo.toggleClass(this._btnDocMove.domNode,"versaHide",true);dojo.toggleClass(this._btnDocCKO.domNode,"versaHide",true);dojo.toggleClass(this._btnDocCKI.domNode,"versaHide",true);dojo.toggleClass(this._btnDocCancelCKO.domNode,"versaHide",true);dojo.toggleClass(this._btnDocDelete.domNode,"versaHide",true);dojo.toggleClass(this._btnDocACL.domNode,"versaHide",true);dojo.toggleClass(this._btnVersions.domNode,"versaHide",true);dojo.toggleClass(this._btnDocRestore.domNode,"versaHide",false);dojo.toggleClass(this._btnDocDestroy.domNode,"versaHide",false);}else{dojo.forEach(this._arrDivides,function(_8,_9){dojo.toggleClass(_8.domNode,"versaHide",false);},this);dojo.toggleClass(this._btnDocView.domNode,"versaHide",false);dojo.toggleClass(this._btnDocCopy.domNode,"versaHide",false);dojo.toggleClass(this._btnDocEdit.domNode,"versaHide",false);dojo.toggleClass(this._btnDocMove.domNode,"versaHide",false);dojo.toggleClass(this._btnDocCKO.domNode,"versaHide",false);dojo.toggleClass(this._btnDocCKI.domNode,"versaHide",false);dojo.toggleClass(this._btnDocCancelCKO.domNode,"versaHide",false);dojo.toggleClass(this._btnDocDelete.domNode,"versaHide",false);dojo.toggleClass(this._btnDocACL.domNode,"versaHide",false);dojo.toggleClass(this._btnVersions.domNode,"versaHide",false);dojo.toggleClass(this._btnDocRestore.domNode,"versaHide",true);dojo.toggleClass(this._btnDocDestroy.domNode,"versaHide",true);var _a=bfree.api.Document.getPermissionSet(this.activeItem.length?this.activeItem[0]:this.activeItem,null,this.activeLibrary,this.activeUser);this._btnDocView.set("disabled",!(_a[bfree.api.Document.permissionIndices.VIEW]&&_5));this._btnVersions.set("disabled",!(_a[bfree.api.Document.permissionIndices.VIEW]&&_5));this._btnDocCopy.set("disabled",!(_a[bfree.api.Document.permissionIndices.COPY]&&_5));this._btnDocEdit.set("disabled",!(_a[bfree.api.Document.permissionIndices.EDIT]&&_5));this._btnDocMove.set("disabled",!(_a[bfree.api.Document.permissionIndices.MOVE]));this._btnDocCKO.set("disabled",!(_a[bfree.api.Document.permissionIndices.CKO]&&_5));this._btnDocCKI.set("disabled",!(_a[bfree.api.Document.permissionIndices.CKI]&&_5));this._btnDocCancelCKO.set("disabled",!(_a[bfree.api.Document.permissionIndices.CANCEL_CKO]&&_5));this._btnDocDelete.set("disabled",!(_a[bfree.api.Document.permissionIndices.DELETE]));this._btnDocACL.set("disabled",!(_a[bfree.api.Document.permissionIndices.SECURE]&&_5));}},constructor:function(_b){if(_b){dojo.safeMixin(this,_b);}},onHide:function(){this.activeItem=null;this.inherited("onHide",arguments);},onCommand:function(_c,_d,_e){},postCreate:function(){this.inherited("postCreate",arguments);this._btnDocView=new dijit.MenuItem({label:"View",disabled:true,iconClass:"menuIcon bfreeIconViewDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.VIEW,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocView);this._btnDocCopy=new dijit.MenuItem({label:"Copy Local...",disabled:true,iconClass:"menuIcon bfreeIconCopyDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.COPY,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCopy);this._btnDocEdit=new dijit.MenuItem({label:"Edit Properties",disabled:true,iconClass:"menuIcon bfreeIconEditDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.EDIT,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocEdit);this._btnVersions=new dijit.MenuItem({label:"Versions",disabled:true,iconClass:"menuIcon bfreeIconNewDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.VERSIONS,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnVersions);this._arrDivides[0]=new dijit.MenuSeparator();this.addChild(this._arrDivides[0]);this._btnDocMove=new dijit.MenuItem({label:"Move To Folder...",disabled:true,iconClass:"menuIcon bfreeIconMoveDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.MOVE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocMove);this._arrDivides[1]=new dijit.MenuSeparator();this.addChild(this._arrDivides[1]);this._btnDocCKO=new dijit.MenuItem({label:"Checkout",disabled:true,iconClass:"menuIcon bfreeIconCkoDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.CHECKOUT,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCKO);this._btnDocCKI=new dijit.MenuItem({label:"Checkin",disabled:true,iconClass:"menuIcon bfreeIconCkiDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.CHECKIN,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCKI);this._btnDocCancelCKO=new dijit.MenuItem({label:"Cancel Checkout",disabled:true,iconClass:"menuIcon bfreeIconCancelCkoDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.CANCEL_CKO,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCancelCKO);this._arrDivides[2]=new dijit.MenuSeparator();this.addChild(this._arrDivides[2]);this._btnDocDelete=new dijit.MenuItem({label:"Delete",disabled:true,iconClass:"menuIcon bfreeIconDeleteDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.DELETE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocDelete);this._arrDivides[3]=new dijit.MenuSeparator();this.addChild(this._arrDivides[3]);this._btnDocACL=new dijit.MenuItem({label:"Permissions...",disabled:true,iconClass:"menuIcon bfreeIconSecureDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.SECURE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocACL);this._btnDocRestore=new dijit.MenuItem({label:"Restore",iconClass:"menuIcon bfreeIconCkoDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.RESTORE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocRestore);this._btnDocDestroy=new dijit.MenuItem({label:"Delete Permanently",iconClass:"menuIcon bfreeIconDeleteDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.DELETE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocDestroy);}});}