/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.ContextMenu"]){dojo._hasResource["bfree.widget.document.ContextMenu"]=true;dojo.provide("bfree.widget.document.ContextMenu");dojo.require("bfree.widget.Bfree");dojo.require("bfree.widget.HeaderMenu");dojo.require("versa.api.PermissionSet");dojo.declare("bfree.widget.document.ContextMenu",bfree.widget.HeaderMenu,{_btnDocACL:null,_btnDocCancelCKO:null,_btnDocCKI:null,_btnDocCKO:null,_btnDocCopy:null,_btnDocDelete:null,_btnDocEdit:null,_btnDocMove:null,_btnDocView:null,_btnDocDestroy:null,_btnDocRestore:null,_btnVersions:null,_arrDivides:[],menuLabel:"Document",activeItems:[],activeLibrary:null,activeUser:null,activeFolder:null,documents:null,refresh:function(){},_onCommand:function(_1,_2,e){this.onCommand(_1,_2,{documents:this.activeItems});},_openMyself:function(_3){try{if((!this.rowHit)||(this.activeItems.length<1)){_3.cancelBubble=true;_3.returnValue=false;}else{this._setState();this.inherited("_openMyself",arguments);}}finally{this.rowHit=false;}},_setActiveItemsAttr:function(_4){this.activeItems=(_4==null)?[]:_4;},_setState:function(){var _5=false;var _6=new Object();var _7=(this.activeItems.length==1);dojo.some(this.activeItems,function(_8,_9){_5|=(_8.isDeleted()||this.activeFolder.isTrash());return _5;},this);var _a=_5;_6.VIEW=false;_6.COPY=false;_6.EDIT=(_5);_6.VERSIONS=(_5);_6.MOVE=(_5);_6.CKO=(_5);_6.CKI=(_5);_6.CANCEL_CKO=(_5);_6.DELETE=(_5);_6.SECURE=(_5);_6.RESTORE=(!_5);_6.DESTROY=(!_5);dojo.forEach(this._arrDivides,function(_b,_c){dojo.toggleClass(_b.domNode,"versaHide",_a);},this);dojo.toggleClass(this._btnDocView.domNode,"versaHide",_6.VIEW);dojo.toggleClass(this._btnDocCopy.domNode,"versaHide",_6.COPY);dojo.toggleClass(this._btnDocEdit.domNode,"versaHide",_6.EDIT);dojo.toggleClass(this._btnVersions.domNode,"versaHide",_6.VERSIONS);dojo.toggleClass(this._btnDocMove.domNode,"versaHide",_6.MOVE);dojo.toggleClass(this._btnDocCKO.domNode,"versaHide",_6.CKO);dojo.toggleClass(this._btnDocCKI.domNode,"versaHide",_6.CKI);dojo.toggleClass(this._btnDocCancelCKO.domNode,"versaHide",_6.CANCEL_CKO);dojo.toggleClass(this._btnDocDelete.domNode,"versaHide",_6.DELETE);dojo.toggleClass(this._btnDocACL.domNode,"versaHide",_6.SECURE);dojo.toggleClass(this._btnDocRestore.domNode,"versaHide",_6.RESTORE);dojo.toggleClass(this._btnDocDestroy.domNode,"versaHide",_6.DESTROY);var _d=(this.activeItems.length>0)?true:false;var _e=new versa.api.PermissionSet(_d);dojo.forEach(this.activeItems,function(_f,idx){var _10=_f.getPermissionSet(this.activeFolder,this.activeLibrary,this.activeUser);_e=_e.andSet(_10);},this);this._btnDocView.set("disabled",!(_e.getValue(versa.api.PermissionIndices.VIEW)&&_7));this._btnDocCopy.set("disabled",!(_e.getValue(versa.api.PermissionIndices.COPY)&&_7));this._btnDocEdit.set("disabled",!(_e.getValue(versa.api.PermissionIndices.EDIT)&&_7));this._btnVersions.set("disabled",!(_e.getValue(versa.api.PermissionIndices.EDIT)&&_7));this._btnDocMove.set("disabled",!(_e.getValue(versa.api.PermissionIndices.MOVE)));this._btnDocCKO.set("disabled",!(_e.getValue(versa.api.PermissionIndices.CKO)&&_7));this._btnDocCKI.set("disabled",!(_e.getValue(versa.api.PermissionIndices.CKI)&&_7));this._btnDocCancelCKO.set("disabled",!(_e.getValue(versa.api.PermissionIndices.CANCEL_CKO)&&_7));this._btnDocDelete.set("disabled",!(_e.getValue(versa.api.PermissionIndices.DELETE)));this._btnDocACL.set("disabled",!(_e.getValue(versa.api.PermissionIndices.SECURE)&&_7));this._btnDocRestore.set("disabled",!(_e.getValue(versa.api.PermissionIndices.RESTORE)));this._btnDocDestroy.set("disabled",!(_e.getValue(versa.api.PermissionIndices.DESTROY)));},constructor:function(_11){},onHide:function(){this.activeItem=null;this.inherited("onHide",arguments);},onCommand:function(_12,_13,_14){},postCreate:function(){this.inherited("postCreate",arguments);this._btnDocView=new dijit.MenuItem({label:"View",disabled:true,iconClass:"menuIcon bfreeIconViewDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.VIEW,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocView);this._btnDocCopy=new dijit.MenuItem({label:"Copy Local...",disabled:true,iconClass:"menuIcon bfreeIconCopyDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.COPY,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCopy);this._btnDocEdit=new dijit.MenuItem({label:"Edit Properties",disabled:true,iconClass:"menuIcon bfreeIconEditDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.EDIT,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocEdit);this._btnVersions=new dijit.MenuItem({label:"Versions",disabled:true,iconClass:"menuIcon bfreeIconNewDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.EDIT,bfree.widget.Bfree.ObjectTypes.VERSION)});this.addChild(this._btnVersions);this._arrDivides[0]=new dijit.MenuSeparator();this.addChild(this._arrDivides[0]);this._btnDocMove=new dijit.MenuItem({label:"Move To Folder...",disabled:true,iconClass:"menuIcon bfreeIconMoveDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.MOVE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocMove);this._arrDivides[1]=new dijit.MenuSeparator();this.addChild(this._arrDivides[1]);this._btnDocCKO=new dijit.MenuItem({label:"Checkout",disabled:true,iconClass:"menuIcon bfreeIconCkoDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.CHECKOUT,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCKO);this._btnDocCKI=new dijit.MenuItem({label:"Checkin",disabled:true,iconClass:"menuIcon bfreeIconCkiDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.CHECKIN,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCKI);this._btnDocCancelCKO=new dijit.MenuItem({label:"Cancel Checkout",disabled:true,iconClass:"menuIcon bfreeIconCancelCkoDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.CANCEL_CKO,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocCancelCKO);this._arrDivides[2]=new dijit.MenuSeparator();this.addChild(this._arrDivides[2]);this._btnDocDelete=new dijit.MenuItem({label:"Delete",disabled:true,iconClass:"menuIcon bfreeIconDeleteDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.DELETE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocDelete);this._arrDivides[3]=new dijit.MenuSeparator();this.addChild(this._arrDivides[3]);this._btnDocACL=new dijit.MenuItem({label:"Permissions...",disabled:true,iconClass:"menuIcon bfreeIconSecureDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.SECURE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocACL);this._btnDocRestore=new dijit.MenuItem({label:"Restore",disabled:true,iconClass:"menuIcon bfreeIconCkoDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.RESTORE,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocRestore);this._btnDocDestroy=new dijit.MenuItem({label:"Delete Permanently",disabled:true,iconClass:"menuIcon bfreeIconDeleteDocument",onClick:dojo.hitch(this,this._onCommand,bfree.widget.Bfree.Commands.DESTROY,bfree.widget.Bfree.ObjectTypes.DOCUMENT)});this.addChild(this._btnDocDestroy);}});}