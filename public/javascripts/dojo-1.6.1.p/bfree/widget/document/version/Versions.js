/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.version.Versions"]){dojo._hasResource["bfree.widget.document.version.Versions"]=true;dojo.provide("bfree.widget.document.version.Versions");dojo.require("bfree.widget.document.version.Grid");dojo.require("versa.widget.reference.Accessor");dojo.declare("bfree.widget.document.version.Versions",[dijit._Widget,dijit._Templated,bfree.widget._DialogWidget],{templateString:dojo.cache("bfree/widget/document/version","template/Versions.html","<div style=\"height:100%;width:100%;\">\n\n    <div    dojoType=\"dijit.layout.BorderContainer\"\n            design=\"headline\"\n            gutters=\"false\"\n            style=\"height:100%;width:100%;\">\n\n        <div    dojoType=\"dijit.layout.ContentPane\"\n                region=\"center\"\n                splitter=\"false\"\n                style=\"\">\n\n            <div dojoAttachPoint=\"gridNode\"></div>\n\n        </div>\n\n    </div>\n\n</div>\n"),widgetsInTemplate:true,_accessor:null,_document:null,_grdVersions:null,activeReference:null,library:null,references:null,zone:null,__onCopy:function(_1){var _2=_1.version;try{this._accessor.doCopyLocal(this.activeReference,_2.getId());}catch(e){var _3=new bfree.api.Error("Failed to copy document",e);bfree.widget.ErrorManager.handleError({error:_3});}},__onSynchronize:function(_4){var _5=_4.version;try{this._accessor.doSynchronize(this.activeReference,_5.getId());}catch(e){var _6=new bfree.api.Error("Failed to synchronize",e);bfree.widget.ErrorManager.handleError({error:_6});}},__onView:function(_7){var _8=_7.version;try{this._accessor.doView(this.activeReference,_8.getId());}catch(e){var _9=new bfree.api.Error("Failed to view version",e);bfree.widget.ErrorManager.handleError({error:_9});}},_loadItem:function(){this._document=this.library.getDocuments().refreshAsync({scope:this,identity:this.activeReference.document_id,onItem:this._onItemLoaded,onError:this._onItemError});},_onCommand:function(_a,_b,e){switch(_a){case bfree.widget.Bfree.Commands.VIEW:this.__onView(e);break;case bfree.widget.Bfree.Commands.COPY:this.__onCopy(e);break;case bfree.widget.Bfree.Commands.SYNCHRONIZE:this.__onSynchronize(e);break;}},_onItemError:function(e){try{var _c=new bfree.api.Error("Failed to load document",e);bfree.widget.ErrorManager.handleError({error:_c});}finally{this.onWidgetLoaded();}},_onItemLoaded:function(_d){try{this._document=_d;this._grdVersions.set("activeDocument",this._document);}finally{this.onWidgetLoaded();}},constructor:function(_e){},destroy:function(){if(this._grdVersions){this._grdVersions.destroyRecursive();this._grdVersions=null;}this.inherited("destroy",arguments);},onDialogClosing:function(){var _f=false;try{this.returnValue=this.references;_f=true;}catch(e){var err=new bfree.api.Error("Failed to close 'Edit Document' dialog",e);bfree.widget.ErrorManager.handleError({error:err});}return _f;},postCreate:function(){this.inherited("postCreate",arguments);this.activeReference=this.references[0];this._accessor=new versa.widget.reference.Accessor({activeLibrary:this.library,activeZone:this.zone});this._grdVersions=new bfree.widget.document.version.Grid({id:"grdVersions","class":"versaGridOutline",library:this.library,zone:this.zone,reference:this.activeReference,dropbox:this.activeReference.is_dropbox,onCommand:dojo.hitch(this,this._onCommand)},this.gridNode);},startup:function(){this.inherited("startup",arguments);this._grdVersions.resize();setTimeout(bfree.widget.document.PropertyEditor._loadFnRef(this),10);}});bfree.widget.document.version.Versions._loadFnRef=function(_10){return (function(){_10._loadItem();});};bfree.widget.document.version.Versions.show=function(_11){if((!_11.items)||(_11.items.length<1)){throw new Error("No documents selected");}var _12=_11.items[0];var dlg=new bfree.widget.Dialog({id:"dlgVersions",title:"Versions: "+_12.name.display_limit(32),widgetConstructor:bfree.widget.document.version.Versions,widgetParams:{references:_11.items,library:_11.library,zone:_11.zone,onCommand:_11.onCommand},noResize:true,height:480,width:480,zIndex:1024,buttons:bfree.widget.Dialog.buttons.close,onClose:_11.onClose});dlg.startup();dlg.show();};}