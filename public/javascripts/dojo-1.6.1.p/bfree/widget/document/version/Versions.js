/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.version.Versions"]){dojo._hasResource["bfree.widget.document.version.Versions"]=true;dojo.provide("bfree.widget.document.version.Versions");dojo.require("bfree.widget.document.version.Grid");dojo.declare("bfree.widget.document.version.Versions",[dijit._Widget,dijit._Templated,bfree.widget._DialogWidget],{templateString:dojo.cache("bfree/widget/document/version","template/Versions.html","<div style=\"height:100%;width:100%;\">\n\n    <div    dojoType=\"dijit.layout.BorderContainer\"\n            design=\"headline\"\n            gutters=\"false\"\n            style=\"height:100%;width:100%;\">\n\n        <div    dojoType=\"dijit.layout.ContentPane\"\n                region=\"center\"\n                splitter=\"false\"\n                style=\"\">\n\n            <div dojoAttachPoint=\"gridNode\"></div>\n\n        </div>\n\n    </div>\n\n</div>\n"),widgetsInTemplate:true,_accessor:null,_grdVersions:null,document:null,library:null,zone:null,__onCopy:function(_1){var _2=_1.version;try{this._accessor.doCopyLocal(this.document,_2);}catch(e){var _3=new bfree.api.Error("Failed to copy document",e);bfree.widget.ErrorManager.handleError({error:_3});}},__onView:function(_4){var _5=_4.version;try{this._accessor.doView(this.document,_5);}catch(e){var _6=new bfree.api.Error("Failed to view version",e);bfree.widget.ErrorManager.handleError({error:_6});}},_loadItem:function(){try{}finally{this.onWidgetLoaded();}},_onCommand:function(_7,_8,e){switch(_7){case bfree.widget.Bfree.Commands.VIEW:this.__onView(e);break;case bfree.widget.Bfree.Commands.COPY:this.__onCopy(e);break;}},constructor:function(_9){},destroy:function(){this.inherited("destroy",arguments);},destroy:function(){if(this._grdVersions){this._grdVersions.destroyRecursive();this._grdVersions=null;}},onDialogClosing:function(){var _a=false;try{this.returnValue=this.documents;_a=true;}catch(e){var _b=new bfree.api.Error("Failed to close 'Edit Document' dialog",e);bfree.widget.ErrorManager.handleError({error:_b});}return _a;},postCreate:function(){this.inherited("postCreate",arguments);this.document=this.documents[0];this._accessor=new bfree.widget.document.version.Accessor({library:this.library,zone:this.zone});this._grdVersions=new bfree.widget.document.version.Grid({id:"grdVersions","class":"versaGridOutline",versions:this.document.getVersions({zone:this.zone,library:this.library}),document:this.document,onCommand:dojo.hitch(this,this._onCommand)},this.gridNode);this._grdVersions.startup();},startup:function(){this.inherited("startup",arguments);this._grdVersions.resize();setTimeout(bfree.widget.document.PropertyEditor._loadFnRef(this),10);}});bfree.widget.document.version.Versions._loadFnRef=function(_c){return (function(){_c._loadItem();});};bfree.widget.document.version.Versions.show=function(_d){if((!_d.items)||(_d.items.length<1)){throw new Error("No documents selected");}var _e=_d.items[0];var _f=new bfree.widget.Dialog({id:"dlgVersions",title:"Versions: "+_e.name.display_limit(32),widgetConstructor:bfree.widget.document.version.Versions,widgetParams:{documents:_d.items,library:_d.library,zone:_d.zone,onCommand:_d.onCommand},noResize:true,height:480,width:480,zIndex:1024,buttons:bfree.widget.Dialog.buttons.close,onClose:_d.onClose});_f.startup();_f.show();};}