/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.Info"]){dojo._hasResource["bfree.widget.document.Info"]=true;dojo.provide("bfree.widget.document.Info");dojo.require("bfree.IconManager");dojo.require("bfree.widget.PropertyTable");dojo.require("bfree.api.Preferences");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("versa.api.Formatter");dojo.declare("bfree.widget.document.Info",[dijit._Widget,dijit._Templated],{templateString:dojo.cache("bfree/widget/document","template/Info.html","<div style=\"padding:4px 0 0 72px;position:relative;height:100%;width:100%\">\n\n    <div style=\"position:absolute;top:8px;left:8px;height:48px;width:48px;\">\n        <img dojoAttachPoint=\"typeIconNode\" src=\"\" height=\"48\" width=\"48\"/>\n        <img dojoAttachPoint=\"stateIconNode\" src=\"/images/loading/loading24.gif\" height=\"24\"width=\"24\" style=\"position:absolute;bottom:0;right:0\">\n    </div>\n\n    <div class=\"dijitBoldLabel dijitLargeLabel dijitDarkLabel\" dojoAttachPoint=\"nameNode\" style=\"margin-right:80px\"></div>\n    <div dojoAttachPoint=\"tableNode\"></div>\n\n</div>\n"),widgetsInTemplate:false,_itemMap:null,_labels:null,_colCount:4,_rowCount:3,_propertyCount:12,_tblProperties:null,items:null,library:null,preferences:null,_generateMultiItem:function(_1){var _2=this._initData();var _3=0;dojo.forEach(_1,function(_4,_5){_3+=_4.binary_file_size;},this);_2[0].label="Size";_2[0].value=bfree.api.Utilities.readablizeBytes({bytes:_3});return _2;},_generateSingleItem:function(_6){var _7=this._initData();_7[0].label="Type";_7[0].value=_6.document_type_name;_7[3].label="Version";_7[3].value=_6.getFullVersion();_7[6].label="Checked Out By";_7[6].value=(_6.getState(bfree.api.Document.states.CHECKED_OUT)?_6.checked_out_by:"");_7[9].label=(_6.isDeleted()?"Deletion Date":"Last Modified Date");_7[9].value=versa.api.Formatter.formatDateTime(_6.updated_at);var _8=this.library.getDocumentTypes().fetchById({id:_6.document_type_id});var _9=1;var _a=0;dojo.every(_8.property_mappings,function(_b){var _c=0;var _d=this.library.getPropertyDefinitions().fetchById({id:_b.property_definition_id});if(!(_d.is_system||_d.isTypeText())){var _e=_6[_d.column_name];_e=bfree.api.PropertyMapping.formatValue(_d,_e);_c=(_9+(_a*this._rowCount));_7[_c].label=_d.name;_7[_c].value=_e;_a++;if(_a>this._rowCount){_9++;_a=0;}}return (_c<this._propertyCount);},this);return _7;},_initialize:function(){var _f="";var _10="";var _11="";if(this.items.length==1){var _12=this.items[0];_f=bfree.api.Document.getIconUrl(_12.binary_content_type,48);_10=_12.binary_content_type;_11=_12.name;}else{if(this.items.length>1){_f="/images/mimetypes/48/multi-document.png";_10="Multiple documents selected";_11=dojo.replace("{0} documents selected",[this.items.length]);}else{}}dojo.attr(this.typeIconNode,"src",_f);dojo.attr(this.typeIconNode,"alt",_10);this.nameNode.innerHTML=_11;this._labels[0].reset("Loading...","");this._tblProperties.refresh();},_initData:function(){var _13=new Array();for(var i=0;i<this._propertyCount;i++){_13.push({label:"",value:""});}return _13;},constructor:function(_14){this._itemMap=new Object();this._labels=new Array();},destroy:function(){this.destroyDescendants();if(this._tblProperties){this._tblProperties.destroyRecursive();this._tblProperties=null;}if(this._form){this._form.destroy();this._form=null;}this.inherited("destroy",arguments);},errorItem:function(_15,_16){var _17="/images/icons/24/error.png";var _18="An error occurred";dojo.attr(this.stateIconNode,"src",_17);this._labels[0].reset("Failed to load","");this._tblProperties.refresh();},loadItem:function(_19){var _1a="";var _1b="";var _1c="";var _1d=null;if(!_19.isInstanceOf(bfree.api.Document)){return;}if(this.items.length==1){if(this._itemMap.hasOwnProperty(_19.getId())){_1a=bfree.api.Document.getIconUrl(_19.binary_content_type,48);_1b=_19.binary_content_type;_1c=_19.name;_1d=this._generateSingleItem(_19);}}else{if(this.items.length>1){_1a="/images/mimetypes/48/multi-document.png";_1b="Multiple documents selected";_1c=dojo.replace("{0} documents selected",[this.items.length]);_1d=this._generateMultiItem(this.items);}else{}}if(_1d){dojo.attr(this.typeIconNode,"src",_1a);dojo.attr(this.typeIconNode,"alt",_1b);this.nameNode.innerHTML=_1c;dojo.forEach(this._labels,function(_1e,idx){_1e.reset(_1d[idx].label,_1d[idx].value);},this);this._tblProperties.refresh();}delete this._itemMap[_19.getId()];if(Object.keys(this._itemMap).length<1){dojo.style(this.stateIconNode,{display:"none"});}},postCreate:function(){this.inherited("postCreate",arguments);this._documents=this.library.getDocuments();dojo.forEach(this.items,function(_1f,idx){var id=_1f.getId();this._itemMap[id]=_1f;},this);this._tblProperties=new bfree.widget.PropertyTable({customClass:"versafoot",showLabels:true,cols:3,labelWidth:112,style:""},this.tableNode);for(var i=0;i<this._propertyCount;i++){this._labels.push(new bfree.widget.Label({label:"",value:""}));this._tblProperties.addChild(this._labels[i]);}},startup:function(){this.inherited("startup",arguments);this._tblProperties.startup();this._initialize();}});}