/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.PropertyEditor"]){dojo._hasResource["bfree.widget.document.PropertyEditor"]=true;dojo.provide("bfree.widget.document.PropertyEditor");dojo.require("bfree.widget._DialogWidget");dojo.require("bfree.widget.Dialog");dojo.require("bfree.widget.Label");dojo.require("bfree.widget.PropertyTable");dojo.require("bfree.widget.document.Header");dojo.require("bfree.widget.doctype.properties.Editor");dojo.require("dijit._Widget");dojo.require("dijit._Templated");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.layout.ContentPane");dojo.declare("bfree.widget.document.PropertyEditor",[dijit._Widget,dijit._Templated,bfree.widget._DialogWidget],{templateString:dojo.cache("bfree/widget/document","template/PropertyEditor.html","<div style=\"height:100%;width:100%;\">\n\n<div    dojoType=\"dijit.layout.BorderContainer\"\n        design=\"headline\"\n        gutters=\"false\"\n        style=\"padding:0px 8px 4px 8px;height:100%;width:100%;\">\n\n     <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"top\"\n            splitter=\"false\"\n            style=\"overflow:hidden;height:32px\">\n\n         <div dojoAttachPoint=\"headerNode\"></div>\n\n    </div>\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n                splitter=\"false\"\n                region=\"center\"\n                splitter=\"true\"\n                style=\"padding:8px\"\n                class=\"highlightPane\">\n\n       <div dojoAttachPoint=\"editorNode\"></div>\n\n    </div>\n\n    <div    dojoType=\"dijit.layout.ContentPane\"\n            region=\"bottom\"\n            splitter=\"false\"\n            style=\"padding:8px;overflow:hidden;height:144px\">\n\n         <div dojoAttachPoint=\"tableNode\"></div>\n\n    </div>\n\n</div>\n\n</div>\n"),widgetsInTemplate:true,_editor:null,_tblSysProps:null,_documents:null,_documentType:null,document:null,library:null,_onValueChange:function(id,_1){var _2=id.replace("documents.","");if(this.document.hasOwnProperty(_2)&&(this.document[_2]!=_1)){this._documents.setValue(this.document,_2,_1);this.onValueChange();}},_setValues:function(){for(var _3 in this.document){var _4=dojo.replace("documents.{0}",[_3]);this._editor.setValue(_4,this.document[_3]);}this._tblSysProps.addChild(new bfree.widget.Label({id:"lblId",label:"Document ID:",value:this.document.id}));this._tblSysProps.addChild(new bfree.widget.Label({id:"lblIsCko",label:"Is Checked out:",value:this.document.getState(bfree.api.Document.states.CHECKED_OUT)}));this._tblSysProps.addChild(new bfree.widget.Label({id:"lblCkoBy",label:"Checked out by:",value:this.document.checked_out_by!=null?this.document.checked_out_by:"Nobody"}));this._tblSysProps.addChild(new bfree.widget.Label({id:"lblIsIndexed",label:"Is Indexed:",value:this.document.getState(bfree.api.Document.states.INDEXED)}));this._tblSysProps.addChild(new bfree.widget.Label({id:"lblCreatedBy",label:"Created By:",value:this.document.created_by}));this._tblSysProps.addChild(new bfree.widget.Label({id:"lblCreatedAt",label:"Create Date:",value:dojo.date.locale.format(this.document.created_at,{formatLength:"medium"})}));this._tblSysProps.addChild(new bfree.widget.Label({id:"lblUpdatedBy",label:"Last Modified By:",value:this.document.updated_by}));this._tblSysProps.addChild(new bfree.widget.Label({id:"lblUpdatedAt",label:"Last Modified Date:",value:dojo.date.locale.format(this.document.updated_at,{formatLength:"medium"})}));this._tblSysProps.refresh();},constructor:function(_5){},destroy:function(){if(this._tblSysProps){this._tblSysProps.destroyDescendants();this._tblSysProps.destroy();this._tblSysProps=null;}if(this._editor){this._editor.destroy();this._editor=null;}this.inherited("destroy",arguments);},isValid:function(){return ((this._documents.isDirty({item:this.document}))&&(!this.document.getState(bfree.api.Document.states.INVALID)));},onDialogClosing:function(_6){var _7=false;try{if(_6==bfree.widget.Dialog.dialogResult.ok){this._documents.save();this._documents.loadItem({item:this.document});_7=true;}else{this._documents.revert();_7=true;}}catch(e){var _8=eval(e.message);if(_8=="refresh"){bfree.widget.document.PropertyEditor.refresh();return true;}var _9=new bfree.api.Error("Failed to close 'Edit Document' dialog",e);bfree.widget.ErrorManager.handleError({error:_9});}return _7;},postCreate:function(){this.inherited("postCreate",arguments);this._documents=this.library.getDocuments();this._documentType=this.library.getDocumentTypes().fetchById({id:this.document.document_type_id});var _a=this.library.getPropertyDefinitions();_a.refresh();var _b=this.library.getChoiceLists();_b.refresh();this._header=new bfree.widget.document.Header({document:this.document,documentType:this._documentType},this.headerNode);this._editor=new bfree.widget.doctype.properties.Editor({id:"propertyEditor1",choiceLists:_b,propertyDefinitions:_a,onValueChange:dojo.hitch(this,this._onValueChange)},this.editorNode);this._tblSysProps=new bfree.widget.PropertyTable({id:"tblSysProps1",customClass:"versa",showLabels:true,cols:1,labelWidth:128,style:"width:100%"},this.tableNode);},startup:function(){this.inherited("startup",arguments);this._editor.startup();this._tblSysProps.startup();this._editor.set("activeItem",this._documentType);this._setValues();dijit.byId("wdg_documents.name").set("intermediateChanges",true);}});bfree.widget.document.PropertyEditor.show=function(_c){var _d=new bfree.widget.Dialog({id:"dlgEditDocument",title:"Edit Document: "+(_c.document.name.length>32?_c.document.name.substr(0,32)+"...":_c.document.name),widgetConstructor:bfree.widget.document.PropertyEditor,widgetParams:{user:_c.user,document:_c.document,library:_c.library,zone:_c.zone},noResize:true,height:480,width:400,zIndex:1024,buttons:bfree.widget.Dialog.buttons.ok|bfree.widget.Dialog.buttons.cancel,onClose:_c.onClose});_d.startup();_d.show();};}