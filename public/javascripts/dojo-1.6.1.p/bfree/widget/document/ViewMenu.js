/*
	Copyright (c) 2004-2011, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["bfree.widget.document.ViewMenu"]){dojo._hasResource["bfree.widget.document.ViewMenu"]=true;dojo.provide("bfree.widget.document.ViewMenu");dojo.require("bfree.widget.HeaderMenu");dojo.declare("bfree.widget.document.ViewMenu",bfree.widget.HeaderMenu,{menuLabel:"Views",library:null,activeView:null,rowHit:false,viewDefinitions:null,_buildViewMenus:function(){var _1=this.viewDefinitions.fetch();_1=_1.sort(bfree.api.ViewDefinition.compare);dojo.forEach(_1,function(_2){if(!_2.name){return;}var _3="menuIcon menuViewIcon";var _4=new dijit.MenuItem({iconClass:_3,label:_2.name});dojo.connect(_4,"onClick",dojo.hitch(this,this._onChange,_4,_2));_4.set("viewDefinition",_2);this.addChild(_4);},this);},_onChange:function(_5,_6,_7){var _8=_6.getView(this.library);this.set("activeView",_8);},_openMyself:function(e){if(!this.rowHit){e.cancelBubble=true;e.returnValue=false;return;}this.rowHit=false;this.inherited("_openMyself",arguments);},_setActiveViewAttr:function(_9){var _a=null;var _b=(this.activeView)?this.activeView.id:-1;this.activeView=null;var _c=this.getChildren();dojo.forEach(_c,function(_d,_e){if(_d.viewDefinition.is_system){_a=_d;}if(_d.viewDefinition.id==_9.id){_d.set("iconClass","menuIcon bfreeIconOk");this.activeView=_d.viewDefinition.getView(this.library);}else{_d.set("iconClass","menuIcon menuViewIcon");}},this);if(!this.activeView){_a.set("iconClass","menuIcon bfreeIconOk");this.activeView=_a.viewDefinition.getView(this.library);}if(this.activeView.id!=_b){this.onChange(this.activeView);}},onChange:function(_f,evt){},postCreate:function(){this.inherited("postCreate",arguments);this._buildViewMenus();},refresh:function(){var _10=this.getChildren();while(_10.length>0){var _11=_10.pop();this.removeChild(_11);}this._buildViewMenus();this.set("activeView",this.activeView);},getSelectedId:function(){var _12=this.getChildren();var id;for(var i=0;i<_12.length;i++){if(_12[i].set("iconClass")=="menuIcon bfreeIconOk"){id=_12[i].viewDefId;}}return id||-1;}});}