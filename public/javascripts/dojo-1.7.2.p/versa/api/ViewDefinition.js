//>>built
define("versa/api/ViewDefinition",["dojo/_base/declare","versa/api/_Object","versa/api/Error","versa/api/Formatter"],function(_1){var o=_1("versa.api.ViewDefinition",[versa.api._Object],{_view:null,constructor:function(_2){dojo.safeMixin(this,((!_2)?{}:_2));},_generate:function(_3){var _4={name:this.name,id:this.getId(),sort_column:1,cells:[]};dojo.forEach(this.cell_definitions,function(_5,_6){var _7={field:dojo.replace("{table_name}.{column_name}",_5),name:String.isBlank(_5.label)?"&nbsp;":_5.label,width:_5.width,noresize:_5.noresize,style:_5.style,date_format:_5.date_format};_7.get=this._generateGetFn(_5,_3);_7.formatter=this._generateFormatterFn(_5);_4.cells.push(_7);if(_7.field==this.sort_by){_4.sort_column=(this.is_desc)?((_6+1)*-1):(_6+1);}},this);return _4;},_generateFormatterFn:function(_8){var fn=versa.api.CellDefinition.formatData;if(_8.column_name.indexOf("prp_bln")>=0){fn=versa.api.CellDefinition.formatBoolean;}switch(_8.formatter){case versa.api.CellDefinition.formats.icon:fn=versa.api.CellDefinition.formatIcon;break;case versa.api.CellDefinition.formats.size:fn=versa.api.CellDefinition.formatSize;break;case versa.api.CellDefinition.formats.status:fn=versa.api.CellDefinition.formatStatus;break;}return fn;},_generateGetFn:function(_9,_a){var fn=null;switch(_9.table_name){case "versions":fn=dojo.hitch([this,_9],versa.api.ViewDefinition._getVersionAttrFn);break;case "documents":fn=dojo.hitch([this,_9],versa.api.ViewDefinition._getDocumentAttrFn);break;case "document_types":fn=dojo.hitch([this,_9,_a],versa.api.ViewDefinition._getDocumentTypeAttrFn);break;}return fn;},_formatDateTime:function(_b,_c){return versa.api.Formatter.formatDateTime(_c);},getCellByField:function(_d){var _e=null;dojo.some(this.cell_definitions,function(_f,idx){if(versa.api.CellDefinition.getDbName(_f)==_d){_e=_f;}return (_e);},this);return _e;},getView:function(_10){return this._generate(_10);},isValid:function(){var _11=true;if(String.isEmpty(this.name.trim())){_11=false;}if(String.isEmpty(this.sort_by)){_11=false;}return _11;},findColumn:function(_12,_13){for(var i=0;i<this.cell_definitions.length;i++){if(this.cell_definitions[i].table_name&&this.cell_definitions[i].column_name&&_12==this.cell_definitions[i].table_name&&_13==this.cell_definitions[i].column_name){return this.cell_definitions[i];}}return null;}});o.getCustomName=function(_14,_15){return dojo.replace("{0}.{1}",[_14.name,_15.name]);};o._getDocumentAttrFn=function(_16,_17){var _18="";var _19=this[0];var _1a=this[1];if(!_17){return _18;}var _1b=_1a.column_name;switch(_1b){case "created_at":case "updated_at":_18=_19._formatDateTime(_1a,_17[_1b]);break;default:if(/prp_dtt/.test(_1b)&&_17[_1b]){_18=_19._formatDateTime(_1a,_17[_1b]);}else{_18=_17[_1b];}break;}return _18;};o._getDocumentTypeAttrFn=function(_1c,_1d){var _1e="";var _1f=this[0];var _20=this[1];var _21=this[2];if((!_1d)){return _1e;}switch(_20.column_name){case "name":_1e=_1d.document_type_name;break;}return _1e;};o._getVersionAttrFn=function(_22,_23){var _24=null;var _25=this[0];var _26=this[1];if(!_23){return _24;}try{switch(_26.column_name){case "binary_content_type":_24=_23.binary_content_type;break;case "version_number":_24=_23.major_version_number;break;case "binary_file_size":_24=_23.binary_file_size;break;}}catch(e){}return (!_24)?"":_24;};o.compare=function(_27,_28){if((!_27)&&(_28)){return -1;}if((_27)&&(!_28)){return 1;}if((!_27)&&(!_28)){return 0;}if((!_27.name)&&(_28.name)){return -1;}if((_27.name)&&(!_28.name)){return 1;}if((!_27.name)&&(!_28.name)){return 0;}if(_27.name.toLowerCase()==_28.name.toLowerCase()){return 0;}return (_27.name.toLowerCase()<_28.name.toLowerCase())?-1:1;};o.schema={type:"object",properties:{"id":{type:"integer"},"name":{type:"string"},"description":{type:"string"},"is_desc":{type:"boolean","default":false},"is_template":{type:"boolean","default":false},"scope":{type:"string","default":"*"},"sort_by":{type:"string"},"cell_definitions":{type:"array","default":[],"items":{type:"object",properties:{"table_name":{type:"string"},"column_name":{type:"string"},"name":{type:"string"},"label":{type:"string"},"column_order":{type:"integer"},"formatter":{type:"integer"},"date_format":{type:"string"},"width":{type:"string"}}}},"created_at":{type:"date",format:"date-time"},"created_by":{type:"string","default":""},"updated_at":{type:"date",format:"date-time"},"updated_by":{type:"string","default":""}},prototype:o.prototype};return o;});