//>>built
define("versa/api/ViewDefinitions",["dojo/_base/declare","versa/api/ViewDefinition","versa/api/_Collection","versa/api/CellDefinitions","versa/api/Error"],function(_1){var o=_1("versa.api.ViewDefinitions",[versa.api._Collection],{_system:null,documentTypes:null,_matchesQuery:function(_2,_3){if(dojo.isArray(_2)||(_2.hasOwnProperty("column_order"))){return false;}var _4=_3.query;var _5=_3.queryOptions&&_3.queryOptions.ignoreCase;for(var i in _4){var _6=_4[i];var _7=this.getValue(_2,i);if((typeof _6=="string"&&(_6.match(/[\*\.]/)||_5))?!dojo.data.util.filter.patternToRegExp(_6,_5).test(_7):_7!=_6){return false;}}return true;},copyFromTemplate:function(_8,_9){var _a=_8.cell_definitions;var _b=this.create({cell_definitions:[],created_by:_9.name,is_system:false,is_template:false,library_id:_8.library_id,name:_8.name,scope:_8.scope,sort_by:_8.sort_by,updated_by:_9.name});dojo.forEach(_a,function(_c){_b.cell_definitions.push({column_name:_c.column_name,column_order:_c.column_order,date_format:_c.date_format,formatter:_c.formatter,label:_c.label,name:_c.name,noresize:_c.noresize,style:_c.style,table_name:_c.table_name,width:_c.width});},this);return _b;},_getDocumentAttr:function(_d,_e){var _f="";var _10=this[0];var _11=this[1];if(!_e){return _f;}var _12=_11.column_name;switch(_12){case "created_at":case "updated_at":_f=_10._formatDateTime(_11,_e[_12]);break;default:if(/prp_dtt/.test(_12)&&_e[_12]){_f=dojo.date.stamp.fromISOString(_e[_12]);if(_f){_f=_10._formatDateTime(_11,_f);}}else{_f=_e[_12];}break;}return _f;},_getDocumentTypeAttr:function(_13,_14){var _15="";var _16=this[0];var _17=this[1];if(!_14){return _15;}if(!_14.document_type_id){return "";}var _18=_16.documentTypes.fetchById({id:_14.document_type_id});switch(_17.column_name){case "name":_15=_18.name;break;}return _15;},_getVersionAttr:function(_19,_1a){var _1b="";var _1c=this[0];var _1d=this[1];if(!_1a){return _1b;}switch(_1d.column_name){case "content_type":_1b=(_1a.current_version)?_1a.current_version.content_type:"";break;case "version_number":_1b=(_1a.current_version)?_1a.current_version.version_number:0;break;case "size":_1b=(_1a.current_version)?_1a.current_version.size:0;break;}return _1b;},constructor:function(_1e){this.zone=_1e.zone;this.library=_1e.library;this.target=dojo.replace(versa.api.ViewDefinitions.TRGT,[this.zone.subdomain,this.library.id]);this.schema=versa.api.ViewDefinition.schema;this.cache=true;this.cellDefinitions=_1e.cellDefinitions;this._initialize();},cloneItem:function(_1f){var _20=this.create({name:_1f.name,is_system:false,description:_1f.description,is_template:false,scope:_1f.scope,sort_by:_1f.sort_by});dojo.forEach(_1f.cell_definitions,function(_21,idx){_20.cell_definitions.push(versa.api.CellDefinition.clone(_21));});return _20;},getSystem:function(){if(!this._system){this._system=new Array();this.forEach(function(_22){if(_22.is_system){this._system.push(_22);}},this);}return this._system;},isValidItem:function(_23){var _24=this.inherited(arguments);var _25=_23.item;if(!_24){return;}if(_25.name.length<1){throw new Error("View Definition 'Name' is empty or invalid");}if((!_25.sort_by)||(_25.sort_by.length<1)){throw new Error("View Definition must have a 'Sort By' value");}return true;}});o.TRGT="/zones/{0}/libraries/{1}/view_definitions";return o;});