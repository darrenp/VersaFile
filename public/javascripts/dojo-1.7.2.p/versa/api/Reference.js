//>>built
define("versa/api/Reference",["dojo/_base/declare","versa/api/_Object","versa/api/_Securable","versa/api/Utilities","versa/api/Document"],function(_1){var o=_1("versa.api.Reference",[versa.api._Object,versa.api._Securable],{zone:null,library:null,clean_properties:function(_2){var _3=_2.library;var _4=_3.getDocumentTypes().fetchById({id:this.document_type_id});for(var p in this){if(!dojo.isFunction(this[p])){var _5=dojo.replace("documents.{0}",[p]);var _6=_3.getPropertyDefinitions().fetchByDbName(_5);if((_6)&&(!_6.is_system)){if(!_4.hasProperty(_6.id)){delete this[p];}}}}},constructor:function(_7){dojo.safeMixin(this,((!_7)?{}:_7));this.securable_type=versa.api._Securable.types.Reference;},cancelCheckout:function(_8){var _9=_8.zone;var _a=_8.library;var _b=dojo.replace(versa.api.Reference.XCKO_TRGT,[_9.subdomain,_a.id,this.getId()]);var _c={};var _d=versa.api.XhrHelper.doPutAction({target:_b,putData:_c});return true;},checkin:function(_e){var _f=_e.zone;var _10=_e.library;var url=dojo.replace(versa.api.Reference.CKI_TRGT,[_f.subdomain,_10.id,this.getId()]);var _11=dojo.fromJson(dojox.json.ref.toJson(this,false,"",true));var _12=versa.api.XhrHelper.doPutAction({target:url,putData:_11});return true;},checkout:function(_13){var _14=_13.zone;var _15=_13.library;var url=dojo.replace(versa.api.Reference.CKO_TRGT,[_14.subdomain,_15.id,this.getId()]);var _16={};var _17=versa.api.XhrHelper.doPutAction({target:url,putData:_16});return true;},getCopyUrl:function(_18,_19){return dojo.replace(versa.api.Reference.CP_TRGT,[_18.subdomain,_19.id,this.getId()]);},getCopyVersionUrl:function(_1a,_1b,_1c){return dojo.replace(versa.api.Reference.CPV_TRGT,[_1a.subdomain,_1b.id,this.getId(),_1c]);},copyLocal:function(_1d){var _1e=_1d.zone;var _1f=_1d.library;var url=(_1d.version_id)?this.getCopyVersionUrl(_1e,_1f,_1d.version_id):this.getCopyUrl(_1e,_1f);versa.api.Utilities.saveUrl({url:url,window_name:"versa_save"});},file:function(_20){var _21=_20.zone;var _22=_20.library;var _23=_20.folder;var url=dojo.replace(versa.api.Reference.FILE_TRGT,[_21.subdomain,_22.id,this.getId(),_23.getId()]);var _24={};var _25=versa.api.XhrHelper.doPutAction({target:url,putData:_24});_22.getReferences().store.onDelete(this);return true;},getPermissionSet:function(_26,_27,_28){var _29=new versa.api.PermissionSet();_29.setValue(versa.api.PermissionIndices.VIEW,this.hasRights(versa.api._Securable.permissions.VIEW));_29.setValue(versa.api.PermissionIndices.COPY,this.hasRights(versa.api._Securable.permissions.VIEW));_29.setValue(versa.api.PermissionIndices.EDIT,this.hasRights(versa.api._Securable.permissions.WRITE_METADATA));_29.setValue(versa.api.PermissionIndices.MOVE,_29.getValue(versa.api.PermissionIndices.EDIT));_29.setValue(versa.api.PermissionIndices.CKO,(this.hasRights(versa.api._Securable.permissions.VERSION)&&this.getState(versa.api.Document.states.CHECKED_IN)));_29.setValue(versa.api.PermissionIndices.CKI,(this.hasRights(versa.api._Securable.permissions.VERSION)&&this.getState(versa.api.Document.states.CHECKED_OUT)&&(this.checked_out_by==_28.name)));_29.setValue(versa.api.PermissionIndices.CANCEL_CKO,_29.getValue(versa.api.PermissionIndices.CKI));_29.setValue(versa.api.PermissionIndices.DELETE,this.hasRights(versa.api._Securable.permissions.DELETE_ITEMS));_29.setValue(versa.api.PermissionIndices.SECURE,this.hasRights(versa.api._Securable.permissions.WRITE_ACL));_29.setValue(versa.api.PermissionIndices.RESTORE,this.hasRights(versa.api._Securable.permissions.DELETE_ITEMS));_29.setValue(versa.api.PermissionIndices.DESTROY,this.hasRights(versa.api._Securable.permissions.DELETE_ITEMS));return _29;},getState:function(_2a){return ((this.state&_2a)==_2a);},isDeleted:function(){return this.getState(versa.api.Document.states.DELETED);},isShare:function(){return this.reference_type==versa.api.Reference.types.SHARE;},restore:function(_2b){var _2c=_2b.zone;var _2d=_2b.library;var url=dojo.replace(versa.api.Reference.RESTORE_TRGT,[_2c.subdomain,_2d.getId(),this.getId()]);var _2e={folder_id:(_2b.folder)?_2b.folder.id:null};var _2f=versa.api.XhrHelper.doPutAction({target:url,putData:_2e});_2d.getReferences().store.onDelete(this);return true;},share:function(_30){var _31=_30.zone;var _32=_30.library;var _33=_30.folder;var url=dojo.replace(versa.api.Reference.SHARE_TRGT,[_31.subdomain,_32.id,this.getId(),_33.getId()]);var _34={};var _35=versa.api.XhrHelper.doPutAction({target:url,putData:_34});return true;},unshare:function(_36){var _37=_36.zone;var _38=_36.library;var url=dojo.replace(versa.api.Reference.UNSHARE_TRGT,[_37.subdomain,_38.id,this.getId()]);var _39={};var _3a=versa.api.XhrHelper.doPutAction({target:url,putData:_39});_38.getReferences().store.onDelete(this);return true;},getViewUrl:function(_3b,_3c){return dojo.replace(versa.api.Reference.VW_TRGT,[_3b.subdomain,_3c.id,this.getId()]);},getViewVersionUrl:function(_3d,_3e,_3f){return dojo.replace(versa.api.Reference.VWV_TRGT,[_3d.subdomain,_3e.id,this.getId(),_3f]);},view:function(_40){var _41=_40.zone;var _42=_40.library;var url=(_40.version_id)?this.getViewVersionUrl(_41,_42,_40.version_id):this.getViewUrl(_41,_42);versa.api.Utilities.viewUrl({windowBox:_40.windowBox,url:url,window_name:"versa_viewer"});}});o.VW_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=inline";o.VWV_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=inline&version_id={3}";o.CP_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=attachment";o.CPV_TRGT="/zones/{0}/libraries/{1}/references/{2}/download/?disposition=attachment&version_id={3}";o.CKO_TRGT="/zones/{0}/libraries/{1}/references/{2}/checkout.json";o.CKI_TRGT="/zones/{0}/libraries/{1}/references/{2}/checkin.json";o.XCKO_TRGT="/zones/{0}/libraries/{1}/references/{2}/cancel_checkout.json";o.FILE_TRGT="/zones/{0}/libraries/{1}/references/{2}/file.json?folder_id={3}";o.SHARE_TRGT="/zones/{0}/libraries/{1}/references/{2}/share.json?folder_id={3}";o.UNSHARE_TRGT="/zones/{0}/libraries/{1}/references/{2}/unshare.json?";o.RESTORE_TRGT="/zones/{0}/libraries/{1}/references/{2}/restore.json";o.types={"CONTENT":0,"SHARE":17,"TRASH":18};o.schema={type:"object",properties:{"id":{type:"integer"},"reference_type":{type:"integer"},"state":{type:"integer","default":versa.api.Document.states.PENDING}},prototype:new o()};return o;});